{"ast":null,"code":"/**\r\n * DevExtreme (esm/viz/core/export.js)\r\n * Version: 21.2.3\r\n * Build date: Thu Oct 28 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { extend } from \"../../core/utils/extend\";\nimport { getWindow } from \"../../core/utils/window\";\nimport { patchFontOptions } from \"./utils\";\nimport { HIDDEN_FOR_EXPORT } from \"../../core/utils/svg\";\nimport { export as _export, image as imageExporter, svg as svgExporter, pdf as pdfExporter } from \"../../exporter\";\nimport messageLocalization from \"../../localization/message\";\nimport { isDefined } from \"../../core/utils/type\";\nimport { getTheme } from \"../themes\";\nimport { start as hoverEventStart, end as hoverEventEnd } from \"../../events/hover\";\nimport pointerEvents from \"../../events/pointer\";\nimport { logger } from \"../../core/utils/console\";\nvar pointerActions = [pointerEvents.down, pointerEvents.move].join(\" \");\nvar BUTTON_SIZE = 35;\nvar ICON_COORDS = [[9, 12, 26, 12, 26, 14, 9, 14], [9, 17, 26, 17, 26, 19, 9, 19], [9, 22, 26, 22, 26, 24, 9, 24]];\nvar LIST_PADDING_TOP = 4;\nvar LIST_WIDTH = 120;\nvar VERTICAL_TEXT_MARGIN = 8;\nvar HORIZONTAL_TEXT_MARGIN = 15;\nvar MENU_ITEM_HEIGHT = 30;\nvar LIST_STROKE_WIDTH = 1;\nvar MARGIN = 10;\nvar SHADOW_OFFSET = 2;\nvar SHADOW_BLUR = 3;\nvar DEFAULT_EXPORT_FORMAT = \"PNG\";\nvar ALLOWED_IMAGE_FORMATS = [DEFAULT_EXPORT_FORMAT, \"JPEG\", \"GIF\"];\nvar ALLOWED_EXTRA_FORMATS = [\"PDF\", \"SVG\"];\nvar EXPORT_CSS_CLASS = \"dx-export-menu\";\nvar EXPORT_DATA_KEY = \"export-element-type\";\nvar FORMAT_DATA_KEY = \"export-element-format\";\nvar GET_COLOR_REGEX = /data-backgroundcolor=\"([^\"]*)\"/;\n\nfunction getValidFormats() {\n  var imageFormats = imageExporter.testFormats(ALLOWED_IMAGE_FORMATS);\n  return {\n    unsupported: imageFormats.unsupported,\n    supported: imageFormats.supported.concat(ALLOWED_EXTRA_FORMATS)\n  };\n}\n\nfunction validateFormat(format, incidentOccurred, validFormats) {\n  validFormats = validFormats || getValidFormats();\n  format = String(format).toUpperCase();\n\n  if (-1 !== validFormats.supported.indexOf(format)) {\n    return format;\n  }\n\n  if (-1 !== validFormats.unsupported.indexOf(format)) {\n    incidentOccurred && incidentOccurred(\"W2108\", [format]);\n  }\n}\n\nfunction getCreatorFunc(format) {\n  if (\"SVG\" === format) {\n    return svgExporter.getData;\n  } else if (\"PDF\" === format) {\n    return pdfExporter.getData;\n  } else {\n    return imageExporter.getData;\n  }\n}\n\nfunction print(imageSrc, options) {\n  var document = getWindow().document;\n  var iFrame = document.createElement(\"iframe\");\n  iFrame.onload = setPrint(imageSrc, options);\n  iFrame.style.position = \"fixed\";\n  iFrame.style.width = \"0\";\n  iFrame.style.height = \"0\";\n  iFrame.style.right = \"0\";\n  iFrame.style.bottom = \"0\";\n  document.body.appendChild(iFrame);\n}\n\nfunction setPrint(imageSrc, options) {\n  return function () {\n    var window = this.contentWindow;\n    var img = window.document.createElement(\"img\");\n    window.document.body.appendChild(img);\n\n    var removeFrame = () => {\n      this.parentElement.removeChild(this);\n    };\n\n    img.addEventListener(\"load\", () => {\n      window.focus();\n      window.print();\n    });\n    img.addEventListener(\"error\", removeFrame);\n    window.addEventListener(\"afterprint\", () => {\n      setTimeout(removeFrame, 0);\n    });\n    img.src = imageSrc;\n  };\n}\n\nfunction getItemAttributes(options, type, itemIndex) {\n  var x = BUTTON_SIZE - LIST_WIDTH;\n  var y = BUTTON_SIZE + LIST_PADDING_TOP + LIST_STROKE_WIDTH + itemIndex * MENU_ITEM_HEIGHT;\n  var attr = {\n    rect: {\n      width: LIST_WIDTH - 2 * LIST_STROKE_WIDTH,\n      height: MENU_ITEM_HEIGHT,\n      x: x + LIST_STROKE_WIDTH,\n      y: y\n    },\n    text: {\n      x: x + (options.rtl ? LIST_WIDTH - HORIZONTAL_TEXT_MARGIN : HORIZONTAL_TEXT_MARGIN),\n      y: y + MENU_ITEM_HEIGHT - VERTICAL_TEXT_MARGIN\n    }\n  };\n\n  if (\"printing\" === type) {\n    attr.separator = {\n      stroke: options.button.default.borderColor,\n      \"stroke-width\": LIST_STROKE_WIDTH,\n      cursor: \"pointer\",\n      sharp: \"v\",\n      d: \"M \" + x + \" \" + (y + MENU_ITEM_HEIGHT - LIST_STROKE_WIDTH) + \" L \" + (x + LIST_WIDTH) + \" \" + (y + MENU_ITEM_HEIGHT - LIST_STROKE_WIDTH)\n    };\n  }\n\n  return attr;\n}\n\nfunction createMenuItem(renderer, options, settings) {\n  var itemData = {};\n  var type = settings.type;\n  var format = settings.format;\n  var attr = getItemAttributes(options, type, settings.itemIndex);\n  var fontStyle = patchFontOptions(options.font);\n  fontStyle[\"pointer-events\"] = \"none\";\n  var menuItem = renderer.g().attr({\n    class: EXPORT_CSS_CLASS + \"-list-item\"\n  });\n  itemData[EXPORT_DATA_KEY] = type;\n\n  if (format) {\n    itemData[FORMAT_DATA_KEY] = format;\n  }\n\n  var rect = renderer.rect();\n  rect.attr(attr.rect).css({\n    cursor: \"pointer\",\n    \"pointer-events\": \"all\"\n  }).data(itemData);\n  rect.on(hoverEventStart + \".export\", () => rect.attr({\n    fill: options.button.hover.backgroundColor\n  })).on(hoverEventEnd + \".export\", () => rect.attr({\n    fill: null\n  }));\n  rect.append(menuItem);\n  var text = renderer.text(settings.text).css(fontStyle).attr(attr.text).append(menuItem);\n\n  if (\"printing\" === type) {\n    renderer.path(null, \"line\").attr(attr.separator).append(menuItem);\n  }\n\n  return {\n    g: menuItem,\n    rect: rect,\n    resetState: () => rect.attr({\n      fill: null\n    }),\n    fixPosition: () => {\n      var textBBox = text.getBBox();\n      text.move(attr.text.x - textBBox.x - (options.rtl ? textBBox.width : 0));\n    }\n  };\n}\n\nfunction createMenuItems(renderer, options) {\n  var items = [];\n\n  if (options.printingEnabled) {\n    items.push(createMenuItem(renderer, options, {\n      type: \"printing\",\n      text: messageLocalization.format(\"vizExport-printingButtonText\"),\n      itemIndex: items.length\n    }));\n  }\n\n  items = options.formats.reduce((r, format) => {\n    r.push(createMenuItem(renderer, options, {\n      type: \"exporting\",\n      text: messageLocalization.getFormatter(\"vizExport-exportButtonText\")(format),\n      format: format,\n      itemIndex: r.length\n    }));\n    return r;\n  }, items);\n  return items;\n}\n\nfunction getBackgroundColorFromMarkup(markup) {\n  var parsedMarkup = GET_COLOR_REGEX.exec(markup);\n  return null === parsedMarkup || void 0 === parsedMarkup ? void 0 : parsedMarkup[1];\n}\n\nexport var exportFromMarkup = function (markup, options) {\n  options.format = validateFormat(options.format) || DEFAULT_EXPORT_FORMAT;\n  options.fileName = options.fileName || \"file\";\n  options.exportingAction = options.onExporting;\n  options.exportedAction = options.onExported;\n  options.fileSavingAction = options.onFileSaving;\n  options.margin = isDefined(options.margin) ? options.margin : MARGIN;\n  options.backgroundColor = isDefined(options.backgroundColor) ? options.backgroundColor : getBackgroundColorFromMarkup(markup) || getTheme().backgroundColor;\n\n  _export(markup, options, getCreatorFunc(options.format));\n};\nexport var getMarkup = widgets => combineMarkups(widgets).markup;\nexport var exportWidgets = function (widgets, options) {\n  options = options || {};\n  var markupInfo = combineMarkups(widgets, {\n    gridLayout: options.gridLayout,\n    verticalAlignment: options.verticalAlignment,\n    horizontalAlignment: options.horizontalAlignment\n  });\n  options.width = markupInfo.width;\n  options.height = markupInfo.height;\n  exportFromMarkup(markupInfo.markup, options);\n};\nexport var combineMarkups = function (widgets) {\n  var options = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};\n\n  if (!Array.isArray(widgets)) {\n    widgets = [[widgets]];\n  } else if (!Array.isArray(widgets[0])) {\n    widgets = widgets.map(item => [item]);\n  }\n\n  var compactView = !options.gridLayout;\n  var exportItems = widgets.reduce((r, row, rowIndex) => {\n    var rowInfo = row.reduce((r, item, colIndex) => {\n      var size = item.getSize();\n      var backgroundColor = item.option(\"backgroundColor\") || getTheme(item.option(\"theme\")).backgroundColor;\n      backgroundColor && -1 === r.backgroundColors.indexOf(backgroundColor) && r.backgroundColors.push(backgroundColor);\n      r.hOffset = r.width;\n      r.width += size.width;\n      r.height = Math.max(r.height, size.height);\n      r.itemWidth = Math.max(r.itemWidth, size.width);\n      r.items.push({\n        markup: item.svg(),\n        width: size.width,\n        height: size.height,\n        c: colIndex,\n        r: rowIndex,\n        hOffset: r.hOffset\n      });\n      return r;\n    }, {\n      items: [],\n      height: 0,\n      itemWidth: 0,\n      hOffset: 0,\n      width: 0,\n      backgroundColors: r.backgroundColors\n    });\n    r.rowOffsets.push(r.totalHeight);\n    r.rowHeights.push(rowInfo.height);\n    r.totalHeight += rowInfo.height;\n    r.items = r.items.concat(rowInfo.items);\n    r.itemWidth = Math.max(r.itemWidth, rowInfo.itemWidth);\n    r.maxItemLen = Math.max(r.maxItemLen, rowInfo.items.length);\n    r.totalWidth = compactView ? Math.max(r.totalWidth, rowInfo.width) : r.maxItemLen * r.itemWidth;\n    return r;\n  }, {\n    items: [],\n    rowOffsets: [],\n    rowHeights: [],\n    itemWidth: 0,\n    totalHeight: 0,\n    maxItemLen: 0,\n    totalWidth: 0,\n    backgroundColors: []\n  });\n  var backgroundColor = 'data-backgroundcolor=\"'.concat(1 === exportItems.backgroundColors.length ? exportItems.backgroundColors[0] : \"\", '\" ');\n\n  var getVOffset = item => {\n    var align = options.verticalAlignment;\n    var dy = exportItems.rowHeights[item.r] - item.height;\n    return exportItems.rowOffsets[item.r] + (\"bottom\" === align ? dy : \"center\" === align ? dy / 2 : 0);\n  };\n\n  var getHOffset = item => {\n    if (compactView) {\n      return item.hOffset;\n    }\n\n    var align = options.horizontalAlignment;\n    var colWidth = exportItems.itemWidth;\n    var dx = colWidth - item.width;\n    return item.c * colWidth + (\"right\" === align ? dx : \"center\" === align ? dx / 2 : 0);\n  };\n\n  var totalHeight = exportItems.totalHeight;\n  var totalWidth = exportItems.totalWidth;\n  return {\n    markup: \"<svg \" + backgroundColor + 'height=\"' + totalHeight + '\" width=\"' + totalWidth + '\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">' + exportItems.items.map(item => '<g transform=\"translate('.concat(getHOffset(item), \",\").concat(getVOffset(item), ')\">').concat(item.markup, \"</g>\")).join(\"\") + \"</svg>\",\n    width: totalWidth,\n    height: totalHeight\n  };\n};\nexport var ExportMenu = function (params) {\n  var renderer = this._renderer = params.renderer;\n  this._incidentOccurred = params.incidentOccurred;\n  this._exportTo = params.exportTo;\n  this._print = params.print;\n  this._shadow = renderer.shadowFilter(\"-50%\", \"-50%\", \"200%\", \"200%\", SHADOW_OFFSET, 6, SHADOW_BLUR);\n\n  this._shadow.attr({\n    opacity: .8\n  });\n\n  this._group = renderer.g().attr({\n    class: EXPORT_CSS_CLASS,\n    [HIDDEN_FOR_EXPORT]: true\n  }).linkOn(renderer.root, {\n    name: \"export-menu\",\n    after: \"peripheral\"\n  });\n  this._buttonGroup = renderer.g().attr({\n    class: EXPORT_CSS_CLASS + \"-button\"\n  }).append(this._group);\n  this._listGroup = renderer.g().attr({\n    class: EXPORT_CSS_CLASS + \"-list\"\n  }).append(this._group);\n  this._overlay = renderer.rect(-LIST_WIDTH + BUTTON_SIZE, BUTTON_SIZE + LIST_PADDING_TOP, LIST_WIDTH, 0);\n\n  this._overlay.attr({\n    \"stroke-width\": LIST_STROKE_WIDTH,\n    cursor: \"pointer\",\n    rx: 4,\n    ry: 4,\n    filter: this._shadow.id\n  });\n\n  this._overlay.data({\n    \"export-element-type\": \"list\"\n  });\n\n  this.validFormats = getValidFormats();\n\n  this._subscribeEvents();\n};\nextend(ExportMenu.prototype, {\n  getLayoutOptions() {\n    if (this._hiddenDueToLayout) {\n      return {\n        width: 0,\n        height: 0,\n        cutSide: \"vertical\",\n        cutLayoutSide: \"top\"\n      };\n    }\n\n    var bBox = this._buttonGroup.getBBox();\n\n    bBox.cutSide = \"vertical\";\n    bBox.cutLayoutSide = \"top\";\n    bBox.height += MARGIN;\n    bBox.position = {\n      vertical: \"top\",\n      horizontal: \"right\"\n    };\n    bBox.verticalAlignment = \"top\";\n    bBox.horizontalAlignment = \"right\";\n    return bBox;\n  },\n\n  shift(_, y) {\n    this._group.attr({\n      translateY: this._group.attr(\"translateY\") + y\n    });\n  },\n\n  draw(width, height, canvas) {\n    this._group.move(width - BUTTON_SIZE - SHADOW_OFFSET - SHADOW_BLUR + canvas.left, Math.floor(height / 2 - BUTTON_SIZE / 2));\n\n    var layoutOptions = this.getLayoutOptions();\n\n    if (layoutOptions.width > width || layoutOptions.height > height) {\n      this.freeSpace();\n    }\n\n    return this;\n  },\n\n  show() {\n    this._group.linkAppend();\n  },\n\n  hide() {\n    this._group.linkRemove();\n  },\n\n  setOptions(options) {\n    this._options = options;\n\n    if (options.formats) {\n      options.formats = options.formats.reduce((r, format) => {\n        format = validateFormat(format, this._incidentOccurred, this.validFormats);\n        format && r.push(format);\n        return r;\n      }, []);\n    } else {\n      options.formats = this.validFormats.supported.slice();\n    }\n\n    options.printingEnabled = void 0 === options.printingEnabled ? true : options.printingEnabled;\n\n    if (options.enabled && (options.formats.length || options.printingEnabled)) {\n      this.show();\n\n      this._updateButton();\n\n      this._updateList();\n\n      this._hideList();\n    } else {\n      this.hide();\n    }\n  },\n\n  dispose() {\n    this._unsubscribeEvents();\n\n    this._group.linkRemove().linkOff();\n\n    this._group.dispose();\n\n    this._shadow.dispose();\n  },\n\n  layoutOptions() {\n    return this._options.enabled && {\n      horizontalAlignment: \"right\",\n      verticalAlignment: \"top\",\n      weak: true\n    };\n  },\n\n  measure() {\n    this._fillSpace();\n\n    var margin = this._options.button.margin;\n    return [BUTTON_SIZE + margin.left + margin.right, BUTTON_SIZE + margin.top + margin.bottom];\n  },\n\n  move(rect) {\n    var margin = this._options.button.margin;\n\n    this._group.attr({\n      translateX: Math.round(rect[0]) + margin.left,\n      translateY: Math.round(rect[1]) + margin.top\n    });\n  },\n\n  _fillSpace() {\n    this._hiddenDueToLayout = false;\n    this.show();\n  },\n\n  freeSpace() {\n    this._incidentOccurred(\"W2107\");\n\n    this._hiddenDueToLayout = true;\n    this.hide();\n  },\n\n  _hideList() {\n    this._listGroup.remove();\n\n    this._listShown = false;\n\n    this._setButtonState(\"default\");\n\n    this._menuItems.forEach(item => item.resetState());\n  },\n\n  _showList() {\n    this._listGroup.append(this._group);\n\n    this._listShown = true;\n\n    this._menuItems.forEach(item => item.fixPosition());\n  },\n\n  _setButtonState(state) {\n    var style = this._options.button[state];\n\n    this._button.attr({\n      stroke: style.borderColor,\n      fill: style.backgroundColor\n    });\n\n    this._icon.attr({\n      fill: style.color\n    });\n  },\n\n  _subscribeEvents() {\n    this._renderer.root.on(pointerEvents.up + \".export\", e => {\n      var elementType = e.target[EXPORT_DATA_KEY];\n\n      if (!elementType) {\n        if (this._button) {\n          this._hideList();\n        }\n\n        return;\n      }\n\n      if (\"button\" === elementType) {\n        if (this._listShown) {\n          this._setButtonState(\"default\");\n\n          this._hideList();\n        } else {\n          this._setButtonState(\"focus\");\n\n          this._showList();\n        }\n      } else if (\"printing\" === elementType) {\n        this._print();\n\n        this._hideList();\n      } else if (\"exporting\" === elementType) {\n        this._exportTo(e.target[FORMAT_DATA_KEY]);\n\n        this._hideList();\n      }\n    });\n\n    this._listGroup.on(pointerActions, e => e.stopPropagation());\n\n    this._buttonGroup.on(pointerEvents.enter, () => this._setButtonState(\"hover\"));\n\n    this._buttonGroup.on(pointerEvents.leave, () => this._setButtonState(this._listShown ? \"focus\" : \"default\"));\n\n    this._buttonGroup.on(pointerEvents.down + \".export\", () => this._setButtonState(\"active\"));\n  },\n\n  _unsubscribeEvents() {\n    this._renderer.root.off(\".export\");\n\n    this._listGroup.off();\n\n    this._buttonGroup.off();\n  },\n\n  _updateButton() {\n    var renderer = this._renderer;\n    var options = this._options;\n    var exportData = {\n      \"export-element-type\": \"button\"\n    };\n\n    if (!this._button) {\n      this._button = renderer.rect(0, 0, BUTTON_SIZE, BUTTON_SIZE).append(this._buttonGroup);\n\n      this._button.attr({\n        rx: 4,\n        ry: 4,\n        fill: options.button.default.backgroundColor,\n        stroke: options.button.default.borderColor,\n        \"stroke-width\": 1,\n        cursor: \"pointer\"\n      });\n\n      this._button.data(exportData);\n\n      this._icon = renderer.path(ICON_COORDS).append(this._buttonGroup);\n\n      this._icon.attr({\n        fill: options.button.default.color,\n        cursor: \"pointer\"\n      });\n\n      this._icon.data(exportData);\n\n      this._buttonGroup.setTitle(messageLocalization.format(\"vizExport-titleMenuText\"));\n    }\n  },\n\n  _updateList() {\n    var options = this._options;\n    var buttonDefault = options.button.default;\n    var listGroup = this._listGroup;\n    var items = createMenuItems(this._renderer, options);\n\n    this._shadow.attr({\n      color: options.shadowColor\n    });\n\n    this._overlay.attr({\n      height: items.length * MENU_ITEM_HEIGHT + 2 * LIST_STROKE_WIDTH,\n      fill: buttonDefault.backgroundColor,\n      stroke: buttonDefault.borderColor\n    });\n\n    listGroup.clear();\n\n    this._overlay.append(listGroup);\n\n    items.forEach(item => item.g.append(listGroup));\n    this._menuItems = items;\n  }\n\n});\n\nfunction getExportOptions(widget, exportOptions, fileName, format) {\n  if (format || exportOptions.format) {\n    format = validateFormat(format || exportOptions.format, widget._incidentOccurred);\n  }\n\n  var {\n    width: width,\n    height: height\n  } = widget.getSize();\n  var pixelRatio = getWindow().devicePixelRatio || 1;\n  return {\n    format: format || DEFAULT_EXPORT_FORMAT,\n    fileName: fileName || exportOptions.fileName || \"file\",\n    proxyUrl: exportOptions.proxyUrl,\n    backgroundColor: exportOptions.backgroundColor,\n    width: width * pixelRatio,\n    height: height * pixelRatio,\n    pixelRatio: pixelRatio,\n    margin: exportOptions.margin,\n    svgToCanvas: exportOptions.svgToCanvas,\n    forceProxy: exportOptions.forceProxy,\n    exportingAction: widget._createActionByOption(\"onExporting\"),\n    exportedAction: widget._createActionByOption(\"onExported\"),\n    fileSavingAction: widget._createActionByOption(\"onFileSaving\")\n  };\n}\n\nexport var plugin = {\n  name: \"export\",\n\n  init() {\n    this._exportMenu = new ExportMenu({\n      renderer: this._renderer,\n      incidentOccurred: this._incidentOccurred,\n      print: () => this.print(),\n      exportTo: format => this.exportTo(void 0, format)\n    });\n\n    this._layout.add(this._exportMenu);\n  },\n\n  dispose() {\n    this._exportMenu.dispose();\n  },\n\n  members: {\n    _getExportMenuOptions() {\n      return extend({}, this._getOption(\"export\"), {\n        rtl: this._getOption(\"rtlEnabled\", true)\n      });\n    },\n\n    _disablePointerEvents() {\n      var pointerEventsValue = this._renderer.root.attr(\"pointer-events\");\n\n      this._renderer.root.attr({\n        \"pointer-events\": \"none\"\n      });\n\n      return pointerEventsValue;\n    },\n\n    exportTo(fileName, format) {\n      var menu = this._exportMenu;\n      var options = getExportOptions(this, this._getOption(\"export\") || {}, fileName, format);\n      menu && menu.hide();\n\n      var pointerEventsValue = this._disablePointerEvents();\n\n      var promise = _export(this._renderer.root.element, options, getCreatorFunc(options.format)).fail(logger.error).always(() => {\n        this._renderer.root.attr({\n          \"pointer-events\": pointerEventsValue\n        });\n      });\n\n      menu && menu.show();\n      return promise;\n    },\n\n    print() {\n      var menu = this._exportMenu;\n      var options = getExportOptions(this, this._getOption(\"export\") || {});\n      options.exportingAction = null;\n      options.exportedAction = null;\n      options.margin = 0;\n      options.format = \"PNG\";\n      options.forceProxy = true;\n\n      options.fileSavingAction = eventArgs => {\n        print(\"data:image/png;base64,\".concat(eventArgs.data), {\n          __test: options.__test\n        });\n        eventArgs.cancel = true;\n      };\n\n      var pointerEventsValue = this._disablePointerEvents();\n\n      menu && menu.hide();\n\n      var promise = _export(this._renderer.root.element, options, getCreatorFunc(options.format)).fail(logger.error).always(() => {\n        this._renderer.root.attr({\n          \"pointer-events\": pointerEventsValue\n        });\n      });\n\n      menu && menu.show();\n      return promise;\n    }\n\n  },\n\n  customize(constructor) {\n    var proto = constructor.prototype;\n    constructor.addChange({\n      code: \"EXPORT\",\n\n      handler() {\n        this._exportMenu.setOptions(this._getExportMenuOptions());\n\n        this._change([\"LAYOUT\"]);\n      },\n\n      isThemeDependent: true,\n      isOptionChange: true,\n      option: \"export\"\n    });\n    proto._optionChangesMap.onExporting = \"EXPORT\";\n    proto._optionChangesMap.onExported = \"EXPORT\";\n    proto._optionChangesMap.onFileSaving = \"EXPORT\";\n  },\n\n  fontFields: [\"export.font\"]\n};","map":{"version":3,"sources":["/Users/rahulsharma/node_modules/devextreme/esm/viz/core/export.js"],"names":["extend","getWindow","patchFontOptions","HIDDEN_FOR_EXPORT","export","_export","image","imageExporter","svg","svgExporter","pdf","pdfExporter","messageLocalization","isDefined","getTheme","start","hoverEventStart","end","hoverEventEnd","pointerEvents","logger","pointerActions","down","move","join","BUTTON_SIZE","ICON_COORDS","LIST_PADDING_TOP","LIST_WIDTH","VERTICAL_TEXT_MARGIN","HORIZONTAL_TEXT_MARGIN","MENU_ITEM_HEIGHT","LIST_STROKE_WIDTH","MARGIN","SHADOW_OFFSET","SHADOW_BLUR","DEFAULT_EXPORT_FORMAT","ALLOWED_IMAGE_FORMATS","ALLOWED_EXTRA_FORMATS","EXPORT_CSS_CLASS","EXPORT_DATA_KEY","FORMAT_DATA_KEY","GET_COLOR_REGEX","getValidFormats","imageFormats","testFormats","unsupported","supported","concat","validateFormat","format","incidentOccurred","validFormats","String","toUpperCase","indexOf","getCreatorFunc","getData","print","imageSrc","options","document","iFrame","createElement","onload","setPrint","style","position","width","height","right","bottom","body","appendChild","window","contentWindow","img","removeFrame","parentElement","removeChild","addEventListener","focus","setTimeout","src","getItemAttributes","type","itemIndex","x","y","attr","rect","text","rtl","separator","stroke","button","default","borderColor","cursor","sharp","d","createMenuItem","renderer","settings","itemData","fontStyle","font","menuItem","g","class","css","data","on","fill","hover","backgroundColor","append","path","resetState","fixPosition","textBBox","getBBox","createMenuItems","items","printingEnabled","push","length","formats","reduce","r","getFormatter","getBackgroundColorFromMarkup","markup","parsedMarkup","exec","exportFromMarkup","fileName","exportingAction","onExporting","exportedAction","onExported","fileSavingAction","onFileSaving","margin","getMarkup","widgets","combineMarkups","exportWidgets","markupInfo","gridLayout","verticalAlignment","horizontalAlignment","arguments","Array","isArray","map","item","compactView","exportItems","row","rowIndex","rowInfo","colIndex","size","getSize","option","backgroundColors","hOffset","Math","max","itemWidth","c","rowOffsets","totalHeight","rowHeights","maxItemLen","totalWidth","getVOffset","align","dy","getHOffset","colWidth","dx","ExportMenu","params","_renderer","_incidentOccurred","_exportTo","exportTo","_print","_shadow","shadowFilter","opacity","_group","linkOn","root","name","after","_buttonGroup","_listGroup","_overlay","rx","ry","filter","id","_subscribeEvents","prototype","getLayoutOptions","_hiddenDueToLayout","cutSide","cutLayoutSide","bBox","vertical","horizontal","shift","_","translateY","draw","canvas","left","floor","layoutOptions","freeSpace","show","linkAppend","hide","linkRemove","setOptions","_options","slice","enabled","_updateButton","_updateList","_hideList","dispose","_unsubscribeEvents","linkOff","weak","measure","_fillSpace","top","translateX","round","remove","_listShown","_setButtonState","_menuItems","forEach","_showList","state","_button","_icon","color","up","e","elementType","target","stopPropagation","enter","leave","off","exportData","setTitle","buttonDefault","listGroup","shadowColor","clear","getExportOptions","widget","exportOptions","pixelRatio","devicePixelRatio","proxyUrl","svgToCanvas","forceProxy","_createActionByOption","plugin","init","_exportMenu","_layout","add","members","_getExportMenuOptions","_getOption","_disablePointerEvents","pointerEventsValue","menu","promise","element","fail","error","always","eventArgs","__test","cancel","customize","constructor","proto","addChange","code","handler","_change","isThemeDependent","isOptionChange","_optionChangesMap","fontFields"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/viz/core/export.js)\r\n * Version: 21.2.3\r\n * Build date: Thu Oct 28 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    getWindow\r\n} from \"../../core/utils/window\";\r\nimport {\r\n    patchFontOptions\r\n} from \"./utils\";\r\nimport {\r\n    HIDDEN_FOR_EXPORT\r\n} from \"../../core/utils/svg\";\r\nimport {\r\n    export as _export,\r\n    image as imageExporter,\r\n    svg as svgExporter,\r\n    pdf as pdfExporter\r\n} from \"../../exporter\";\r\nimport messageLocalization from \"../../localization/message\";\r\nimport {\r\n    isDefined\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    getTheme\r\n} from \"../themes\";\r\nimport {\r\n    start as hoverEventStart,\r\n    end as hoverEventEnd\r\n} from \"../../events/hover\";\r\nimport pointerEvents from \"../../events/pointer\";\r\nimport {\r\n    logger\r\n} from \"../../core/utils/console\";\r\nvar pointerActions = [pointerEvents.down, pointerEvents.move].join(\" \");\r\nvar BUTTON_SIZE = 35;\r\nvar ICON_COORDS = [\r\n    [9, 12, 26, 12, 26, 14, 9, 14],\r\n    [9, 17, 26, 17, 26, 19, 9, 19],\r\n    [9, 22, 26, 22, 26, 24, 9, 24]\r\n];\r\nvar LIST_PADDING_TOP = 4;\r\nvar LIST_WIDTH = 120;\r\nvar VERTICAL_TEXT_MARGIN = 8;\r\nvar HORIZONTAL_TEXT_MARGIN = 15;\r\nvar MENU_ITEM_HEIGHT = 30;\r\nvar LIST_STROKE_WIDTH = 1;\r\nvar MARGIN = 10;\r\nvar SHADOW_OFFSET = 2;\r\nvar SHADOW_BLUR = 3;\r\nvar DEFAULT_EXPORT_FORMAT = \"PNG\";\r\nvar ALLOWED_IMAGE_FORMATS = [DEFAULT_EXPORT_FORMAT, \"JPEG\", \"GIF\"];\r\nvar ALLOWED_EXTRA_FORMATS = [\"PDF\", \"SVG\"];\r\nvar EXPORT_CSS_CLASS = \"dx-export-menu\";\r\nvar EXPORT_DATA_KEY = \"export-element-type\";\r\nvar FORMAT_DATA_KEY = \"export-element-format\";\r\nvar GET_COLOR_REGEX = /data-backgroundcolor=\"([^\"]*)\"/;\r\n\r\nfunction getValidFormats() {\r\n    var imageFormats = imageExporter.testFormats(ALLOWED_IMAGE_FORMATS);\r\n    return {\r\n        unsupported: imageFormats.unsupported,\r\n        supported: imageFormats.supported.concat(ALLOWED_EXTRA_FORMATS)\r\n    }\r\n}\r\n\r\nfunction validateFormat(format, incidentOccurred, validFormats) {\r\n    validFormats = validFormats || getValidFormats();\r\n    format = String(format).toUpperCase();\r\n    if (-1 !== validFormats.supported.indexOf(format)) {\r\n        return format\r\n    }\r\n    if (-1 !== validFormats.unsupported.indexOf(format)) {\r\n        incidentOccurred && incidentOccurred(\"W2108\", [format])\r\n    }\r\n}\r\n\r\nfunction getCreatorFunc(format) {\r\n    if (\"SVG\" === format) {\r\n        return svgExporter.getData\r\n    } else if (\"PDF\" === format) {\r\n        return pdfExporter.getData\r\n    } else {\r\n        return imageExporter.getData\r\n    }\r\n}\r\n\r\nfunction print(imageSrc, options) {\r\n    var document = getWindow().document;\r\n    var iFrame = document.createElement(\"iframe\");\r\n    iFrame.onload = setPrint(imageSrc, options);\r\n    iFrame.style.position = \"fixed\";\r\n    iFrame.style.width = \"0\";\r\n    iFrame.style.height = \"0\";\r\n    iFrame.style.right = \"0\";\r\n    iFrame.style.bottom = \"0\";\r\n    document.body.appendChild(iFrame)\r\n}\r\n\r\nfunction setPrint(imageSrc, options) {\r\n    return function() {\r\n        var window = this.contentWindow;\r\n        var img = window.document.createElement(\"img\");\r\n        window.document.body.appendChild(img);\r\n        var removeFrame = () => {\r\n            this.parentElement.removeChild(this)\r\n        };\r\n        img.addEventListener(\"load\", () => {\r\n            window.focus();\r\n            window.print()\r\n        });\r\n        img.addEventListener(\"error\", removeFrame);\r\n        window.addEventListener(\"afterprint\", () => {\r\n            setTimeout(removeFrame, 0)\r\n        });\r\n        img.src = imageSrc\r\n    }\r\n}\r\n\r\nfunction getItemAttributes(options, type, itemIndex) {\r\n    var x = BUTTON_SIZE - LIST_WIDTH;\r\n    var y = BUTTON_SIZE + LIST_PADDING_TOP + LIST_STROKE_WIDTH + itemIndex * MENU_ITEM_HEIGHT;\r\n    var attr = {\r\n        rect: {\r\n            width: LIST_WIDTH - 2 * LIST_STROKE_WIDTH,\r\n            height: MENU_ITEM_HEIGHT,\r\n            x: x + LIST_STROKE_WIDTH,\r\n            y: y\r\n        },\r\n        text: {\r\n            x: x + (options.rtl ? LIST_WIDTH - HORIZONTAL_TEXT_MARGIN : HORIZONTAL_TEXT_MARGIN),\r\n            y: y + MENU_ITEM_HEIGHT - VERTICAL_TEXT_MARGIN\r\n        }\r\n    };\r\n    if (\"printing\" === type) {\r\n        attr.separator = {\r\n            stroke: options.button.default.borderColor,\r\n            \"stroke-width\": LIST_STROKE_WIDTH,\r\n            cursor: \"pointer\",\r\n            sharp: \"v\",\r\n            d: \"M \" + x + \" \" + (y + MENU_ITEM_HEIGHT - LIST_STROKE_WIDTH) + \" L \" + (x + LIST_WIDTH) + \" \" + (y + MENU_ITEM_HEIGHT - LIST_STROKE_WIDTH)\r\n        }\r\n    }\r\n    return attr\r\n}\r\n\r\nfunction createMenuItem(renderer, options, settings) {\r\n    var itemData = {};\r\n    var type = settings.type;\r\n    var format = settings.format;\r\n    var attr = getItemAttributes(options, type, settings.itemIndex);\r\n    var fontStyle = patchFontOptions(options.font);\r\n    fontStyle[\"pointer-events\"] = \"none\";\r\n    var menuItem = renderer.g().attr({\r\n        class: EXPORT_CSS_CLASS + \"-list-item\"\r\n    });\r\n    itemData[EXPORT_DATA_KEY] = type;\r\n    if (format) {\r\n        itemData[FORMAT_DATA_KEY] = format\r\n    }\r\n    var rect = renderer.rect();\r\n    rect.attr(attr.rect).css({\r\n        cursor: \"pointer\",\r\n        \"pointer-events\": \"all\"\r\n    }).data(itemData);\r\n    rect.on(hoverEventStart + \".export\", () => rect.attr({\r\n        fill: options.button.hover.backgroundColor\r\n    })).on(hoverEventEnd + \".export\", () => rect.attr({\r\n        fill: null\r\n    }));\r\n    rect.append(menuItem);\r\n    var text = renderer.text(settings.text).css(fontStyle).attr(attr.text).append(menuItem);\r\n    if (\"printing\" === type) {\r\n        renderer.path(null, \"line\").attr(attr.separator).append(menuItem)\r\n    }\r\n    return {\r\n        g: menuItem,\r\n        rect: rect,\r\n        resetState: () => rect.attr({\r\n            fill: null\r\n        }),\r\n        fixPosition: () => {\r\n            var textBBox = text.getBBox();\r\n            text.move(attr.text.x - textBBox.x - (options.rtl ? textBBox.width : 0))\r\n        }\r\n    }\r\n}\r\n\r\nfunction createMenuItems(renderer, options) {\r\n    var items = [];\r\n    if (options.printingEnabled) {\r\n        items.push(createMenuItem(renderer, options, {\r\n            type: \"printing\",\r\n            text: messageLocalization.format(\"vizExport-printingButtonText\"),\r\n            itemIndex: items.length\r\n        }))\r\n    }\r\n    items = options.formats.reduce((r, format) => {\r\n        r.push(createMenuItem(renderer, options, {\r\n            type: \"exporting\",\r\n            text: messageLocalization.getFormatter(\"vizExport-exportButtonText\")(format),\r\n            format: format,\r\n            itemIndex: r.length\r\n        }));\r\n        return r\r\n    }, items);\r\n    return items\r\n}\r\n\r\nfunction getBackgroundColorFromMarkup(markup) {\r\n    var parsedMarkup = GET_COLOR_REGEX.exec(markup);\r\n    return null === parsedMarkup || void 0 === parsedMarkup ? void 0 : parsedMarkup[1]\r\n}\r\nexport var exportFromMarkup = function(markup, options) {\r\n    options.format = validateFormat(options.format) || DEFAULT_EXPORT_FORMAT;\r\n    options.fileName = options.fileName || \"file\";\r\n    options.exportingAction = options.onExporting;\r\n    options.exportedAction = options.onExported;\r\n    options.fileSavingAction = options.onFileSaving;\r\n    options.margin = isDefined(options.margin) ? options.margin : MARGIN;\r\n    options.backgroundColor = isDefined(options.backgroundColor) ? options.backgroundColor : getBackgroundColorFromMarkup(markup) || getTheme().backgroundColor;\r\n    _export(markup, options, getCreatorFunc(options.format))\r\n};\r\nexport var getMarkup = widgets => combineMarkups(widgets).markup;\r\nexport var exportWidgets = function(widgets, options) {\r\n    options = options || {};\r\n    var markupInfo = combineMarkups(widgets, {\r\n        gridLayout: options.gridLayout,\r\n        verticalAlignment: options.verticalAlignment,\r\n        horizontalAlignment: options.horizontalAlignment\r\n    });\r\n    options.width = markupInfo.width;\r\n    options.height = markupInfo.height;\r\n    exportFromMarkup(markupInfo.markup, options)\r\n};\r\nexport var combineMarkups = function(widgets) {\r\n    var options = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};\r\n    if (!Array.isArray(widgets)) {\r\n        widgets = [\r\n            [widgets]\r\n        ]\r\n    } else if (!Array.isArray(widgets[0])) {\r\n        widgets = widgets.map(item => [item])\r\n    }\r\n    var compactView = !options.gridLayout;\r\n    var exportItems = widgets.reduce((r, row, rowIndex) => {\r\n        var rowInfo = row.reduce((r, item, colIndex) => {\r\n            var size = item.getSize();\r\n            var backgroundColor = item.option(\"backgroundColor\") || getTheme(item.option(\"theme\")).backgroundColor;\r\n            backgroundColor && -1 === r.backgroundColors.indexOf(backgroundColor) && r.backgroundColors.push(backgroundColor);\r\n            r.hOffset = r.width;\r\n            r.width += size.width;\r\n            r.height = Math.max(r.height, size.height);\r\n            r.itemWidth = Math.max(r.itemWidth, size.width);\r\n            r.items.push({\r\n                markup: item.svg(),\r\n                width: size.width,\r\n                height: size.height,\r\n                c: colIndex,\r\n                r: rowIndex,\r\n                hOffset: r.hOffset\r\n            });\r\n            return r\r\n        }, {\r\n            items: [],\r\n            height: 0,\r\n            itemWidth: 0,\r\n            hOffset: 0,\r\n            width: 0,\r\n            backgroundColors: r.backgroundColors\r\n        });\r\n        r.rowOffsets.push(r.totalHeight);\r\n        r.rowHeights.push(rowInfo.height);\r\n        r.totalHeight += rowInfo.height;\r\n        r.items = r.items.concat(rowInfo.items);\r\n        r.itemWidth = Math.max(r.itemWidth, rowInfo.itemWidth);\r\n        r.maxItemLen = Math.max(r.maxItemLen, rowInfo.items.length);\r\n        r.totalWidth = compactView ? Math.max(r.totalWidth, rowInfo.width) : r.maxItemLen * r.itemWidth;\r\n        return r\r\n    }, {\r\n        items: [],\r\n        rowOffsets: [],\r\n        rowHeights: [],\r\n        itemWidth: 0,\r\n        totalHeight: 0,\r\n        maxItemLen: 0,\r\n        totalWidth: 0,\r\n        backgroundColors: []\r\n    });\r\n    var backgroundColor = 'data-backgroundcolor=\"'.concat(1 === exportItems.backgroundColors.length ? exportItems.backgroundColors[0] : \"\", '\" ');\r\n    var getVOffset = item => {\r\n        var align = options.verticalAlignment;\r\n        var dy = exportItems.rowHeights[item.r] - item.height;\r\n        return exportItems.rowOffsets[item.r] + (\"bottom\" === align ? dy : \"center\" === align ? dy / 2 : 0)\r\n    };\r\n    var getHOffset = item => {\r\n        if (compactView) {\r\n            return item.hOffset\r\n        }\r\n        var align = options.horizontalAlignment;\r\n        var colWidth = exportItems.itemWidth;\r\n        var dx = colWidth - item.width;\r\n        return item.c * colWidth + (\"right\" === align ? dx : \"center\" === align ? dx / 2 : 0)\r\n    };\r\n    var totalHeight = exportItems.totalHeight;\r\n    var totalWidth = exportItems.totalWidth;\r\n    return {\r\n        markup: \"<svg \" + backgroundColor + 'height=\"' + totalHeight + '\" width=\"' + totalWidth + '\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">' + exportItems.items.map(item => '<g transform=\"translate('.concat(getHOffset(item), \",\").concat(getVOffset(item), ')\">').concat(item.markup, \"</g>\")).join(\"\") + \"</svg>\",\r\n        width: totalWidth,\r\n        height: totalHeight\r\n    }\r\n};\r\nexport var ExportMenu = function(params) {\r\n    var renderer = this._renderer = params.renderer;\r\n    this._incidentOccurred = params.incidentOccurred;\r\n    this._exportTo = params.exportTo;\r\n    this._print = params.print;\r\n    this._shadow = renderer.shadowFilter(\"-50%\", \"-50%\", \"200%\", \"200%\", SHADOW_OFFSET, 6, SHADOW_BLUR);\r\n    this._shadow.attr({\r\n        opacity: .8\r\n    });\r\n    this._group = renderer.g().attr({\r\n        class: EXPORT_CSS_CLASS,\r\n        [HIDDEN_FOR_EXPORT]: true\r\n    }).linkOn(renderer.root, {\r\n        name: \"export-menu\",\r\n        after: \"peripheral\"\r\n    });\r\n    this._buttonGroup = renderer.g().attr({\r\n        class: EXPORT_CSS_CLASS + \"-button\"\r\n    }).append(this._group);\r\n    this._listGroup = renderer.g().attr({\r\n        class: EXPORT_CSS_CLASS + \"-list\"\r\n    }).append(this._group);\r\n    this._overlay = renderer.rect(-LIST_WIDTH + BUTTON_SIZE, BUTTON_SIZE + LIST_PADDING_TOP, LIST_WIDTH, 0);\r\n    this._overlay.attr({\r\n        \"stroke-width\": LIST_STROKE_WIDTH,\r\n        cursor: \"pointer\",\r\n        rx: 4,\r\n        ry: 4,\r\n        filter: this._shadow.id\r\n    });\r\n    this._overlay.data({\r\n        \"export-element-type\": \"list\"\r\n    });\r\n    this.validFormats = getValidFormats();\r\n    this._subscribeEvents()\r\n};\r\nextend(ExportMenu.prototype, {\r\n    getLayoutOptions() {\r\n        if (this._hiddenDueToLayout) {\r\n            return {\r\n                width: 0,\r\n                height: 0,\r\n                cutSide: \"vertical\",\r\n                cutLayoutSide: \"top\"\r\n            }\r\n        }\r\n        var bBox = this._buttonGroup.getBBox();\r\n        bBox.cutSide = \"vertical\";\r\n        bBox.cutLayoutSide = \"top\";\r\n        bBox.height += MARGIN;\r\n        bBox.position = {\r\n            vertical: \"top\",\r\n            horizontal: \"right\"\r\n        };\r\n        bBox.verticalAlignment = \"top\";\r\n        bBox.horizontalAlignment = \"right\";\r\n        return bBox\r\n    },\r\n    shift(_, y) {\r\n        this._group.attr({\r\n            translateY: this._group.attr(\"translateY\") + y\r\n        })\r\n    },\r\n    draw(width, height, canvas) {\r\n        this._group.move(width - BUTTON_SIZE - SHADOW_OFFSET - SHADOW_BLUR + canvas.left, Math.floor(height / 2 - BUTTON_SIZE / 2));\r\n        var layoutOptions = this.getLayoutOptions();\r\n        if (layoutOptions.width > width || layoutOptions.height > height) {\r\n            this.freeSpace()\r\n        }\r\n        return this\r\n    },\r\n    show() {\r\n        this._group.linkAppend()\r\n    },\r\n    hide() {\r\n        this._group.linkRemove()\r\n    },\r\n    setOptions(options) {\r\n        this._options = options;\r\n        if (options.formats) {\r\n            options.formats = options.formats.reduce((r, format) => {\r\n                format = validateFormat(format, this._incidentOccurred, this.validFormats);\r\n                format && r.push(format);\r\n                return r\r\n            }, [])\r\n        } else {\r\n            options.formats = this.validFormats.supported.slice()\r\n        }\r\n        options.printingEnabled = void 0 === options.printingEnabled ? true : options.printingEnabled;\r\n        if (options.enabled && (options.formats.length || options.printingEnabled)) {\r\n            this.show();\r\n            this._updateButton();\r\n            this._updateList();\r\n            this._hideList()\r\n        } else {\r\n            this.hide()\r\n        }\r\n    },\r\n    dispose() {\r\n        this._unsubscribeEvents();\r\n        this._group.linkRemove().linkOff();\r\n        this._group.dispose();\r\n        this._shadow.dispose()\r\n    },\r\n    layoutOptions() {\r\n        return this._options.enabled && {\r\n            horizontalAlignment: \"right\",\r\n            verticalAlignment: \"top\",\r\n            weak: true\r\n        }\r\n    },\r\n    measure() {\r\n        this._fillSpace();\r\n        var margin = this._options.button.margin;\r\n        return [BUTTON_SIZE + margin.left + margin.right, BUTTON_SIZE + margin.top + margin.bottom]\r\n    },\r\n    move(rect) {\r\n        var margin = this._options.button.margin;\r\n        this._group.attr({\r\n            translateX: Math.round(rect[0]) + margin.left,\r\n            translateY: Math.round(rect[1]) + margin.top\r\n        })\r\n    },\r\n    _fillSpace() {\r\n        this._hiddenDueToLayout = false;\r\n        this.show()\r\n    },\r\n    freeSpace() {\r\n        this._incidentOccurred(\"W2107\");\r\n        this._hiddenDueToLayout = true;\r\n        this.hide()\r\n    },\r\n    _hideList() {\r\n        this._listGroup.remove();\r\n        this._listShown = false;\r\n        this._setButtonState(\"default\");\r\n        this._menuItems.forEach(item => item.resetState())\r\n    },\r\n    _showList() {\r\n        this._listGroup.append(this._group);\r\n        this._listShown = true;\r\n        this._menuItems.forEach(item => item.fixPosition())\r\n    },\r\n    _setButtonState(state) {\r\n        var style = this._options.button[state];\r\n        this._button.attr({\r\n            stroke: style.borderColor,\r\n            fill: style.backgroundColor\r\n        });\r\n        this._icon.attr({\r\n            fill: style.color\r\n        })\r\n    },\r\n    _subscribeEvents() {\r\n        this._renderer.root.on(pointerEvents.up + \".export\", e => {\r\n            var elementType = e.target[EXPORT_DATA_KEY];\r\n            if (!elementType) {\r\n                if (this._button) {\r\n                    this._hideList()\r\n                }\r\n                return\r\n            }\r\n            if (\"button\" === elementType) {\r\n                if (this._listShown) {\r\n                    this._setButtonState(\"default\");\r\n                    this._hideList()\r\n                } else {\r\n                    this._setButtonState(\"focus\");\r\n                    this._showList()\r\n                }\r\n            } else if (\"printing\" === elementType) {\r\n                this._print();\r\n                this._hideList()\r\n            } else if (\"exporting\" === elementType) {\r\n                this._exportTo(e.target[FORMAT_DATA_KEY]);\r\n                this._hideList()\r\n            }\r\n        });\r\n        this._listGroup.on(pointerActions, e => e.stopPropagation());\r\n        this._buttonGroup.on(pointerEvents.enter, () => this._setButtonState(\"hover\"));\r\n        this._buttonGroup.on(pointerEvents.leave, () => this._setButtonState(this._listShown ? \"focus\" : \"default\"));\r\n        this._buttonGroup.on(pointerEvents.down + \".export\", () => this._setButtonState(\"active\"))\r\n    },\r\n    _unsubscribeEvents() {\r\n        this._renderer.root.off(\".export\");\r\n        this._listGroup.off();\r\n        this._buttonGroup.off()\r\n    },\r\n    _updateButton() {\r\n        var renderer = this._renderer;\r\n        var options = this._options;\r\n        var exportData = {\r\n            \"export-element-type\": \"button\"\r\n        };\r\n        if (!this._button) {\r\n            this._button = renderer.rect(0, 0, BUTTON_SIZE, BUTTON_SIZE).append(this._buttonGroup);\r\n            this._button.attr({\r\n                rx: 4,\r\n                ry: 4,\r\n                fill: options.button.default.backgroundColor,\r\n                stroke: options.button.default.borderColor,\r\n                \"stroke-width\": 1,\r\n                cursor: \"pointer\"\r\n            });\r\n            this._button.data(exportData);\r\n            this._icon = renderer.path(ICON_COORDS).append(this._buttonGroup);\r\n            this._icon.attr({\r\n                fill: options.button.default.color,\r\n                cursor: \"pointer\"\r\n            });\r\n            this._icon.data(exportData);\r\n            this._buttonGroup.setTitle(messageLocalization.format(\"vizExport-titleMenuText\"))\r\n        }\r\n    },\r\n    _updateList() {\r\n        var options = this._options;\r\n        var buttonDefault = options.button.default;\r\n        var listGroup = this._listGroup;\r\n        var items = createMenuItems(this._renderer, options);\r\n        this._shadow.attr({\r\n            color: options.shadowColor\r\n        });\r\n        this._overlay.attr({\r\n            height: items.length * MENU_ITEM_HEIGHT + 2 * LIST_STROKE_WIDTH,\r\n            fill: buttonDefault.backgroundColor,\r\n            stroke: buttonDefault.borderColor\r\n        });\r\n        listGroup.clear();\r\n        this._overlay.append(listGroup);\r\n        items.forEach(item => item.g.append(listGroup));\r\n        this._menuItems = items\r\n    }\r\n});\r\n\r\nfunction getExportOptions(widget, exportOptions, fileName, format) {\r\n    if (format || exportOptions.format) {\r\n        format = validateFormat(format || exportOptions.format, widget._incidentOccurred)\r\n    }\r\n    var {\r\n        width: width,\r\n        height: height\r\n    } = widget.getSize();\r\n    var pixelRatio = getWindow().devicePixelRatio || 1;\r\n    return {\r\n        format: format || DEFAULT_EXPORT_FORMAT,\r\n        fileName: fileName || exportOptions.fileName || \"file\",\r\n        proxyUrl: exportOptions.proxyUrl,\r\n        backgroundColor: exportOptions.backgroundColor,\r\n        width: width * pixelRatio,\r\n        height: height * pixelRatio,\r\n        pixelRatio: pixelRatio,\r\n        margin: exportOptions.margin,\r\n        svgToCanvas: exportOptions.svgToCanvas,\r\n        forceProxy: exportOptions.forceProxy,\r\n        exportingAction: widget._createActionByOption(\"onExporting\"),\r\n        exportedAction: widget._createActionByOption(\"onExported\"),\r\n        fileSavingAction: widget._createActionByOption(\"onFileSaving\")\r\n    }\r\n}\r\nexport var plugin = {\r\n    name: \"export\",\r\n    init() {\r\n        this._exportMenu = new ExportMenu({\r\n            renderer: this._renderer,\r\n            incidentOccurred: this._incidentOccurred,\r\n            print: () => this.print(),\r\n            exportTo: format => this.exportTo(void 0, format)\r\n        });\r\n        this._layout.add(this._exportMenu)\r\n    },\r\n    dispose() {\r\n        this._exportMenu.dispose()\r\n    },\r\n    members: {\r\n        _getExportMenuOptions() {\r\n            return extend({}, this._getOption(\"export\"), {\r\n                rtl: this._getOption(\"rtlEnabled\", true)\r\n            })\r\n        },\r\n        _disablePointerEvents() {\r\n            var pointerEventsValue = this._renderer.root.attr(\"pointer-events\");\r\n            this._renderer.root.attr({\r\n                \"pointer-events\": \"none\"\r\n            });\r\n            return pointerEventsValue\r\n        },\r\n        exportTo(fileName, format) {\r\n            var menu = this._exportMenu;\r\n            var options = getExportOptions(this, this._getOption(\"export\") || {}, fileName, format);\r\n            menu && menu.hide();\r\n            var pointerEventsValue = this._disablePointerEvents();\r\n            var promise = _export(this._renderer.root.element, options, getCreatorFunc(options.format)).fail(logger.error).always(() => {\r\n                this._renderer.root.attr({\r\n                    \"pointer-events\": pointerEventsValue\r\n                })\r\n            });\r\n            menu && menu.show();\r\n            return promise\r\n        },\r\n        print() {\r\n            var menu = this._exportMenu;\r\n            var options = getExportOptions(this, this._getOption(\"export\") || {});\r\n            options.exportingAction = null;\r\n            options.exportedAction = null;\r\n            options.margin = 0;\r\n            options.format = \"PNG\";\r\n            options.forceProxy = true;\r\n            options.fileSavingAction = eventArgs => {\r\n                print(\"data:image/png;base64,\".concat(eventArgs.data), {\r\n                    __test: options.__test\r\n                });\r\n                eventArgs.cancel = true\r\n            };\r\n            var pointerEventsValue = this._disablePointerEvents();\r\n            menu && menu.hide();\r\n            var promise = _export(this._renderer.root.element, options, getCreatorFunc(options.format)).fail(logger.error).always(() => {\r\n                this._renderer.root.attr({\r\n                    \"pointer-events\": pointerEventsValue\r\n                })\r\n            });\r\n            menu && menu.show();\r\n            return promise\r\n        }\r\n    },\r\n    customize(constructor) {\r\n        var proto = constructor.prototype;\r\n        constructor.addChange({\r\n            code: \"EXPORT\",\r\n            handler() {\r\n                this._exportMenu.setOptions(this._getExportMenuOptions());\r\n                this._change([\"LAYOUT\"])\r\n            },\r\n            isThemeDependent: true,\r\n            isOptionChange: true,\r\n            option: \"export\"\r\n        });\r\n        proto._optionChangesMap.onExporting = \"EXPORT\";\r\n        proto._optionChangesMap.onExported = \"EXPORT\";\r\n        proto._optionChangesMap.onFileSaving = \"EXPORT\"\r\n    },\r\n    fontFields: [\"export.font\"]\r\n};\r\n"]},"metadata":{},"sourceType":"module"}