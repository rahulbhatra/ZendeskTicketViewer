{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.editor_factory.js)\r\n * Version: 21.2.3\r\n * Build date: Thu Oct 28 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { setOuterWidth, getOuterWidth, setOuterHeight, getOuterHeight } from \"../../core/utils/size\";\nimport $ from \"../../core/renderer\";\nimport domAdapter from \"../../core/dom_adapter\";\nimport eventsEngine from \"../../events/core/events_engine\";\nimport modules from \"./ui.grid_core.modules\";\nimport { name as clickEventName } from \"../../events/click\";\nimport pointerEvents from \"../../events/pointer\";\nimport positionUtils from \"../../animation/position\";\nimport { addNamespace, normalizeKeyName } from \"../../events/utils/index\";\nimport browser from \"../../core/utils/browser\";\nimport { extend } from \"../../core/utils/extend\";\nimport { getBoundingRect } from \"../../core/utils/position\";\nimport EditorFactoryMixin from \"../shared/ui.editor_factory_mixin\";\nimport gridCoreUtils from \"./ui.grid_core.utils\";\nvar EDITOR_INLINE_BLOCK = \"dx-editor-inline-block\";\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\nvar FOCUS_OVERLAY_CLASS = \"focus-overlay\";\nvar CONTENT_CLASS = \"content\";\nvar FOCUSED_ELEMENT_CLASS = \"dx-focused\";\nvar ROW_CLASS = \"dx-row\";\nvar MODULE_NAMESPACE = \"dxDataGridEditorFactory\";\nvar UPDATE_FOCUS_EVENTS = addNamespace([pointerEvents.down, \"focusin\", clickEventName].join(\" \"), MODULE_NAMESPACE);\nvar DX_HIDDEN = \"dx-hidden\";\nvar EditorFactory = modules.ViewController.inherit({\n  _getFocusedElement: function ($dataGridElement) {\n    var rowSelector = this.option(\"focusedRowEnabled\") ? \"tr[tabindex]:focus\" : \"tr[tabindex]:not(.dx-data-row):focus\";\n    var focusedElementSelector = \"td[tabindex]:focus, \".concat(rowSelector, \", input:focus, textarea:focus, .dx-lookup-field:focus, .dx-checkbox:focus, .dx-switch:focus, .dx-dropdownbutton .dx-buttongroup:focus\");\n    return $dataGridElement.find(focusedElementSelector);\n  },\n  _getFocusCellSelector: function () {\n    return \".dx-row > td\";\n  },\n  _updateFocusCore: function () {\n    var $focus = this._$focusedElement;\n    var $dataGridElement = this.component && this.component.$element();\n    var $focusCell;\n    var hideBorders;\n\n    if ($dataGridElement) {\n      $focus = this._getFocusedElement($dataGridElement);\n\n      if ($focus.length) {\n        if (!$focus.hasClass(CELL_FOCUS_DISABLED_CLASS) && !$focus.hasClass(ROW_CLASS)) {\n          $focusCell = $focus.closest(this._getFocusCellSelector() + \", .\" + CELL_FOCUS_DISABLED_CLASS);\n          hideBorders = $focusCell.get(0) !== $focus.get(0) && $focusCell.hasClass(EDITOR_INLINE_BLOCK);\n          $focus = $focusCell;\n        }\n\n        if ($focus.length && !$focus.hasClass(CELL_FOCUS_DISABLED_CLASS)) {\n          this.focus($focus, hideBorders);\n          return;\n        }\n      }\n    }\n\n    this.loseFocus();\n  },\n  _updateFocus: function (e) {\n    var that = this;\n    var isFocusOverlay = e && e.event && $(e.event.target).hasClass(that.addWidgetPrefix(FOCUS_OVERLAY_CLASS));\n    that._isFocusOverlay = that._isFocusOverlay || isFocusOverlay;\n    clearTimeout(that._updateFocusTimeoutID);\n    that._updateFocusTimeoutID = setTimeout(function () {\n      delete that._updateFocusTimeoutID;\n\n      if (!that._isFocusOverlay) {\n        that._updateFocusCore();\n      }\n\n      that._isFocusOverlay = false;\n    });\n  },\n  _updateFocusOverlaySize: function ($element, position) {\n    $element.hide();\n    var location = positionUtils.calculate($element, extend({\n      collision: \"fit\"\n    }, position));\n\n    if (location.h.oversize > 0) {\n      setOuterWidth($element, getOuterWidth($element) - location.h.oversize);\n    }\n\n    if (location.v.oversize > 0) {\n      setOuterHeight($element, getOuterHeight($element) - location.v.oversize);\n    }\n\n    $element.show();\n  },\n  callbackNames: function () {\n    return [\"focused\"];\n  },\n  focus: function ($element, hideBorder) {\n    var that = this;\n\n    if (void 0 === $element) {\n      return that._$focusedElement;\n    } else if ($element) {\n      if (!$element.is(that._$focusedElement)) {\n        that._$focusedElement && that._$focusedElement.removeClass(FOCUSED_ELEMENT_CLASS);\n      }\n\n      that._$focusedElement = $element;\n      clearTimeout(that._focusTimeoutID);\n      that._focusTimeoutID = setTimeout(function () {\n        delete that._focusTimeoutID;\n        that.renderFocusOverlay($element, hideBorder);\n        $element.addClass(FOCUSED_ELEMENT_CLASS);\n        that.focused.fire($element);\n      });\n    }\n  },\n  refocus: function () {\n    var $focus = this.focus();\n    this.focus($focus);\n  },\n  renderFocusOverlay: function ($element, hideBorder) {\n    if (!gridCoreUtils.isElementInCurrentGrid(this, $element)) {\n      return;\n    }\n\n    if (!this._$focusOverlay) {\n      this._$focusOverlay = $(\"<div>\").addClass(this.addWidgetPrefix(FOCUS_OVERLAY_CLASS));\n    }\n\n    if (hideBorder) {\n      this._$focusOverlay.addClass(DX_HIDDEN);\n    } else if ($element.length) {\n      var align = browser.mozilla ? \"right bottom\" : \"left top\";\n      var $content = $element.closest(\".\" + this.addWidgetPrefix(CONTENT_CLASS));\n      var elemCoord = getBoundingRect($element.get(0));\n\n      this._$focusOverlay.removeClass(DX_HIDDEN).appendTo($content);\n\n      setOuterHeight(this._$focusOverlay, elemCoord.bottom - elemCoord.top + 1);\n      setOuterWidth(this._$focusOverlay, elemCoord.right - elemCoord.left + 1);\n      var focusOverlayPosition = {\n        precise: true,\n        my: align,\n        at: align,\n        of: $element,\n        boundary: $content.length && $content\n      };\n\n      this._updateFocusOverlaySize(this._$focusOverlay, focusOverlayPosition);\n\n      positionUtils.setup(this._$focusOverlay, focusOverlayPosition);\n\n      this._$focusOverlay.css(\"visibility\", \"visible\");\n    }\n  },\n  resize: function () {\n    var $focusedElement = this._$focusedElement;\n\n    if ($focusedElement) {\n      this.focus($focusedElement);\n    }\n  },\n  loseFocus: function () {\n    this._$focusedElement && this._$focusedElement.removeClass(FOCUSED_ELEMENT_CLASS);\n    this._$focusedElement = null;\n    this._$focusOverlay && this._$focusOverlay.addClass(DX_HIDDEN);\n  },\n  init: function () {\n    this.createAction(\"onEditorPreparing\", {\n      excludeValidators: [\"disabled\", \"readOnly\"],\n      category: \"rendering\"\n    });\n    this.createAction(\"onEditorPrepared\", {\n      excludeValidators: [\"disabled\", \"readOnly\"],\n      category: \"rendering\"\n    });\n    this._updateFocusHandler = this._updateFocusHandler || this.createAction(this._updateFocus.bind(this));\n    eventsEngine.on(domAdapter.getDocument(), UPDATE_FOCUS_EVENTS, this._updateFocusHandler);\n\n    this._attachContainerEventHandlers();\n  },\n  _attachContainerEventHandlers: function () {\n    var that = this;\n    var $container = that.component && that.component.$element();\n\n    if ($container) {\n      eventsEngine.on($container, addNamespace(\"keydown\", MODULE_NAMESPACE), function (e) {\n        if (\"tab\" === normalizeKeyName(e)) {\n          that._updateFocusHandler(e);\n        }\n      });\n    }\n  },\n  dispose: function () {\n    clearTimeout(this._focusTimeoutID);\n    clearTimeout(this._updateFocusTimeoutID);\n    eventsEngine.off(domAdapter.getDocument(), UPDATE_FOCUS_EVENTS, this._updateFocusHandler);\n  }\n}).include(EditorFactoryMixin);\nexport var editorFactoryModule = {\n  defaultOptions: function () {\n    return {};\n  },\n  controllers: {\n    editorFactory: EditorFactory\n  }\n};","map":{"version":3,"sources":["/Users/rahulsharma/node_modules/devextreme/esm/ui/grid_core/ui.grid_core.editor_factory.js"],"names":["setOuterWidth","getOuterWidth","setOuterHeight","getOuterHeight","$","domAdapter","eventsEngine","modules","name","clickEventName","pointerEvents","positionUtils","addNamespace","normalizeKeyName","browser","extend","getBoundingRect","EditorFactoryMixin","gridCoreUtils","EDITOR_INLINE_BLOCK","CELL_FOCUS_DISABLED_CLASS","FOCUS_OVERLAY_CLASS","CONTENT_CLASS","FOCUSED_ELEMENT_CLASS","ROW_CLASS","MODULE_NAMESPACE","UPDATE_FOCUS_EVENTS","down","join","DX_HIDDEN","EditorFactory","ViewController","inherit","_getFocusedElement","$dataGridElement","rowSelector","option","focusedElementSelector","concat","find","_getFocusCellSelector","_updateFocusCore","$focus","_$focusedElement","component","$element","$focusCell","hideBorders","length","hasClass","closest","get","focus","loseFocus","_updateFocus","e","that","isFocusOverlay","event","target","addWidgetPrefix","_isFocusOverlay","clearTimeout","_updateFocusTimeoutID","setTimeout","_updateFocusOverlaySize","position","hide","location","calculate","collision","h","oversize","v","show","callbackNames","hideBorder","is","removeClass","_focusTimeoutID","renderFocusOverlay","addClass","focused","fire","refocus","isElementInCurrentGrid","_$focusOverlay","align","mozilla","$content","elemCoord","appendTo","bottom","top","right","left","focusOverlayPosition","precise","my","at","of","boundary","setup","css","resize","$focusedElement","init","createAction","excludeValidators","category","_updateFocusHandler","bind","on","getDocument","_attachContainerEventHandlers","$container","dispose","off","include","editorFactoryModule","defaultOptions","controllers","editorFactory"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.editor_factory.js)\r\n * Version: 21.2.3\r\n * Build date: Thu Oct 28 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    setOuterWidth,\r\n    getOuterWidth,\r\n    setOuterHeight,\r\n    getOuterHeight\r\n} from \"../../core/utils/size\";\r\nimport $ from \"../../core/renderer\";\r\nimport domAdapter from \"../../core/dom_adapter\";\r\nimport eventsEngine from \"../../events/core/events_engine\";\r\nimport modules from \"./ui.grid_core.modules\";\r\nimport {\r\n    name as clickEventName\r\n} from \"../../events/click\";\r\nimport pointerEvents from \"../../events/pointer\";\r\nimport positionUtils from \"../../animation/position\";\r\nimport {\r\n    addNamespace,\r\n    normalizeKeyName\r\n} from \"../../events/utils/index\";\r\nimport browser from \"../../core/utils/browser\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    getBoundingRect\r\n} from \"../../core/utils/position\";\r\nimport EditorFactoryMixin from \"../shared/ui.editor_factory_mixin\";\r\nimport gridCoreUtils from \"./ui.grid_core.utils\";\r\nvar EDITOR_INLINE_BLOCK = \"dx-editor-inline-block\";\r\nvar CELL_FOCUS_DISABLED_CLASS = \"dx-cell-focus-disabled\";\r\nvar FOCUS_OVERLAY_CLASS = \"focus-overlay\";\r\nvar CONTENT_CLASS = \"content\";\r\nvar FOCUSED_ELEMENT_CLASS = \"dx-focused\";\r\nvar ROW_CLASS = \"dx-row\";\r\nvar MODULE_NAMESPACE = \"dxDataGridEditorFactory\";\r\nvar UPDATE_FOCUS_EVENTS = addNamespace([pointerEvents.down, \"focusin\", clickEventName].join(\" \"), MODULE_NAMESPACE);\r\nvar DX_HIDDEN = \"dx-hidden\";\r\nvar EditorFactory = modules.ViewController.inherit({\r\n    _getFocusedElement: function($dataGridElement) {\r\n        var rowSelector = this.option(\"focusedRowEnabled\") ? \"tr[tabindex]:focus\" : \"tr[tabindex]:not(.dx-data-row):focus\";\r\n        var focusedElementSelector = \"td[tabindex]:focus, \".concat(rowSelector, \", input:focus, textarea:focus, .dx-lookup-field:focus, .dx-checkbox:focus, .dx-switch:focus, .dx-dropdownbutton .dx-buttongroup:focus\");\r\n        return $dataGridElement.find(focusedElementSelector)\r\n    },\r\n    _getFocusCellSelector: function() {\r\n        return \".dx-row > td\"\r\n    },\r\n    _updateFocusCore: function() {\r\n        var $focus = this._$focusedElement;\r\n        var $dataGridElement = this.component && this.component.$element();\r\n        var $focusCell;\r\n        var hideBorders;\r\n        if ($dataGridElement) {\r\n            $focus = this._getFocusedElement($dataGridElement);\r\n            if ($focus.length) {\r\n                if (!$focus.hasClass(CELL_FOCUS_DISABLED_CLASS) && !$focus.hasClass(ROW_CLASS)) {\r\n                    $focusCell = $focus.closest(this._getFocusCellSelector() + \", .\" + CELL_FOCUS_DISABLED_CLASS);\r\n                    hideBorders = $focusCell.get(0) !== $focus.get(0) && $focusCell.hasClass(EDITOR_INLINE_BLOCK);\r\n                    $focus = $focusCell\r\n                }\r\n                if ($focus.length && !$focus.hasClass(CELL_FOCUS_DISABLED_CLASS)) {\r\n                    this.focus($focus, hideBorders);\r\n                    return\r\n                }\r\n            }\r\n        }\r\n        this.loseFocus()\r\n    },\r\n    _updateFocus: function(e) {\r\n        var that = this;\r\n        var isFocusOverlay = e && e.event && $(e.event.target).hasClass(that.addWidgetPrefix(FOCUS_OVERLAY_CLASS));\r\n        that._isFocusOverlay = that._isFocusOverlay || isFocusOverlay;\r\n        clearTimeout(that._updateFocusTimeoutID);\r\n        that._updateFocusTimeoutID = setTimeout((function() {\r\n            delete that._updateFocusTimeoutID;\r\n            if (!that._isFocusOverlay) {\r\n                that._updateFocusCore()\r\n            }\r\n            that._isFocusOverlay = false\r\n        }))\r\n    },\r\n    _updateFocusOverlaySize: function($element, position) {\r\n        $element.hide();\r\n        var location = positionUtils.calculate($element, extend({\r\n            collision: \"fit\"\r\n        }, position));\r\n        if (location.h.oversize > 0) {\r\n            setOuterWidth($element, getOuterWidth($element) - location.h.oversize)\r\n        }\r\n        if (location.v.oversize > 0) {\r\n            setOuterHeight($element, getOuterHeight($element) - location.v.oversize)\r\n        }\r\n        $element.show()\r\n    },\r\n    callbackNames: function() {\r\n        return [\"focused\"]\r\n    },\r\n    focus: function($element, hideBorder) {\r\n        var that = this;\r\n        if (void 0 === $element) {\r\n            return that._$focusedElement\r\n        } else if ($element) {\r\n            if (!$element.is(that._$focusedElement)) {\r\n                that._$focusedElement && that._$focusedElement.removeClass(FOCUSED_ELEMENT_CLASS)\r\n            }\r\n            that._$focusedElement = $element;\r\n            clearTimeout(that._focusTimeoutID);\r\n            that._focusTimeoutID = setTimeout((function() {\r\n                delete that._focusTimeoutID;\r\n                that.renderFocusOverlay($element, hideBorder);\r\n                $element.addClass(FOCUSED_ELEMENT_CLASS);\r\n                that.focused.fire($element)\r\n            }))\r\n        }\r\n    },\r\n    refocus: function() {\r\n        var $focus = this.focus();\r\n        this.focus($focus)\r\n    },\r\n    renderFocusOverlay: function($element, hideBorder) {\r\n        if (!gridCoreUtils.isElementInCurrentGrid(this, $element)) {\r\n            return\r\n        }\r\n        if (!this._$focusOverlay) {\r\n            this._$focusOverlay = $(\"<div>\").addClass(this.addWidgetPrefix(FOCUS_OVERLAY_CLASS))\r\n        }\r\n        if (hideBorder) {\r\n            this._$focusOverlay.addClass(DX_HIDDEN)\r\n        } else if ($element.length) {\r\n            var align = browser.mozilla ? \"right bottom\" : \"left top\";\r\n            var $content = $element.closest(\".\" + this.addWidgetPrefix(CONTENT_CLASS));\r\n            var elemCoord = getBoundingRect($element.get(0));\r\n            this._$focusOverlay.removeClass(DX_HIDDEN).appendTo($content);\r\n            setOuterHeight(this._$focusOverlay, elemCoord.bottom - elemCoord.top + 1);\r\n            setOuterWidth(this._$focusOverlay, elemCoord.right - elemCoord.left + 1);\r\n            var focusOverlayPosition = {\r\n                precise: true,\r\n                my: align,\r\n                at: align,\r\n                of: $element,\r\n                boundary: $content.length && $content\r\n            };\r\n            this._updateFocusOverlaySize(this._$focusOverlay, focusOverlayPosition);\r\n            positionUtils.setup(this._$focusOverlay, focusOverlayPosition);\r\n            this._$focusOverlay.css(\"visibility\", \"visible\")\r\n        }\r\n    },\r\n    resize: function() {\r\n        var $focusedElement = this._$focusedElement;\r\n        if ($focusedElement) {\r\n            this.focus($focusedElement)\r\n        }\r\n    },\r\n    loseFocus: function() {\r\n        this._$focusedElement && this._$focusedElement.removeClass(FOCUSED_ELEMENT_CLASS);\r\n        this._$focusedElement = null;\r\n        this._$focusOverlay && this._$focusOverlay.addClass(DX_HIDDEN)\r\n    },\r\n    init: function() {\r\n        this.createAction(\"onEditorPreparing\", {\r\n            excludeValidators: [\"disabled\", \"readOnly\"],\r\n            category: \"rendering\"\r\n        });\r\n        this.createAction(\"onEditorPrepared\", {\r\n            excludeValidators: [\"disabled\", \"readOnly\"],\r\n            category: \"rendering\"\r\n        });\r\n        this._updateFocusHandler = this._updateFocusHandler || this.createAction(this._updateFocus.bind(this));\r\n        eventsEngine.on(domAdapter.getDocument(), UPDATE_FOCUS_EVENTS, this._updateFocusHandler);\r\n        this._attachContainerEventHandlers()\r\n    },\r\n    _attachContainerEventHandlers: function() {\r\n        var that = this;\r\n        var $container = that.component && that.component.$element();\r\n        if ($container) {\r\n            eventsEngine.on($container, addNamespace(\"keydown\", MODULE_NAMESPACE), (function(e) {\r\n                if (\"tab\" === normalizeKeyName(e)) {\r\n                    that._updateFocusHandler(e)\r\n                }\r\n            }))\r\n        }\r\n    },\r\n    dispose: function() {\r\n        clearTimeout(this._focusTimeoutID);\r\n        clearTimeout(this._updateFocusTimeoutID);\r\n        eventsEngine.off(domAdapter.getDocument(), UPDATE_FOCUS_EVENTS, this._updateFocusHandler)\r\n    }\r\n}).include(EditorFactoryMixin);\r\nexport var editorFactoryModule = {\r\n    defaultOptions: function() {\r\n        return {}\r\n    },\r\n    controllers: {\r\n        editorFactory: EditorFactory\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}