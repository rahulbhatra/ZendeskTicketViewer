{"ast":null,"code":"/**\r\n * DevExtreme (esm/exporter/image_creator.js)\r\n * Version: 21.2.3\r\n * Build date: Thu Oct 28 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../core/renderer\";\nimport Color from \"../color\";\nimport { isFunction, isPromise, isDefined } from \"../core/utils/type\";\nimport { getSvgElement, HIDDEN_FOR_EXPORT } from \"../core/utils/svg\";\nimport { each as _each, map as _map } from \"../core/utils/iterator\";\nimport { extend } from \"../core/utils/extend\";\nimport domAdapter from \"../core/dom_adapter\";\nimport { contains } from \"../core/utils/dom\";\nimport { getWindow } from \"../core/utils/window\";\nvar window = getWindow();\nimport { camelize } from \"../core/utils/inflector\";\nimport { Deferred, fromPromise } from \"../core/utils/deferred\";\nvar _math = Math;\nvar PI = _math.PI;\nvar _min = _math.min;\nvar _abs = _math.abs;\nvar _sqrt = _math.sqrt;\nvar _pow = _math.pow;\nvar _atan2 = _math.atan2;\nvar _cos = _math.cos;\nvar _sin = _math.sin;\nvar _number = Number;\nvar IMAGE_QUALITY = 1;\nvar TEXT_DECORATION_LINE_WIDTH_COEFF = .05;\nvar DEFAULT_FONT_SIZE = \"10px\";\nvar DEFAULT_FONT_FAMILY = \"sans-serif\";\nvar DEFAULT_TEXT_COLOR = \"#000\";\nvar parseAttributes;\n\nfunction createCanvas(width, height, margin) {\n  var canvas = $(\"<canvas>\")[0];\n  canvas.width = width + 2 * margin;\n  canvas.height = height + 2 * margin;\n  canvas.hidden = true;\n  return canvas;\n}\n\nfunction getStringFromCanvas(canvas, mimeType) {\n  var dataURL = canvas.toDataURL(mimeType, IMAGE_QUALITY);\n  var imageData = window.atob(dataURL.substring((\"data:\" + mimeType + \";base64,\").length));\n  return imageData;\n}\n\nfunction arcTo(x1, y1, x2, y2, radius, largeArcFlag, clockwise, context) {\n  var cBx = (x1 + x2) / 2;\n  var cBy = (y1 + y2) / 2;\n\n  var aB = _atan2(y1 - y2, x1 - x2);\n\n  var k = largeArcFlag ? 1 : -1;\n  aB += PI / 180 * 90 * (clockwise ? 1 : -1);\n  var opSide = _sqrt(_pow(x2 - x1, 2) + _pow(y2 - y1, 2)) / 2;\n\n  var adjSide = _sqrt(_abs(_pow(radius, 2) - _pow(opSide, 2)));\n\n  var centerX = cBx + k * (adjSide * _cos(aB));\n\n  var centerY = cBy + k * (adjSide * _sin(aB));\n\n  var startAngle = _atan2(y1 - centerY, x1 - centerX);\n\n  var endAngle = _atan2(y2 - centerY, x2 - centerX);\n\n  context.arc(centerX, centerY, radius, startAngle, endAngle, !clockwise);\n}\n\nfunction getElementOptions(element, rootAppended) {\n  var attr = parseAttributes(element.attributes || {});\n  var options = extend({}, attr, {\n    text: element.textContent.replace(/\\s+/g, \" \"),\n    textAlign: \"middle\" === attr[\"text-anchor\"] ? \"center\" : attr[\"text-anchor\"]\n  });\n  var transform = attr.transform;\n  var coords;\n\n  if (transform) {\n    coords = transform.match(/translate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\n\n    if (coords) {\n      coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\n      options.translateX = _number(coords[0]);\n      options.translateY = coords[1] ? _number(coords[1]) : 0;\n    }\n\n    coords = transform.match(/rotate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*,*\\s*-*\\d+([.]\\d+)*)*/);\n\n    if (coords) {\n      coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\n      options.rotationAngle = _number(coords[0]);\n      options.rotationX = coords[1] && _number(coords[1]);\n      options.rotationY = coords[2] && _number(coords[2]);\n    }\n\n    coords = transform.match(/scale\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\n\n    if (coords) {\n      coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\n      options.scaleX = _number(coords[0]);\n\n      if (coords.length > 1) {\n        options.scaleY = _number(coords[1]);\n      } else {\n        options.scaleY = options.scaleX;\n      }\n    }\n  }\n\n  parseStyles(element, options, rootAppended);\n  return options;\n}\n\nfunction drawRect(context, options) {\n  var x = options.x;\n  var y = options.y;\n  var width = options.width;\n  var height = options.height;\n  var cornerRadius = options.rx;\n\n  if (!cornerRadius) {\n    context.rect(x, y, width, height);\n  } else {\n    cornerRadius = _min(cornerRadius, width / 2, height / 2);\n    context.save();\n    context.translate(x, y);\n    context.moveTo(width / 2, 0);\n    context.arcTo(width, 0, width, height, cornerRadius);\n    context.arcTo(width, height, 0, height, cornerRadius);\n    context.arcTo(0, height, 0, 0, cornerRadius);\n    context.arcTo(0, 0, cornerRadius, 0, cornerRadius);\n    context.lineTo(width / 2, 0);\n    context.restore();\n  }\n}\n\nfunction drawImage(context, options, shared) {\n  var d = new Deferred();\n  var image = new window.Image();\n\n  image.onload = function () {\n    context.save();\n    context.globalAlpha = options.globalAlpha;\n    transformElement(context, options);\n    clipElement(context, options, shared);\n    context.drawImage(image, options.x, options.y, options.width, options.height);\n    context.restore();\n    d.resolve();\n  };\n\n  image.onerror = function () {\n    d.resolve();\n  };\n\n  image.setAttribute(\"crossOrigin\", \"anonymous\");\n  image.src = options.href || options[\"xlink:href\"];\n  return d;\n}\n\nfunction drawPath(context, dAttr) {\n  var dArray = dAttr.replace(/,/g, \" \").split(/([A-Z])/i).filter(item => \"\" !== item.trim());\n  var i = 0;\n  var params;\n  var prevParams;\n  var prevParamsLen;\n\n  do {\n    params = (dArray[i + 1] || \"\").trim().split(\" \");\n\n    switch (dArray[i]) {\n      case \"M\":\n        context.moveTo(_number(params[0]), _number(params[1]));\n        i += 2;\n        break;\n\n      case \"L\":\n        for (var j = 0; j < params.length / 2; j++) {\n          context.lineTo(_number(params[2 * j]), _number(params[2 * j + 1]));\n        }\n\n        i += 2;\n        break;\n\n      case \"C\":\n        context.bezierCurveTo(_number(params[0]), _number(params[1]), _number(params[2]), _number(params[3]), _number(params[4]), _number(params[5]));\n        i += 2;\n        break;\n\n      case \"a\":\n        prevParams = dArray[i - 1].trim().split(\" \");\n        prevParamsLen = prevParams.length - 1;\n        arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(prevParams[prevParamsLen - 1]) + _number(params[5]), _number(prevParams[prevParamsLen]) + _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\n        i += 2;\n        break;\n\n      case \"A\":\n        prevParams = dArray[i - 1].trim().split(\" \");\n        prevParamsLen = prevParams.length - 1;\n        arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(params[5]), _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\n        i += 2;\n        break;\n\n      case \"Z\":\n        context.closePath();\n        i += 1;\n        break;\n\n      default:\n        i++;\n    }\n  } while (i < dArray.length);\n}\n\nfunction parseStyles(element, options, rootAppended) {\n  var style = element.style || {};\n  var field;\n\n  for (field in style) {\n    if (\"\" !== style[field]) {\n      options[camelize(field)] = style[field];\n    }\n  }\n\n  if (rootAppended && domAdapter.isElementNode(element)) {\n    style = window.getComputedStyle(element);\n    [\"fill\", \"stroke\", \"stroke-width\", \"font-family\", \"font-size\", \"font-style\", \"font-weight\"].forEach(function (prop) {\n      if (prop in style && \"\" !== style[prop]) {\n        options[camelize(prop)] = style[prop];\n      }\n    });\n    [\"opacity\", \"fill-opacity\", \"stroke-opacity\"].forEach(function (prop) {\n      if (prop in style && \"\" !== style[prop] && \"1\" !== style[prop]) {\n        options[prop] = _number(style[prop]);\n      }\n    });\n  }\n\n  options.textDecoration = options.textDecoration || options.textDecorationLine;\n  options.globalAlpha = isDefined(options.opacity) ? options.opacity : options.globalAlpha;\n}\n\nfunction parseUrl(urlString) {\n  var matches = urlString && urlString.match(/url\\(.*#(.*?)[\"']?\\)/i);\n  return matches && matches[1];\n}\n\nfunction setFontStyle(context, options) {\n  var fontParams = [];\n  options.fontSize = options.fontSize || DEFAULT_FONT_SIZE;\n  options.fontFamily = options.fontFamily || DEFAULT_FONT_FAMILY;\n  options.fill = options.fill || DEFAULT_TEXT_COLOR;\n  options.fontStyle && fontParams.push(options.fontStyle);\n  options.fontWeight && fontParams.push(options.fontWeight);\n  fontParams.push(options.fontSize);\n  fontParams.push(options.fontFamily);\n  context.font = fontParams.join(\" \");\n  context.textAlign = options.textAlign;\n  context.fillStyle = options.fill;\n  context.globalAlpha = options.globalAlpha;\n}\n\nfunction drawText(context, options, shared) {\n  setFontStyle(context, options);\n  applyFilter(context, options, shared);\n  options.text && context.fillText(options.text, options.x || 0, options.y || 0);\n  strokeElement(context, options, true);\n  drawTextDecoration(context, options, shared);\n}\n\nfunction drawTextDecoration(context, options, shared) {\n  if (!options.textDecoration || \"none\" === options.textDecoration) {\n    return;\n  }\n\n  var x = options.x;\n  var textWidth = context.measureText(options.text).width;\n  var textHeight = parseInt(options.fontSize, 10);\n  var lineHeight = textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF < 1 ? 1 : textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF;\n  var y = options.y;\n\n  switch (options.textDecoration) {\n    case \"line-through\":\n      y -= textHeight / 3 + lineHeight / 2;\n      break;\n\n    case \"overline\":\n      y -= textHeight - lineHeight;\n      break;\n\n    case \"underline\":\n      y += lineHeight;\n  }\n\n  context.rect(x, y, textWidth, lineHeight);\n  fillElement(context, options, shared);\n  strokeElement(context, options);\n}\n\nfunction aggregateOpacity(options) {\n  options.strokeOpacity = void 0 !== options[\"stroke-opacity\"] ? options[\"stroke-opacity\"] : 1;\n  options.fillOpacity = void 0 !== options[\"fill-opacity\"] ? options[\"fill-opacity\"] : 1;\n\n  if (void 0 !== options.opacity) {\n    options.strokeOpacity *= options.opacity;\n    options.fillOpacity *= options.opacity;\n  }\n}\n\nfunction hasTspan(element) {\n  var nodes = element.childNodes;\n\n  for (var i = 0; i < nodes.length; i++) {\n    if (\"tspan\" === nodes[i].tagName) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction drawTextElement(childNodes, context, options, shared) {\n  var lines = [];\n  var line;\n  var offset = 0;\n\n  for (var i = 0; i < childNodes.length; i++) {\n    var element = childNodes[i];\n\n    if (void 0 === element.tagName) {\n      drawElement(element, context, options, shared);\n    } else if (\"tspan\" === element.tagName || \"text\" === element.tagName) {\n      var elementOptions = getElementOptions(element, shared.rootAppended);\n      var mergedOptions = extend({}, options, elementOptions);\n\n      if (\"tspan\" === element.tagName && hasTspan(element)) {\n        drawTextElement(element.childNodes, context, mergedOptions, shared);\n        continue;\n      }\n\n      mergedOptions.textAlign = \"start\";\n\n      if (!line || void 0 !== elementOptions.x) {\n        line = {\n          elements: [],\n          options: [],\n          widths: [],\n          offsets: []\n        };\n        lines.push(line);\n      }\n\n      if (void 0 !== elementOptions.y) {\n        offset = 0;\n      }\n\n      if (void 0 !== elementOptions.dy) {\n        offset += parseFloat(elementOptions.dy);\n      }\n\n      line.elements.push(element);\n      line.options.push(mergedOptions);\n      line.offsets.push(offset);\n      setFontStyle(context, mergedOptions);\n      line.widths.push(context.measureText(mergedOptions.text).width);\n    }\n  }\n\n  lines.forEach(function (line) {\n    var commonWidth = line.widths.reduce(function (commonWidth, width) {\n      return commonWidth + width;\n    }, 0);\n    var xDiff = 0;\n    var currentOffset = 0;\n\n    if (\"center\" === options.textAlign) {\n      xDiff = commonWidth / 2;\n    }\n\n    if (\"end\" === options.textAlign) {\n      xDiff = commonWidth;\n    }\n\n    line.options.forEach(function (o, index) {\n      var width = line.widths[index];\n      o.x = o.x - xDiff + currentOffset;\n      o.y += line.offsets[index];\n      currentOffset += width;\n    });\n    line.elements.forEach(function (element, index) {\n      drawTextElement(element.childNodes, context, line.options[index], shared);\n    });\n  });\n}\n\nfunction drawElement(element, context, parentOptions, shared) {\n  var tagName = element.tagName;\n  var isText = \"text\" === tagName || \"tspan\" === tagName || void 0 === tagName;\n  var isImage = \"image\" === tagName;\n  var options = extend({}, parentOptions, getElementOptions(element, shared.rootAppended));\n\n  if (\"hidden\" === options.visibility || options[HIDDEN_FOR_EXPORT]) {\n    return;\n  }\n\n  context.save();\n  !isImage && transformElement(context, options);\n  clipElement(context, options, shared);\n  aggregateOpacity(options);\n  var promise;\n  context.beginPath();\n\n  switch (element.tagName) {\n    case void 0:\n      drawText(context, options, shared);\n      break;\n\n    case \"text\":\n    case \"tspan\":\n      drawTextElement(element.childNodes, context, options, shared);\n      break;\n\n    case \"image\":\n      promise = drawImage(context, options, shared);\n      break;\n\n    case \"path\":\n      drawPath(context, options.d);\n      break;\n\n    case \"rect\":\n      drawRect(context, options);\n      context.closePath();\n      break;\n\n    case \"circle\":\n      context.arc(options.cx, options.cy, options.r, 0, 2 * PI, 1);\n  }\n\n  if (!isText) {\n    applyFilter(context, options, shared);\n    fillElement(context, options, shared);\n    strokeElement(context, options);\n  }\n\n  applyGradient(context, options, shared, element);\n  context.restore();\n  return promise;\n}\n\nfunction applyGradient(context, options, _ref, element) {\n  var {\n    gradients: gradients\n  } = _ref;\n\n  if (0 === gradients.length) {\n    return;\n  }\n\n  var id = parseUrl(options.fill);\n\n  if (id && gradients[id]) {\n    var box = element.getBBox();\n    var gradient = context.createLinearGradient(box.x, 0, box.x + box.width, 0);\n    gradients[id].forEach(opt => {\n      var offset = parseInt(opt.offset.replace(/%/, \"\"));\n      gradient.addColorStop(offset / 100, opt.stopColor);\n    });\n    context.globalAlpha = options.opacity;\n    context.fillStyle = gradient;\n    context.fill();\n  }\n}\n\nfunction applyFilter(context, options, shared) {\n  var filterOptions;\n  var id = parseUrl(options.filter);\n\n  if (id) {\n    filterOptions = shared.filters[id];\n\n    if (!filterOptions) {\n      filterOptions = {\n        offsetX: 0,\n        offsetY: 0,\n        blur: 0,\n        color: \"#000\"\n      };\n    }\n\n    context.shadowOffsetX = filterOptions.offsetX;\n    context.shadowOffsetY = filterOptions.offsetY;\n    context.shadowColor = filterOptions.color;\n    context.shadowBlur = filterOptions.blur;\n  }\n}\n\nfunction transformElement(context, options) {\n  context.translate(options.translateX || 0, options.translateY || 0);\n  options.translateX = void 0;\n  options.translateY = void 0;\n\n  if (options.rotationAngle) {\n    context.translate(options.rotationX || 0, options.rotationY || 0);\n    context.rotate(options.rotationAngle * PI / 180);\n    context.translate(-(options.rotationX || 0), -(options.rotationY || 0));\n    options.rotationAngle = void 0;\n    options.rotationX = void 0;\n    options.rotationY = void 0;\n  }\n\n  if (isFinite(options.scaleX)) {\n    context.scale(options.scaleX, options.scaleY);\n    options.scaleX = void 0;\n    options.scaleY = void 0;\n  }\n}\n\nfunction clipElement(context, options, shared) {\n  if (options[\"clip-path\"]) {\n    drawElement(shared.clipPaths[parseUrl(options[\"clip-path\"])], context, {}, shared);\n    context.clip();\n    options[\"clip-path\"] = void 0;\n  }\n}\n\nfunction hex2rgba(hexColor, alpha) {\n  var color = new Color(hexColor);\n  return \"rgba(\" + color.r + \",\" + color.g + \",\" + color.b + \",\" + alpha + \")\";\n}\n\nfunction createGradient(element) {\n  var options = [];\n\n  _each(element.childNodes, (_, _ref2) => {\n    var {\n      attributes: attributes\n    } = _ref2;\n    options.push({\n      offset: attributes.offset.value,\n      stopColor: attributes[\"stop-color\"].value\n    });\n  });\n\n  return options;\n}\n\nfunction createFilter(element) {\n  var color;\n  var opacity;\n  var filterOptions = {};\n\n  _each(element.childNodes, function (_, node) {\n    var attr = node.attributes;\n\n    if (!attr.result) {\n      return;\n    }\n\n    switch (attr.result.value) {\n      case \"gaussianBlurResult\":\n        filterOptions.blur = _number(attr.stdDeviation.value);\n        break;\n\n      case \"offsetResult\":\n        filterOptions.offsetX = _number(attr.dx.value);\n        filterOptions.offsetY = _number(attr.dy.value);\n        break;\n\n      case \"floodResult\":\n        color = attr[\"flood-color\"] ? attr[\"flood-color\"].value : \"#000\";\n        opacity = attr[\"flood-opacity\"] ? attr[\"flood-opacity\"].value : 1;\n        filterOptions.color = hex2rgba(color, opacity);\n    }\n  });\n\n  return filterOptions;\n}\n\nfunction asyncEach(array, callback) {\n  var d = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : new Deferred();\n  var i = 0;\n\n  for (; i < array.length; i++) {\n    var result = callback(array[i]);\n\n    if (isPromise(result)) {\n      result.then(() => {\n        asyncEach(Array.prototype.slice.call(array, i + 1), callback, d);\n      });\n      break;\n    }\n  }\n\n  if (i === array.length) {\n    d.resolve();\n  }\n\n  return d;\n}\n\nfunction drawCanvasElements(elements, context, parentOptions, shared) {\n  return asyncEach(elements, function (element) {\n    switch (element.tagName && element.tagName.toLowerCase()) {\n      case \"g\":\n      case \"svg\":\n        var options = extend({}, parentOptions, getElementOptions(element, shared.rootAppended));\n        context.save();\n        transformElement(context, options);\n        clipElement(context, options, shared);\n\n        var onDone = () => {\n          context.restore();\n        };\n\n        var d = drawCanvasElements(element.childNodes, context, options, shared);\n\n        if (isPromise(d)) {\n          d.then(onDone);\n        } else {\n          onDone();\n        }\n\n        return d;\n\n      case \"defs\":\n        return drawCanvasElements(element.childNodes, context, {}, shared);\n\n      case \"clippath\":\n        shared.clipPaths[element.attributes.id.textContent] = element.childNodes[0];\n        break;\n\n      case \"pattern\":\n        shared.patterns[element.attributes.id.textContent] = element;\n        break;\n\n      case \"filter\":\n        shared.filters[element.id] = createFilter(element);\n        break;\n\n      case \"lineargradient\":\n        shared.gradients[element.attributes.id.textContent] = createGradient(element);\n        break;\n\n      default:\n        return drawElement(element, context, parentOptions, shared);\n    }\n  });\n}\n\nfunction setLineDash(context, options) {\n  var matches = options[\"stroke-dasharray\"] && options[\"stroke-dasharray\"].match(/(\\d+)/g);\n\n  if (matches && matches.length) {\n    matches = _map(matches, function (item) {\n      return _number(item);\n    });\n    context.setLineDash(matches);\n  }\n}\n\nfunction strokeElement(context, options, isText) {\n  var stroke = options.stroke;\n\n  if (stroke && \"none\" !== stroke && 0 !== options[\"stroke-width\"]) {\n    setLineDash(context, options);\n    context.lineJoin = options[\"stroke-linejoin\"];\n    context.lineWidth = options[\"stroke-width\"];\n    context.globalAlpha = options.strokeOpacity;\n    context.strokeStyle = stroke;\n    isText ? context.strokeText(options.text, options.x, options.y) : context.stroke();\n    context.globalAlpha = 1;\n  }\n}\n\nfunction getPattern(context, pattern, shared) {\n  var options = getElementOptions(pattern, shared.rootAppended);\n  var patternCanvas = createCanvas(options.width, options.height, 0);\n  var patternContext = patternCanvas.getContext(\"2d\");\n  drawCanvasElements(pattern.childNodes, patternContext, options, shared);\n  return context.createPattern(patternCanvas, \"repeat\");\n}\n\nfunction fillElement(context, options, shared) {\n  var fill = options.fill;\n\n  if (fill && \"none\" !== fill) {\n    if (-1 === fill.search(/url/)) {\n      context.fillStyle = fill;\n    } else {\n      var pattern = shared.patterns[parseUrl(fill)];\n\n      if (!pattern) {\n        return;\n      }\n\n      context.fillStyle = getPattern(context, pattern, shared);\n    }\n\n    context.globalAlpha = options.fillOpacity;\n    context.fill();\n    context.globalAlpha = 1;\n  }\n}\n\nparseAttributes = function (attributes) {\n  var newAttributes = {};\n  var attr;\n\n  _each(attributes, function (index, item) {\n    attr = item.textContent;\n\n    if (isFinite(attr)) {\n      attr = _number(attr);\n    }\n\n    newAttributes[item.name.toLowerCase()] = attr;\n  });\n\n  return newAttributes;\n};\n\nfunction drawBackground(context, width, height, backgroundColor, margin) {\n  context.fillStyle = backgroundColor || \"#ffffff\";\n  context.fillRect(-margin, -margin, width + 2 * margin, height + 2 * margin);\n}\n\nfunction createInvisibleDiv() {\n  var invisibleDiv = domAdapter.createElement(\"div\");\n  invisibleDiv.style.left = \"-9999px\";\n  invisibleDiv.style.position = \"absolute\";\n  return invisibleDiv;\n}\n\nfunction convertSvgToCanvas(svg, canvas, rootAppended) {\n  return drawCanvasElements(svg.childNodes, canvas.getContext(\"2d\"), {}, {\n    clipPaths: {},\n    patterns: {},\n    filters: {},\n    gradients: {},\n    rootAppended: rootAppended\n  });\n}\n\nfunction getCanvasFromSvg(markup, _ref3) {\n  var {\n    width: width,\n    height: height,\n    backgroundColor: backgroundColor,\n    margin: margin,\n    pixelRatio: pixelRatio,\n    svgToCanvas = convertSvgToCanvas\n  } = _ref3;\n  var canvas = createCanvas(width, height, margin);\n  var context = canvas.getContext(\"2d\");\n  context.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n  var svgElem = getSvgElement(markup);\n  var invisibleDiv;\n  var markupIsDomElement = domAdapter.isElementNode(markup);\n  context.translate(margin, margin);\n  domAdapter.getBody().appendChild(canvas);\n\n  if (!markupIsDomElement) {\n    invisibleDiv = createInvisibleDiv();\n    invisibleDiv.appendChild(svgElem);\n    domAdapter.getBody().appendChild(invisibleDiv);\n  }\n\n  if (svgElem.attributes.direction) {\n    canvas.dir = svgElem.attributes.direction.textContent;\n  }\n\n  drawBackground(context, width, height, backgroundColor, margin);\n  return fromPromise(svgToCanvas(svgElem, canvas, markupIsDomElement && contains(domAdapter.getBody(), markup))).then(() => canvas).always(() => {\n    invisibleDiv && domAdapter.getBody().removeChild(invisibleDiv);\n    domAdapter.getBody().removeChild(canvas);\n  });\n}\n\nexport var imageCreator = {\n  getImageData: function (markup, options) {\n    var mimeType = \"image/\" + options.format;\n\n    if (isFunction(options.__parseAttributesFn)) {\n      parseAttributes = options.__parseAttributesFn;\n    }\n\n    return getCanvasFromSvg(markup, options).then(canvas => getStringFromCanvas(canvas, mimeType));\n  },\n  getData: function (markup, options) {\n    var that = this;\n    return imageCreator.getImageData(markup, options).then(binaryData => {\n      var mimeType = \"image/\" + options.format;\n      var data = isFunction(window.Blob) && !options.forceProxy ? that._getBlob(binaryData, mimeType) : that._getBase64(binaryData);\n      return data;\n    });\n  },\n  _getBlob: function (binaryData, mimeType) {\n    var i;\n    var dataArray = new Uint8Array(binaryData.length);\n\n    for (i = 0; i < binaryData.length; i++) {\n      dataArray[i] = binaryData.charCodeAt(i);\n    }\n\n    return new window.Blob([dataArray.buffer], {\n      type: mimeType\n    });\n  },\n  _getBase64: function (binaryData) {\n    return window.btoa(binaryData);\n  }\n};\nexport function getData(data, options) {\n  return imageCreator.getData(data, options);\n}\nexport function testFormats(formats) {\n  var canvas = createCanvas(100, 100, 0);\n  return formats.reduce(function (r, f) {\n    var mimeType = (\"image/\" + f).toLowerCase();\n\n    if (-1 !== canvas.toDataURL(mimeType).indexOf(mimeType)) {\n      r.supported.push(f);\n    } else {\n      r.unsupported.push(f);\n    }\n\n    return r;\n  }, {\n    supported: [],\n    unsupported: []\n  });\n}","map":{"version":3,"sources":["/Users/rahulsharma/node_modules/devextreme/esm/exporter/image_creator.js"],"names":["$","Color","isFunction","isPromise","isDefined","getSvgElement","HIDDEN_FOR_EXPORT","each","_each","map","_map","extend","domAdapter","contains","getWindow","window","camelize","Deferred","fromPromise","_math","Math","PI","_min","min","_abs","abs","_sqrt","sqrt","_pow","pow","_atan2","atan2","_cos","cos","_sin","sin","_number","Number","IMAGE_QUALITY","TEXT_DECORATION_LINE_WIDTH_COEFF","DEFAULT_FONT_SIZE","DEFAULT_FONT_FAMILY","DEFAULT_TEXT_COLOR","parseAttributes","createCanvas","width","height","margin","canvas","hidden","getStringFromCanvas","mimeType","dataURL","toDataURL","imageData","atob","substring","length","arcTo","x1","y1","x2","y2","radius","largeArcFlag","clockwise","context","cBx","cBy","aB","k","opSide","adjSide","centerX","centerY","startAngle","endAngle","arc","getElementOptions","element","rootAppended","attr","attributes","options","text","textContent","replace","textAlign","transform","coords","match","translateX","translateY","rotationAngle","rotationX","rotationY","scaleX","scaleY","parseStyles","drawRect","x","y","cornerRadius","rx","rect","save","translate","moveTo","lineTo","restore","drawImage","shared","d","image","Image","onload","globalAlpha","transformElement","clipElement","resolve","onerror","setAttribute","src","href","drawPath","dAttr","dArray","split","filter","item","trim","i","params","prevParams","prevParamsLen","j","bezierCurveTo","closePath","style","field","isElementNode","getComputedStyle","forEach","prop","textDecoration","textDecorationLine","opacity","parseUrl","urlString","matches","setFontStyle","fontParams","fontSize","fontFamily","fill","fontStyle","push","fontWeight","font","join","fillStyle","drawText","applyFilter","fillText","strokeElement","drawTextDecoration","textWidth","measureText","textHeight","parseInt","lineHeight","fillElement","aggregateOpacity","strokeOpacity","fillOpacity","hasTspan","nodes","childNodes","tagName","drawTextElement","lines","line","offset","drawElement","elementOptions","mergedOptions","elements","widths","offsets","dy","parseFloat","commonWidth","reduce","xDiff","currentOffset","o","index","parentOptions","isText","isImage","visibility","promise","beginPath","cx","cy","r","applyGradient","_ref","gradients","id","box","getBBox","gradient","createLinearGradient","opt","addColorStop","stopColor","filterOptions","filters","offsetX","offsetY","blur","color","shadowOffsetX","shadowOffsetY","shadowColor","shadowBlur","rotate","isFinite","scale","clipPaths","clip","hex2rgba","hexColor","alpha","g","b","createGradient","_","_ref2","value","createFilter","node","result","stdDeviation","dx","asyncEach","array","callback","arguments","then","Array","prototype","slice","call","drawCanvasElements","toLowerCase","onDone","patterns","setLineDash","stroke","lineJoin","lineWidth","strokeStyle","strokeText","getPattern","pattern","patternCanvas","patternContext","getContext","createPattern","search","newAttributes","name","drawBackground","backgroundColor","fillRect","createInvisibleDiv","invisibleDiv","createElement","left","position","convertSvgToCanvas","svg","getCanvasFromSvg","markup","_ref3","pixelRatio","svgToCanvas","setTransform","svgElem","markupIsDomElement","getBody","appendChild","direction","dir","always","removeChild","imageCreator","getImageData","format","__parseAttributesFn","getData","that","binaryData","data","Blob","forceProxy","_getBlob","_getBase64","dataArray","Uint8Array","charCodeAt","buffer","type","btoa","testFormats","formats","f","indexOf","supported","unsupported"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/exporter/image_creator.js)\r\n * Version: 21.2.3\r\n * Build date: Thu Oct 28 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../core/renderer\";\r\nimport Color from \"../color\";\r\nimport {\r\n    isFunction,\r\n    isPromise,\r\n    isDefined\r\n} from \"../core/utils/type\";\r\nimport {\r\n    getSvgElement,\r\n    HIDDEN_FOR_EXPORT\r\n} from \"../core/utils/svg\";\r\nimport {\r\n    each as _each,\r\n    map as _map\r\n} from \"../core/utils/iterator\";\r\nimport {\r\n    extend\r\n} from \"../core/utils/extend\";\r\nimport domAdapter from \"../core/dom_adapter\";\r\nimport {\r\n    contains\r\n} from \"../core/utils/dom\";\r\nimport {\r\n    getWindow\r\n} from \"../core/utils/window\";\r\nvar window = getWindow();\r\nimport {\r\n    camelize\r\n} from \"../core/utils/inflector\";\r\nimport {\r\n    Deferred,\r\n    fromPromise\r\n} from \"../core/utils/deferred\";\r\nvar _math = Math;\r\nvar PI = _math.PI;\r\nvar _min = _math.min;\r\nvar _abs = _math.abs;\r\nvar _sqrt = _math.sqrt;\r\nvar _pow = _math.pow;\r\nvar _atan2 = _math.atan2;\r\nvar _cos = _math.cos;\r\nvar _sin = _math.sin;\r\nvar _number = Number;\r\nvar IMAGE_QUALITY = 1;\r\nvar TEXT_DECORATION_LINE_WIDTH_COEFF = .05;\r\nvar DEFAULT_FONT_SIZE = \"10px\";\r\nvar DEFAULT_FONT_FAMILY = \"sans-serif\";\r\nvar DEFAULT_TEXT_COLOR = \"#000\";\r\nvar parseAttributes;\r\n\r\nfunction createCanvas(width, height, margin) {\r\n    var canvas = $(\"<canvas>\")[0];\r\n    canvas.width = width + 2 * margin;\r\n    canvas.height = height + 2 * margin;\r\n    canvas.hidden = true;\r\n    return canvas\r\n}\r\n\r\nfunction getStringFromCanvas(canvas, mimeType) {\r\n    var dataURL = canvas.toDataURL(mimeType, IMAGE_QUALITY);\r\n    var imageData = window.atob(dataURL.substring((\"data:\" + mimeType + \";base64,\").length));\r\n    return imageData\r\n}\r\n\r\nfunction arcTo(x1, y1, x2, y2, radius, largeArcFlag, clockwise, context) {\r\n    var cBx = (x1 + x2) / 2;\r\n    var cBy = (y1 + y2) / 2;\r\n    var aB = _atan2(y1 - y2, x1 - x2);\r\n    var k = largeArcFlag ? 1 : -1;\r\n    aB += PI / 180 * 90 * (clockwise ? 1 : -1);\r\n    var opSide = _sqrt(_pow(x2 - x1, 2) + _pow(y2 - y1, 2)) / 2;\r\n    var adjSide = _sqrt(_abs(_pow(radius, 2) - _pow(opSide, 2)));\r\n    var centerX = cBx + k * (adjSide * _cos(aB));\r\n    var centerY = cBy + k * (adjSide * _sin(aB));\r\n    var startAngle = _atan2(y1 - centerY, x1 - centerX);\r\n    var endAngle = _atan2(y2 - centerY, x2 - centerX);\r\n    context.arc(centerX, centerY, radius, startAngle, endAngle, !clockwise)\r\n}\r\n\r\nfunction getElementOptions(element, rootAppended) {\r\n    var attr = parseAttributes(element.attributes || {});\r\n    var options = extend({}, attr, {\r\n        text: element.textContent.replace(/\\s+/g, \" \"),\r\n        textAlign: \"middle\" === attr[\"text-anchor\"] ? \"center\" : attr[\"text-anchor\"]\r\n    });\r\n    var transform = attr.transform;\r\n    var coords;\r\n    if (transform) {\r\n        coords = transform.match(/translate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\r\n        if (coords) {\r\n            coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\r\n            options.translateX = _number(coords[0]);\r\n            options.translateY = coords[1] ? _number(coords[1]) : 0\r\n        }\r\n        coords = transform.match(/rotate\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*,*\\s*-*\\d+([.]\\d+)*)*/);\r\n        if (coords) {\r\n            coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\r\n            options.rotationAngle = _number(coords[0]);\r\n            options.rotationX = coords[1] && _number(coords[1]);\r\n            options.rotationY = coords[2] && _number(coords[2])\r\n        }\r\n        coords = transform.match(/scale\\(-*\\d+([.]\\d+)*(,*\\s*-*\\d+([.]\\d+)*)*/);\r\n        if (coords) {\r\n            coords = coords[0].match(/-*\\d+([.]\\d+)*/g);\r\n            options.scaleX = _number(coords[0]);\r\n            if (coords.length > 1) {\r\n                options.scaleY = _number(coords[1])\r\n            } else {\r\n                options.scaleY = options.scaleX\r\n            }\r\n        }\r\n    }\r\n    parseStyles(element, options, rootAppended);\r\n    return options\r\n}\r\n\r\nfunction drawRect(context, options) {\r\n    var x = options.x;\r\n    var y = options.y;\r\n    var width = options.width;\r\n    var height = options.height;\r\n    var cornerRadius = options.rx;\r\n    if (!cornerRadius) {\r\n        context.rect(x, y, width, height)\r\n    } else {\r\n        cornerRadius = _min(cornerRadius, width / 2, height / 2);\r\n        context.save();\r\n        context.translate(x, y);\r\n        context.moveTo(width / 2, 0);\r\n        context.arcTo(width, 0, width, height, cornerRadius);\r\n        context.arcTo(width, height, 0, height, cornerRadius);\r\n        context.arcTo(0, height, 0, 0, cornerRadius);\r\n        context.arcTo(0, 0, cornerRadius, 0, cornerRadius);\r\n        context.lineTo(width / 2, 0);\r\n        context.restore()\r\n    }\r\n}\r\n\r\nfunction drawImage(context, options, shared) {\r\n    var d = new Deferred;\r\n    var image = new window.Image;\r\n    image.onload = function() {\r\n        context.save();\r\n        context.globalAlpha = options.globalAlpha;\r\n        transformElement(context, options);\r\n        clipElement(context, options, shared);\r\n        context.drawImage(image, options.x, options.y, options.width, options.height);\r\n        context.restore();\r\n        d.resolve()\r\n    };\r\n    image.onerror = function() {\r\n        d.resolve()\r\n    };\r\n    image.setAttribute(\"crossOrigin\", \"anonymous\");\r\n    image.src = options.href || options[\"xlink:href\"];\r\n    return d\r\n}\r\n\r\nfunction drawPath(context, dAttr) {\r\n    var dArray = dAttr.replace(/,/g, \" \").split(/([A-Z])/i).filter(item => \"\" !== item.trim());\r\n    var i = 0;\r\n    var params;\r\n    var prevParams;\r\n    var prevParamsLen;\r\n    do {\r\n        params = (dArray[i + 1] || \"\").trim().split(\" \");\r\n        switch (dArray[i]) {\r\n            case \"M\":\r\n                context.moveTo(_number(params[0]), _number(params[1]));\r\n                i += 2;\r\n                break;\r\n            case \"L\":\r\n                for (var j = 0; j < params.length / 2; j++) {\r\n                    context.lineTo(_number(params[2 * j]), _number(params[2 * j + 1]))\r\n                }\r\n                i += 2;\r\n                break;\r\n            case \"C\":\r\n                context.bezierCurveTo(_number(params[0]), _number(params[1]), _number(params[2]), _number(params[3]), _number(params[4]), _number(params[5]));\r\n                i += 2;\r\n                break;\r\n            case \"a\":\r\n                prevParams = dArray[i - 1].trim().split(\" \");\r\n                prevParamsLen = prevParams.length - 1;\r\n                arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(prevParams[prevParamsLen - 1]) + _number(params[5]), _number(prevParams[prevParamsLen]) + _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\r\n                i += 2;\r\n                break;\r\n            case \"A\":\r\n                prevParams = dArray[i - 1].trim().split(\" \");\r\n                prevParamsLen = prevParams.length - 1;\r\n                arcTo(_number(prevParams[prevParamsLen - 1]), _number(prevParams[prevParamsLen]), _number(params[5]), _number(params[6]), _number(params[0]), _number(params[3]), _number(params[4]), context);\r\n                i += 2;\r\n                break;\r\n            case \"Z\":\r\n                context.closePath();\r\n                i += 1;\r\n                break;\r\n            default:\r\n                i++\r\n        }\r\n    } while (i < dArray.length)\r\n}\r\n\r\nfunction parseStyles(element, options, rootAppended) {\r\n    var style = element.style || {};\r\n    var field;\r\n    for (field in style) {\r\n        if (\"\" !== style[field]) {\r\n            options[camelize(field)] = style[field]\r\n        }\r\n    }\r\n    if (rootAppended && domAdapter.isElementNode(element)) {\r\n        style = window.getComputedStyle(element);\r\n        [\"fill\", \"stroke\", \"stroke-width\", \"font-family\", \"font-size\", \"font-style\", \"font-weight\"].forEach((function(prop) {\r\n            if (prop in style && \"\" !== style[prop]) {\r\n                options[camelize(prop)] = style[prop]\r\n            }\r\n        }));\r\n        [\"opacity\", \"fill-opacity\", \"stroke-opacity\"].forEach((function(prop) {\r\n            if (prop in style && \"\" !== style[prop] && \"1\" !== style[prop]) {\r\n                options[prop] = _number(style[prop])\r\n            }\r\n        }))\r\n    }\r\n    options.textDecoration = options.textDecoration || options.textDecorationLine;\r\n    options.globalAlpha = isDefined(options.opacity) ? options.opacity : options.globalAlpha\r\n}\r\n\r\nfunction parseUrl(urlString) {\r\n    var matches = urlString && urlString.match(/url\\(.*#(.*?)[\"']?\\)/i);\r\n    return matches && matches[1]\r\n}\r\n\r\nfunction setFontStyle(context, options) {\r\n    var fontParams = [];\r\n    options.fontSize = options.fontSize || DEFAULT_FONT_SIZE;\r\n    options.fontFamily = options.fontFamily || DEFAULT_FONT_FAMILY;\r\n    options.fill = options.fill || DEFAULT_TEXT_COLOR;\r\n    options.fontStyle && fontParams.push(options.fontStyle);\r\n    options.fontWeight && fontParams.push(options.fontWeight);\r\n    fontParams.push(options.fontSize);\r\n    fontParams.push(options.fontFamily);\r\n    context.font = fontParams.join(\" \");\r\n    context.textAlign = options.textAlign;\r\n    context.fillStyle = options.fill;\r\n    context.globalAlpha = options.globalAlpha\r\n}\r\n\r\nfunction drawText(context, options, shared) {\r\n    setFontStyle(context, options);\r\n    applyFilter(context, options, shared);\r\n    options.text && context.fillText(options.text, options.x || 0, options.y || 0);\r\n    strokeElement(context, options, true);\r\n    drawTextDecoration(context, options, shared)\r\n}\r\n\r\nfunction drawTextDecoration(context, options, shared) {\r\n    if (!options.textDecoration || \"none\" === options.textDecoration) {\r\n        return\r\n    }\r\n    var x = options.x;\r\n    var textWidth = context.measureText(options.text).width;\r\n    var textHeight = parseInt(options.fontSize, 10);\r\n    var lineHeight = textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF < 1 ? 1 : textHeight * TEXT_DECORATION_LINE_WIDTH_COEFF;\r\n    var y = options.y;\r\n    switch (options.textDecoration) {\r\n        case \"line-through\":\r\n            y -= textHeight / 3 + lineHeight / 2;\r\n            break;\r\n        case \"overline\":\r\n            y -= textHeight - lineHeight;\r\n            break;\r\n        case \"underline\":\r\n            y += lineHeight\r\n    }\r\n    context.rect(x, y, textWidth, lineHeight);\r\n    fillElement(context, options, shared);\r\n    strokeElement(context, options)\r\n}\r\n\r\nfunction aggregateOpacity(options) {\r\n    options.strokeOpacity = void 0 !== options[\"stroke-opacity\"] ? options[\"stroke-opacity\"] : 1;\r\n    options.fillOpacity = void 0 !== options[\"fill-opacity\"] ? options[\"fill-opacity\"] : 1;\r\n    if (void 0 !== options.opacity) {\r\n        options.strokeOpacity *= options.opacity;\r\n        options.fillOpacity *= options.opacity\r\n    }\r\n}\r\n\r\nfunction hasTspan(element) {\r\n    var nodes = element.childNodes;\r\n    for (var i = 0; i < nodes.length; i++) {\r\n        if (\"tspan\" === nodes[i].tagName) {\r\n            return true\r\n        }\r\n    }\r\n    return false\r\n}\r\n\r\nfunction drawTextElement(childNodes, context, options, shared) {\r\n    var lines = [];\r\n    var line;\r\n    var offset = 0;\r\n    for (var i = 0; i < childNodes.length; i++) {\r\n        var element = childNodes[i];\r\n        if (void 0 === element.tagName) {\r\n            drawElement(element, context, options, shared)\r\n        } else if (\"tspan\" === element.tagName || \"text\" === element.tagName) {\r\n            var elementOptions = getElementOptions(element, shared.rootAppended);\r\n            var mergedOptions = extend({}, options, elementOptions);\r\n            if (\"tspan\" === element.tagName && hasTspan(element)) {\r\n                drawTextElement(element.childNodes, context, mergedOptions, shared);\r\n                continue\r\n            }\r\n            mergedOptions.textAlign = \"start\";\r\n            if (!line || void 0 !== elementOptions.x) {\r\n                line = {\r\n                    elements: [],\r\n                    options: [],\r\n                    widths: [],\r\n                    offsets: []\r\n                };\r\n                lines.push(line)\r\n            }\r\n            if (void 0 !== elementOptions.y) {\r\n                offset = 0\r\n            }\r\n            if (void 0 !== elementOptions.dy) {\r\n                offset += parseFloat(elementOptions.dy)\r\n            }\r\n            line.elements.push(element);\r\n            line.options.push(mergedOptions);\r\n            line.offsets.push(offset);\r\n            setFontStyle(context, mergedOptions);\r\n            line.widths.push(context.measureText(mergedOptions.text).width)\r\n        }\r\n    }\r\n    lines.forEach((function(line) {\r\n        var commonWidth = line.widths.reduce((function(commonWidth, width) {\r\n            return commonWidth + width\r\n        }), 0);\r\n        var xDiff = 0;\r\n        var currentOffset = 0;\r\n        if (\"center\" === options.textAlign) {\r\n            xDiff = commonWidth / 2\r\n        }\r\n        if (\"end\" === options.textAlign) {\r\n            xDiff = commonWidth\r\n        }\r\n        line.options.forEach((function(o, index) {\r\n            var width = line.widths[index];\r\n            o.x = o.x - xDiff + currentOffset;\r\n            o.y += line.offsets[index];\r\n            currentOffset += width\r\n        }));\r\n        line.elements.forEach((function(element, index) {\r\n            drawTextElement(element.childNodes, context, line.options[index], shared)\r\n        }))\r\n    }))\r\n}\r\n\r\nfunction drawElement(element, context, parentOptions, shared) {\r\n    var tagName = element.tagName;\r\n    var isText = \"text\" === tagName || \"tspan\" === tagName || void 0 === tagName;\r\n    var isImage = \"image\" === tagName;\r\n    var options = extend({}, parentOptions, getElementOptions(element, shared.rootAppended));\r\n    if (\"hidden\" === options.visibility || options[HIDDEN_FOR_EXPORT]) {\r\n        return\r\n    }\r\n    context.save();\r\n    !isImage && transformElement(context, options);\r\n    clipElement(context, options, shared);\r\n    aggregateOpacity(options);\r\n    var promise;\r\n    context.beginPath();\r\n    switch (element.tagName) {\r\n        case void 0:\r\n            drawText(context, options, shared);\r\n            break;\r\n        case \"text\":\r\n        case \"tspan\":\r\n            drawTextElement(element.childNodes, context, options, shared);\r\n            break;\r\n        case \"image\":\r\n            promise = drawImage(context, options, shared);\r\n            break;\r\n        case \"path\":\r\n            drawPath(context, options.d);\r\n            break;\r\n        case \"rect\":\r\n            drawRect(context, options);\r\n            context.closePath();\r\n            break;\r\n        case \"circle\":\r\n            context.arc(options.cx, options.cy, options.r, 0, 2 * PI, 1)\r\n    }\r\n    if (!isText) {\r\n        applyFilter(context, options, shared);\r\n        fillElement(context, options, shared);\r\n        strokeElement(context, options)\r\n    }\r\n    applyGradient(context, options, shared, element);\r\n    context.restore();\r\n    return promise\r\n}\r\n\r\nfunction applyGradient(context, options, _ref, element) {\r\n    var {\r\n        gradients: gradients\r\n    } = _ref;\r\n    if (0 === gradients.length) {\r\n        return\r\n    }\r\n    var id = parseUrl(options.fill);\r\n    if (id && gradients[id]) {\r\n        var box = element.getBBox();\r\n        var gradient = context.createLinearGradient(box.x, 0, box.x + box.width, 0);\r\n        gradients[id].forEach(opt => {\r\n            var offset = parseInt(opt.offset.replace(/%/, \"\"));\r\n            gradient.addColorStop(offset / 100, opt.stopColor)\r\n        });\r\n        context.globalAlpha = options.opacity;\r\n        context.fillStyle = gradient;\r\n        context.fill()\r\n    }\r\n}\r\n\r\nfunction applyFilter(context, options, shared) {\r\n    var filterOptions;\r\n    var id = parseUrl(options.filter);\r\n    if (id) {\r\n        filterOptions = shared.filters[id];\r\n        if (!filterOptions) {\r\n            filterOptions = {\r\n                offsetX: 0,\r\n                offsetY: 0,\r\n                blur: 0,\r\n                color: \"#000\"\r\n            }\r\n        }\r\n        context.shadowOffsetX = filterOptions.offsetX;\r\n        context.shadowOffsetY = filterOptions.offsetY;\r\n        context.shadowColor = filterOptions.color;\r\n        context.shadowBlur = filterOptions.blur\r\n    }\r\n}\r\n\r\nfunction transformElement(context, options) {\r\n    context.translate(options.translateX || 0, options.translateY || 0);\r\n    options.translateX = void 0;\r\n    options.translateY = void 0;\r\n    if (options.rotationAngle) {\r\n        context.translate(options.rotationX || 0, options.rotationY || 0);\r\n        context.rotate(options.rotationAngle * PI / 180);\r\n        context.translate(-(options.rotationX || 0), -(options.rotationY || 0));\r\n        options.rotationAngle = void 0;\r\n        options.rotationX = void 0;\r\n        options.rotationY = void 0\r\n    }\r\n    if (isFinite(options.scaleX)) {\r\n        context.scale(options.scaleX, options.scaleY);\r\n        options.scaleX = void 0;\r\n        options.scaleY = void 0\r\n    }\r\n}\r\n\r\nfunction clipElement(context, options, shared) {\r\n    if (options[\"clip-path\"]) {\r\n        drawElement(shared.clipPaths[parseUrl(options[\"clip-path\"])], context, {}, shared);\r\n        context.clip();\r\n        options[\"clip-path\"] = void 0\r\n    }\r\n}\r\n\r\nfunction hex2rgba(hexColor, alpha) {\r\n    var color = new Color(hexColor);\r\n    return \"rgba(\" + color.r + \",\" + color.g + \",\" + color.b + \",\" + alpha + \")\"\r\n}\r\n\r\nfunction createGradient(element) {\r\n    var options = [];\r\n    _each(element.childNodes, (_, _ref2) => {\r\n        var {\r\n            attributes: attributes\r\n        } = _ref2;\r\n        options.push({\r\n            offset: attributes.offset.value,\r\n            stopColor: attributes[\"stop-color\"].value\r\n        })\r\n    });\r\n    return options\r\n}\r\n\r\nfunction createFilter(element) {\r\n    var color;\r\n    var opacity;\r\n    var filterOptions = {};\r\n    _each(element.childNodes, (function(_, node) {\r\n        var attr = node.attributes;\r\n        if (!attr.result) {\r\n            return\r\n        }\r\n        switch (attr.result.value) {\r\n            case \"gaussianBlurResult\":\r\n                filterOptions.blur = _number(attr.stdDeviation.value);\r\n                break;\r\n            case \"offsetResult\":\r\n                filterOptions.offsetX = _number(attr.dx.value);\r\n                filterOptions.offsetY = _number(attr.dy.value);\r\n                break;\r\n            case \"floodResult\":\r\n                color = attr[\"flood-color\"] ? attr[\"flood-color\"].value : \"#000\";\r\n                opacity = attr[\"flood-opacity\"] ? attr[\"flood-opacity\"].value : 1;\r\n                filterOptions.color = hex2rgba(color, opacity)\r\n        }\r\n    }));\r\n    return filterOptions\r\n}\r\n\r\nfunction asyncEach(array, callback) {\r\n    var d = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : new Deferred;\r\n    var i = 0;\r\n    for (; i < array.length; i++) {\r\n        var result = callback(array[i]);\r\n        if (isPromise(result)) {\r\n            result.then(() => {\r\n                asyncEach(Array.prototype.slice.call(array, i + 1), callback, d)\r\n            });\r\n            break\r\n        }\r\n    }\r\n    if (i === array.length) {\r\n        d.resolve()\r\n    }\r\n    return d\r\n}\r\n\r\nfunction drawCanvasElements(elements, context, parentOptions, shared) {\r\n    return asyncEach(elements, (function(element) {\r\n        switch (element.tagName && element.tagName.toLowerCase()) {\r\n            case \"g\":\r\n            case \"svg\":\r\n                var options = extend({}, parentOptions, getElementOptions(element, shared.rootAppended));\r\n                context.save();\r\n                transformElement(context, options);\r\n                clipElement(context, options, shared);\r\n                var onDone = () => {\r\n                    context.restore()\r\n                };\r\n                var d = drawCanvasElements(element.childNodes, context, options, shared);\r\n                if (isPromise(d)) {\r\n                    d.then(onDone)\r\n                } else {\r\n                    onDone()\r\n                }\r\n                return d;\r\n            case \"defs\":\r\n                return drawCanvasElements(element.childNodes, context, {}, shared);\r\n            case \"clippath\":\r\n                shared.clipPaths[element.attributes.id.textContent] = element.childNodes[0];\r\n                break;\r\n            case \"pattern\":\r\n                shared.patterns[element.attributes.id.textContent] = element;\r\n                break;\r\n            case \"filter\":\r\n                shared.filters[element.id] = createFilter(element);\r\n                break;\r\n            case \"lineargradient\":\r\n                shared.gradients[element.attributes.id.textContent] = createGradient(element);\r\n                break;\r\n            default:\r\n                return drawElement(element, context, parentOptions, shared)\r\n        }\r\n    }))\r\n}\r\n\r\nfunction setLineDash(context, options) {\r\n    var matches = options[\"stroke-dasharray\"] && options[\"stroke-dasharray\"].match(/(\\d+)/g);\r\n    if (matches && matches.length) {\r\n        matches = _map(matches, (function(item) {\r\n            return _number(item)\r\n        }));\r\n        context.setLineDash(matches)\r\n    }\r\n}\r\n\r\nfunction strokeElement(context, options, isText) {\r\n    var stroke = options.stroke;\r\n    if (stroke && \"none\" !== stroke && 0 !== options[\"stroke-width\"]) {\r\n        setLineDash(context, options);\r\n        context.lineJoin = options[\"stroke-linejoin\"];\r\n        context.lineWidth = options[\"stroke-width\"];\r\n        context.globalAlpha = options.strokeOpacity;\r\n        context.strokeStyle = stroke;\r\n        isText ? context.strokeText(options.text, options.x, options.y) : context.stroke();\r\n        context.globalAlpha = 1\r\n    }\r\n}\r\n\r\nfunction getPattern(context, pattern, shared) {\r\n    var options = getElementOptions(pattern, shared.rootAppended);\r\n    var patternCanvas = createCanvas(options.width, options.height, 0);\r\n    var patternContext = patternCanvas.getContext(\"2d\");\r\n    drawCanvasElements(pattern.childNodes, patternContext, options, shared);\r\n    return context.createPattern(patternCanvas, \"repeat\")\r\n}\r\n\r\nfunction fillElement(context, options, shared) {\r\n    var fill = options.fill;\r\n    if (fill && \"none\" !== fill) {\r\n        if (-1 === fill.search(/url/)) {\r\n            context.fillStyle = fill\r\n        } else {\r\n            var pattern = shared.patterns[parseUrl(fill)];\r\n            if (!pattern) {\r\n                return\r\n            }\r\n            context.fillStyle = getPattern(context, pattern, shared)\r\n        }\r\n        context.globalAlpha = options.fillOpacity;\r\n        context.fill();\r\n        context.globalAlpha = 1\r\n    }\r\n}\r\nparseAttributes = function(attributes) {\r\n    var newAttributes = {};\r\n    var attr;\r\n    _each(attributes, (function(index, item) {\r\n        attr = item.textContent;\r\n        if (isFinite(attr)) {\r\n            attr = _number(attr)\r\n        }\r\n        newAttributes[item.name.toLowerCase()] = attr\r\n    }));\r\n    return newAttributes\r\n};\r\n\r\nfunction drawBackground(context, width, height, backgroundColor, margin) {\r\n    context.fillStyle = backgroundColor || \"#ffffff\";\r\n    context.fillRect(-margin, -margin, width + 2 * margin, height + 2 * margin)\r\n}\r\n\r\nfunction createInvisibleDiv() {\r\n    var invisibleDiv = domAdapter.createElement(\"div\");\r\n    invisibleDiv.style.left = \"-9999px\";\r\n    invisibleDiv.style.position = \"absolute\";\r\n    return invisibleDiv\r\n}\r\n\r\nfunction convertSvgToCanvas(svg, canvas, rootAppended) {\r\n    return drawCanvasElements(svg.childNodes, canvas.getContext(\"2d\"), {}, {\r\n        clipPaths: {},\r\n        patterns: {},\r\n        filters: {},\r\n        gradients: {},\r\n        rootAppended: rootAppended\r\n    })\r\n}\r\n\r\nfunction getCanvasFromSvg(markup, _ref3) {\r\n    var {\r\n        width: width,\r\n        height: height,\r\n        backgroundColor: backgroundColor,\r\n        margin: margin,\r\n        pixelRatio: pixelRatio,\r\n        svgToCanvas: svgToCanvas = convertSvgToCanvas\r\n    } = _ref3;\r\n    var canvas = createCanvas(width, height, margin);\r\n    var context = canvas.getContext(\"2d\");\r\n    context.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\r\n    var svgElem = getSvgElement(markup);\r\n    var invisibleDiv;\r\n    var markupIsDomElement = domAdapter.isElementNode(markup);\r\n    context.translate(margin, margin);\r\n    domAdapter.getBody().appendChild(canvas);\r\n    if (!markupIsDomElement) {\r\n        invisibleDiv = createInvisibleDiv();\r\n        invisibleDiv.appendChild(svgElem);\r\n        domAdapter.getBody().appendChild(invisibleDiv)\r\n    }\r\n    if (svgElem.attributes.direction) {\r\n        canvas.dir = svgElem.attributes.direction.textContent\r\n    }\r\n    drawBackground(context, width, height, backgroundColor, margin);\r\n    return fromPromise(svgToCanvas(svgElem, canvas, markupIsDomElement && contains(domAdapter.getBody(), markup))).then(() => canvas).always(() => {\r\n        invisibleDiv && domAdapter.getBody().removeChild(invisibleDiv);\r\n        domAdapter.getBody().removeChild(canvas)\r\n    })\r\n}\r\nexport var imageCreator = {\r\n    getImageData: function(markup, options) {\r\n        var mimeType = \"image/\" + options.format;\r\n        if (isFunction(options.__parseAttributesFn)) {\r\n            parseAttributes = options.__parseAttributesFn\r\n        }\r\n        return getCanvasFromSvg(markup, options).then(canvas => getStringFromCanvas(canvas, mimeType))\r\n    },\r\n    getData: function(markup, options) {\r\n        var that = this;\r\n        return imageCreator.getImageData(markup, options).then(binaryData => {\r\n            var mimeType = \"image/\" + options.format;\r\n            var data = isFunction(window.Blob) && !options.forceProxy ? that._getBlob(binaryData, mimeType) : that._getBase64(binaryData);\r\n            return data\r\n        })\r\n    },\r\n    _getBlob: function(binaryData, mimeType) {\r\n        var i;\r\n        var dataArray = new Uint8Array(binaryData.length);\r\n        for (i = 0; i < binaryData.length; i++) {\r\n            dataArray[i] = binaryData.charCodeAt(i)\r\n        }\r\n        return new window.Blob([dataArray.buffer], {\r\n            type: mimeType\r\n        })\r\n    },\r\n    _getBase64: function(binaryData) {\r\n        return window.btoa(binaryData)\r\n    }\r\n};\r\nexport function getData(data, options) {\r\n    return imageCreator.getData(data, options)\r\n}\r\nexport function testFormats(formats) {\r\n    var canvas = createCanvas(100, 100, 0);\r\n    return formats.reduce((function(r, f) {\r\n        var mimeType = (\"image/\" + f).toLowerCase();\r\n        if (-1 !== canvas.toDataURL(mimeType).indexOf(mimeType)) {\r\n            r.supported.push(f)\r\n        } else {\r\n            r.unsupported.push(f)\r\n        }\r\n        return r\r\n    }), {\r\n        supported: [],\r\n        unsupported: []\r\n    })\r\n}\r\n"]},"metadata":{},"sourceType":"module"}