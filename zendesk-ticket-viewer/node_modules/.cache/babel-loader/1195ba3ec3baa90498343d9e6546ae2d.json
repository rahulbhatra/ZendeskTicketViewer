{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/data_grid/ui.data_grid.summary.js)\r\n * Version: 21.2.3\r\n * Build date: Thu Oct 28 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport { noop } from \"../../core/utils/common\";\nimport { isDefined, isPlainObject, isEmptyObject, isString, isFunction } from \"../../core/utils/type\";\nimport { each, map } from \"../../core/utils/iterator\";\nimport { extend } from \"../../core/utils/extend\";\nimport { compileGetter } from \"../../core/utils/data\";\nimport errors from \"../widget/ui.errors\";\nimport gridCore from \"./ui.data_grid.core\";\nimport messageLocalization from \"../../localization/message\";\nimport dataSourceAdapter from \"./ui.data_grid.data_source_adapter\";\nimport { ColumnsView } from \"../grid_core/ui.grid_core.columns_view\";\nimport AggregateCalculator from \"./aggregate_calculator\";\nimport dataQuery from \"../../data/query\";\nimport storeHelper from \"../../data/store_helper\";\nimport { normalizeSortingInfo } from \"../../data/utils\";\nvar DATAGRID_TOTAL_FOOTER_CLASS = \"dx-datagrid-total-footer\";\nvar DATAGRID_SUMMARY_ITEM_CLASS = \"dx-datagrid-summary-item\";\nvar DATAGRID_TEXT_CONTENT_CLASS = \"dx-datagrid-text-content\";\nvar DATAGRID_GROUP_FOOTER_CLASS = \"dx-datagrid-group-footer\";\nvar DATAGRID_GROUP_TEXT_CONTENT_CLASS = \"dx-datagrid-group-text-content\";\nvar DATAGRID_NOWRAP_CLASS = \"dx-datagrid-nowrap\";\nvar DATAGRID_GROUP_FOOTER_ROW_TYPE = \"groupFooter\";\nexport var renderSummaryCell = function (cell, options) {\n  var $cell = $(cell);\n  var column = options.column;\n  var summaryItems = options.summaryItems;\n  var $summaryItems = [];\n\n  if (!column.command && summaryItems) {\n    for (var i = 0; i < summaryItems.length; i++) {\n      var summaryItem = summaryItems[i];\n      $summaryItems.push($(\"<div>\").css(\"textAlign\", summaryItem.alignment || column.alignment).addClass(DATAGRID_SUMMARY_ITEM_CLASS).addClass(DATAGRID_TEXT_CONTENT_CLASS).addClass(summaryItem.cssClass).toggleClass(DATAGRID_GROUP_TEXT_CONTENT_CLASS, \"group\" === options.rowType).text(gridCore.getSummaryText(summaryItem, options.summaryTexts)));\n    }\n\n    $cell.append($summaryItems);\n  }\n};\n\nvar getSummaryCellOptions = function (that, options) {\n  var summaryTexts = that.option(\"summary.texts\") || {};\n  return {\n    totalItem: options.row,\n    summaryItems: options.row.summaryCells[options.columnIndex],\n    summaryTexts: summaryTexts\n  };\n};\n\nvar getGroupAggregates = function (data) {\n  return data.summary || data.aggregates || [];\n};\n\nvar recalculateWhileEditing = function (that) {\n  return that.option(\"summary.recalculateWhileEditing\");\n};\n\nexport var FooterView = ColumnsView.inherit({\n  _getRows: function () {\n    return this._dataController.footerItems();\n  },\n  _getCellOptions: function (options) {\n    return extend(this.callBase(options), getSummaryCellOptions(this, options));\n  },\n  _renderCellContent: function ($cell, options) {\n    renderSummaryCell($cell, options);\n    this.callBase($cell, options);\n  },\n  _renderCore: function (change) {\n    var needUpdateScrollLeft = false;\n\n    var totalItem = this._dataController.footerItems()[0];\n\n    if (!change || !change.columnIndices) {\n      this.element().empty().addClass(DATAGRID_TOTAL_FOOTER_CLASS).toggleClass(DATAGRID_NOWRAP_CLASS, !this.option(\"wordWrapEnabled\"));\n      needUpdateScrollLeft = true;\n    }\n\n    if (totalItem && totalItem.summaryCells && totalItem.summaryCells.length) {\n      this._updateContent(this._renderTable({\n        change: change\n      }), change);\n\n      needUpdateScrollLeft && this._updateScrollLeftPosition();\n    }\n  },\n  _updateContent: function ($newTable, change) {\n    if (change && \"update\" === change.changeType && change.columnIndices) {\n      var $row = this.getTableElement().find(\".dx-row\");\n      var $newRow = $newTable.find(\".dx-row\");\n\n      this._updateCells($row, $newRow, change.columnIndices[0]);\n    } else {\n      return this.callBase.apply(this, arguments);\n    }\n  },\n  _rowClick: function (e) {\n    var item = this._dataController.footerItems()[e.rowIndex] || {};\n    this.executeAction(\"onRowClick\", extend({}, e, item));\n  },\n  _columnOptionChanged: function (e) {\n    var optionNames = e.optionNames;\n\n    if (e.changeTypes.grouping) {\n      return;\n    }\n\n    if (optionNames.width || optionNames.visibleWidth) {\n      this.callBase(e);\n    }\n  },\n  _handleDataChanged: function (e) {\n    var changeType = e.changeType;\n\n    if (\"update\" === e.changeType && e.repaintChangesOnly) {\n      if (!e.totalColumnIndices) {\n        this.render();\n      } else if (e.totalColumnIndices.length) {\n        this.render(null, {\n          changeType: \"update\",\n          columnIndices: [e.totalColumnIndices]\n        });\n      }\n    } else if (\"refresh\" === changeType || \"append\" === changeType || \"prepend\" === changeType) {\n      this.render();\n    }\n  },\n  getHeight: function () {\n    return this.getElementHeight();\n  },\n  isVisible: function () {\n    return !!this._dataController.footerItems().length;\n  }\n});\nvar SummaryDataSourceAdapterExtender = {\n  init: function () {\n    this.callBase.apply(this, arguments);\n    this._totalAggregates = [];\n    this._summaryGetter = noop;\n  },\n  summaryGetter: function (_summaryGetter) {\n    if (!arguments.length) {\n      return this._summaryGetter;\n    }\n\n    if (isFunction(_summaryGetter)) {\n      this._summaryGetter = _summaryGetter;\n    }\n  },\n  summary: function (_summary) {\n    if (!arguments.length) {\n      return this._summaryGetter();\n    }\n\n    this._summaryGetter = function () {\n      return _summary;\n    };\n  },\n  totalAggregates: function () {\n    return this._totalAggregates;\n  },\n  isLastLevelGroupItemsPagingLocal: function () {\n    var summary = this.summary();\n    var sortByGroupsInfo = summary && summary.sortByGroups();\n    return sortByGroupsInfo && sortByGroupsInfo.length;\n  },\n  sortLastLevelGroupItems: function (items, groups, paths) {\n    var groupedItems = storeHelper.multiLevelGroup(dataQuery(items), groups).toArray();\n    var result = [];\n    paths.forEach(function (path) {\n      !function forEachGroup(groups, groupCount, callback, path) {\n        path = path || [];\n\n        for (var i = 0; i < groups.length; i++) {\n          path.push(groups[i].key);\n\n          if (1 === groupCount) {\n            callback(path, groups[i].items);\n          } else {\n            forEachGroup(groups[i].items, groupCount - 1, callback, path);\n          }\n\n          path.pop();\n        }\n      }(groupedItems, groups.length, function (itemsPath, items) {\n        if (path.toString() === itemsPath.toString()) {\n          result = result.concat(items);\n        }\n      });\n    });\n    return result;\n  }\n};\n\nvar SummaryDataSourceAdapterClientExtender = function () {\n  var calculateAggregates = function (that, summary, data, groupLevel) {\n    var calculator;\n\n    if (recalculateWhileEditing(that)) {\n      var editingController = that.getController(\"editing\");\n\n      if (editingController) {\n        var insertedData = editingController.getInsertedData();\n\n        if (insertedData.length) {\n          data = function applyAddedData(data, insertedData, groupLevel) {\n            if (groupLevel) {\n              return applyAddedData(data, insertedData.map(item => ({\n                items: [item]\n              }), groupLevel - 1));\n            }\n\n            return data.concat(insertedData);\n          }(data, insertedData, groupLevel);\n        }\n\n        var removedData = editingController.getRemovedData();\n\n        if (removedData.length) {\n          data = function applyRemovedData(data, removedData, groupLevel) {\n            if (groupLevel) {\n              return data.map(data => {\n                var updatedData = {};\n                var updatedItems = applyRemovedData(data.items || [], removedData, groupLevel - 1);\n                Object.defineProperty(updatedData, \"aggregates\", {\n                  get: () => data.aggregates,\n                  set: value => {\n                    data.aggregates = value;\n                  }\n                });\n                return extend(updatedData, data, {\n                  items: updatedItems\n                });\n              });\n            }\n\n            return data.filter(data => removedData.indexOf(data) < 0);\n          }(data, removedData, groupLevel);\n        }\n      }\n    }\n\n    if (summary) {\n      calculator = new AggregateCalculator({\n        totalAggregates: summary.totalAggregates,\n        groupAggregates: summary.groupAggregates,\n        data: data,\n        groupLevel: groupLevel\n      });\n      calculator.calculate();\n    }\n\n    return calculator ? calculator.totalAggregates() : [];\n  };\n\n  var sortGroupsBySummary = function (data, group, summary) {\n    var sortByGroups = summary && summary.sortByGroups && summary.sortByGroups();\n\n    if (sortByGroups && sortByGroups.length) {\n      return function sortGroupsBySummaryCore(items, groups, sortByGroups) {\n        if (!items || !groups.length) {\n          return items;\n        }\n\n        var group = groups[0];\n        var sorts = sortByGroups[0];\n        var query;\n\n        if (group && sorts && sorts.length) {\n          query = dataQuery(items);\n          each(sorts, function (index) {\n            if (0 === index) {\n              query = query.sortBy(this.selector, this.desc);\n            } else {\n              query = query.thenBy(this.selector, this.desc);\n            }\n          });\n          query.enumerate().done(function (sortedItems) {\n            items = sortedItems;\n          });\n        }\n\n        groups = groups.slice(1);\n        sortByGroups = sortByGroups.slice(1);\n\n        if (groups.length && sortByGroups.length) {\n          each(items, function () {\n            this.items = sortGroupsBySummaryCore(this.items, groups, sortByGroups);\n          });\n        }\n\n        return items;\n      }(data, group, sortByGroups);\n    }\n\n    return data;\n  };\n\n  return {\n    _customizeRemoteOperations: function (options) {\n      var summary = this.summary();\n\n      if (summary) {\n        if (options.remoteOperations.summary) {\n          if (!options.isCustomLoading || options.storeLoadOptions.isLoadingAll) {\n            if (options.storeLoadOptions.group) {\n              if (options.remoteOperations.grouping) {\n                options.storeLoadOptions.groupSummary = summary.groupAggregates;\n              } else if (summary.groupAggregates.length) {\n                options.remoteOperations.paging = false;\n              }\n            }\n\n            options.storeLoadOptions.totalSummary = summary.totalAggregates;\n          }\n        } else if (summary.totalAggregates.length || summary.groupAggregates.length && options.storeLoadOptions.group) {\n          options.remoteOperations.paging = false;\n        }\n      }\n\n      this.callBase.apply(this, arguments);\n      var cachedExtra = options.cachedData.extra;\n\n      if (cachedExtra && cachedExtra.summary && !options.isCustomLoading) {\n        options.storeLoadOptions.totalSummary = void 0;\n      }\n    },\n    _handleDataLoadedCore: function (options) {\n      var groups = normalizeSortingInfo(options.storeLoadOptions.group || options.loadOptions.group || []);\n      var remoteOperations = options.remoteOperations || {};\n      var summary = this.summaryGetter()(remoteOperations);\n      var totalAggregates;\n\n      if (!options.isCustomLoading || options.storeLoadOptions.isLoadingAll) {\n        if (remoteOperations.summary) {\n          if (!remoteOperations.paging && groups.length && summary) {\n            if (!remoteOperations.grouping) {\n              calculateAggregates(this, {\n                groupAggregates: summary.groupAggregates\n              }, options.data, groups.length);\n            }\n\n            options.data = sortGroupsBySummary(options.data, groups, summary);\n          }\n        } else if (!remoteOperations.paging) {\n          totalAggregates = calculateAggregates(this, summary, options.data, groups.length);\n          options.data = sortGroupsBySummary(options.data, groups, summary);\n          options.extra = isPlainObject(options.extra) ? options.extra : {};\n          options.extra.summary = totalAggregates;\n        }\n      }\n\n      if (!options.isCustomLoading) {\n        this._totalAggregates = options.extra && options.extra.summary || this._totalAggregates;\n      }\n\n      this.callBase(options);\n    }\n  };\n}();\n\ndataSourceAdapter.extend(SummaryDataSourceAdapterExtender);\ndataSourceAdapter.extend(SummaryDataSourceAdapterClientExtender);\ngridCore.registerModule(\"summary\", {\n  defaultOptions: function () {\n    return {\n      summary: {\n        groupItems: void 0,\n        totalItems: void 0,\n        calculateCustomSummary: void 0,\n        skipEmptyValues: true,\n        recalculateWhileEditing: false,\n        texts: {\n          sum: messageLocalization.format(\"dxDataGrid-summarySum\"),\n          sumOtherColumn: messageLocalization.format(\"dxDataGrid-summarySumOtherColumn\"),\n          min: messageLocalization.format(\"dxDataGrid-summaryMin\"),\n          minOtherColumn: messageLocalization.format(\"dxDataGrid-summaryMinOtherColumn\"),\n          max: messageLocalization.format(\"dxDataGrid-summaryMax\"),\n          maxOtherColumn: messageLocalization.format(\"dxDataGrid-summaryMaxOtherColumn\"),\n          avg: messageLocalization.format(\"dxDataGrid-summaryAvg\"),\n          avgOtherColumn: messageLocalization.format(\"dxDataGrid-summaryAvgOtherColumn\"),\n          count: messageLocalization.format(\"dxDataGrid-summaryCount\")\n        }\n      },\n      sortByGroupSummaryInfo: void 0\n    };\n  },\n  views: {\n    footerView: FooterView\n  },\n  extenders: {\n    controllers: {\n      data: {\n        _isDataColumn: function (column) {\n          return column && (!isDefined(column.groupIndex) || column.showWhenGrouped);\n        },\n        _isGroupFooterVisible: function () {\n          var groupItems = this.option(\"summary.groupItems\") || [];\n\n          for (var i = 0; i < groupItems.length; i++) {\n            var groupItem = groupItems[i];\n\n            var column = this._columnsController.columnOption(groupItem.showInColumn || groupItem.column);\n\n            if (groupItem.showInGroupFooter && this._isDataColumn(column)) {\n              return true;\n            }\n          }\n\n          return false;\n        },\n        _processGroupItems: function (items, groupCount, options) {\n          var data = options && options.data;\n          var result = this.callBase.apply(this, arguments);\n\n          if (options) {\n            if (void 0 === options.isGroupFooterVisible) {\n              options.isGroupFooterVisible = this._isGroupFooterVisible();\n            }\n\n            if (data && data.items && options.isGroupFooterVisible && (options.collectContinuationItems || !data.isContinuationOnNextPage)) {\n              result.push({\n                rowType: DATAGRID_GROUP_FOOTER_ROW_TYPE,\n                key: options.path.slice(),\n                data: data,\n                groupIndex: options.path.length - 1,\n                values: []\n              });\n            }\n          }\n\n          return result;\n        },\n        _processGroupItem: function (groupItem, options) {\n          var that = this;\n\n          if (!options.summaryGroupItems) {\n            options.summaryGroupItems = that.option(\"summary.groupItems\") || [];\n          }\n\n          if (\"group\" === groupItem.rowType) {\n            var groupColumnIndex = -1;\n            var afterGroupColumnIndex = -1;\n            each(options.visibleColumns, function (visibleIndex) {\n              var prevColumn = options.visibleColumns[visibleIndex - 1];\n\n              if (groupItem.groupIndex === this.groupIndex) {\n                groupColumnIndex = this.index;\n              }\n\n              if (visibleIndex > 0 && \"expand\" === prevColumn.command && \"expand\" !== this.command) {\n                afterGroupColumnIndex = this.index;\n              }\n            });\n            groupItem.summaryCells = this._calculateSummaryCells(options.summaryGroupItems, getGroupAggregates(groupItem.data), options.visibleColumns, function (summaryItem, column) {\n              if (summaryItem.showInGroupFooter) {\n                return -1;\n              }\n\n              if (summaryItem.alignByColumn && column && !isDefined(column.groupIndex) && column.index !== afterGroupColumnIndex) {\n                return column.index;\n              } else {\n                return groupColumnIndex;\n              }\n            });\n          }\n\n          if (groupItem.rowType === DATAGRID_GROUP_FOOTER_ROW_TYPE) {\n            groupItem.summaryCells = this._calculateSummaryCells(options.summaryGroupItems, getGroupAggregates(groupItem.data), options.visibleColumns, function (summaryItem, column) {\n              return summaryItem.showInGroupFooter && that._isDataColumn(column) ? column.index : -1;\n            });\n          }\n\n          return groupItem;\n        },\n        _calculateSummaryCells: function (summaryItems, aggregates, visibleColumns, calculateTargetColumnIndex) {\n          var that = this;\n          var summaryCells = [];\n          var summaryCellsByColumns = {};\n          each(summaryItems, function (summaryIndex, summaryItem) {\n            var column = that._columnsController.columnOption(summaryItem.column);\n\n            var showInColumn = summaryItem.showInColumn && that._columnsController.columnOption(summaryItem.showInColumn) || column;\n            var columnIndex = calculateTargetColumnIndex(summaryItem, showInColumn);\n\n            if (columnIndex >= 0) {\n              if (!summaryCellsByColumns[columnIndex]) {\n                summaryCellsByColumns[columnIndex] = [];\n              }\n\n              var aggregate = aggregates[summaryIndex];\n\n              if (aggregate === aggregate) {\n                var valueFormat;\n\n                if (isDefined(summaryItem.valueFormat)) {\n                  valueFormat = summaryItem.valueFormat;\n                } else if (\"count\" !== summaryItem.summaryType) {\n                  valueFormat = gridCore.getFormatByDataType(column && column.dataType);\n                }\n\n                summaryCellsByColumns[columnIndex].push(extend({}, summaryItem, {\n                  value: isString(aggregate) && column && column.deserializeValue ? column.deserializeValue(aggregate) : aggregate,\n                  valueFormat: valueFormat,\n                  columnCaption: column && column.index !== columnIndex ? column.caption : void 0\n                }));\n              }\n            }\n          });\n\n          if (!isEmptyObject(summaryCellsByColumns)) {\n            each(visibleColumns, function () {\n              summaryCells.push(summaryCellsByColumns[this.index] || []);\n            });\n          }\n\n          return summaryCells;\n        },\n        _getSummaryCells: function (summaryTotalItems, totalAggregates) {\n          var that = this;\n          var columnsController = that._columnsController;\n          return that._calculateSummaryCells(summaryTotalItems, totalAggregates, columnsController.getVisibleColumns(), function (summaryItem, column) {\n            return that._isDataColumn(column) ? column.index : -1;\n          });\n        },\n        _updateItemsCore: function (change) {\n          var summaryCells;\n          var dataSource = this._dataSource;\n          var footerItems = this._footerItems;\n          var oldSummaryCells = footerItems && footerItems[0] && footerItems[0].summaryCells;\n          var summaryTotalItems = this.option(\"summary.totalItems\");\n          this._footerItems = [];\n\n          if (dataSource && summaryTotalItems && summaryTotalItems.length) {\n            var totalAggregates = dataSource.totalAggregates();\n            summaryCells = this._getSummaryCells(summaryTotalItems, totalAggregates);\n\n            if (change && change.repaintChangesOnly && oldSummaryCells) {\n              change.totalColumnIndices = summaryCells.map(function (summaryCell, index) {\n                if (JSON.stringify(summaryCell) !== JSON.stringify(oldSummaryCells[index])) {\n                  return index;\n                }\n\n                return -1;\n              }).filter(index => index >= 0);\n            }\n\n            if (summaryCells.length) {\n              this._footerItems.push({\n                rowType: \"totalFooter\",\n                summaryCells: summaryCells\n              });\n            }\n          }\n\n          this.callBase(change);\n        },\n        _prepareUnsavedDataSelector: function (selector) {\n          if (recalculateWhileEditing(this)) {\n            var editingController = this.getController(\"editing\");\n\n            if (editingController) {\n              return function (data) {\n                data = editingController.getUpdatedData(data);\n                return selector(data);\n              };\n            }\n          }\n\n          return selector;\n        },\n        _prepareAggregateSelector: function (selector, aggregator) {\n          selector = this._prepareUnsavedDataSelector(selector);\n\n          if (\"avg\" === aggregator || \"sum\" === aggregator) {\n            return function (data) {\n              var value = selector(data);\n              return isDefined(value) ? Number(value) : value;\n            };\n          }\n\n          return selector;\n        },\n        _getAggregates: function (summaryItems, remoteOperations) {\n          var that = this;\n          var columnsController = that.getController(\"columns\");\n          var calculateCustomSummary = that.option(\"summary.calculateCustomSummary\");\n          var commonSkipEmptyValues = that.option(\"summary.skipEmptyValues\");\n          return map(summaryItems || [], function (summaryItem) {\n            var column = columnsController.columnOption(summaryItem.column);\n            var calculateCellValue = column && column.calculateCellValue ? column.calculateCellValue.bind(column) : compileGetter(column ? column.dataField : summaryItem.column);\n            var aggregator = summaryItem.summaryType || \"count\";\n            var selector = summaryItem.column;\n            var skipEmptyValues = isDefined(summaryItem.skipEmptyValues) ? summaryItem.skipEmptyValues : commonSkipEmptyValues;\n\n            if (remoteOperations) {\n              return {\n                selector: summaryItem.column,\n                summaryType: aggregator\n              };\n            } else {\n              selector = that._prepareAggregateSelector(calculateCellValue, aggregator);\n\n              if (\"custom\" === aggregator) {\n                if (!calculateCustomSummary) {\n                  errors.log(\"E1026\");\n\n                  calculateCustomSummary = function () {};\n                }\n\n                var options = {\n                  component: that.component,\n                  name: summaryItem.name\n                };\n                calculateCustomSummary(options);\n                options.summaryProcess = \"calculate\";\n                aggregator = {\n                  seed: function (groupIndex) {\n                    options.summaryProcess = \"start\";\n                    options.totalValue = void 0;\n                    options.groupIndex = groupIndex;\n                    delete options.value;\n                    calculateCustomSummary(options);\n                    return options.totalValue;\n                  },\n                  step: function (totalValue, value) {\n                    options.summaryProcess = \"calculate\";\n                    options.totalValue = totalValue;\n                    options.value = value;\n                    calculateCustomSummary(options);\n                    return options.totalValue;\n                  },\n                  finalize: function (totalValue) {\n                    options.summaryProcess = \"finalize\";\n                    options.totalValue = totalValue;\n                    delete options.value;\n                    calculateCustomSummary(options);\n                    return options.totalValue;\n                  }\n                };\n              }\n\n              return {\n                selector: selector,\n                aggregator: aggregator,\n                skipEmptyValues: skipEmptyValues\n              };\n            }\n          });\n        },\n        _addSortInfo: function (sortByGroups, groupColumn, selector, sortOrder) {\n          if (groupColumn) {\n            var groupIndex = groupColumn.groupIndex;\n            sortOrder = sortOrder || groupColumn.sortOrder;\n\n            if (isDefined(groupIndex)) {\n              sortByGroups[groupIndex] = sortByGroups[groupIndex] || [];\n              sortByGroups[groupIndex].push({\n                selector: selector,\n                desc: \"desc\" === sortOrder\n              });\n            }\n          }\n        },\n        _findSummaryItem: function (summaryItems, name) {\n          var summaryItemIndex = -1;\n\n          if (isDefined(name)) {\n            each(summaryItems || [], function (index) {\n              if (this.name === name || index === name || this.summaryType === name || this.column === name || (summaryItem = this, summaryType = summaryItem.summaryType, column = summaryItem.column, summaryType && column && summaryType + \"_\" + column) === name) {\n                summaryItemIndex = index;\n                return false;\n              }\n\n              var summaryItem, summaryType, column;\n            });\n          }\n\n          return summaryItemIndex;\n        },\n        _getSummarySortByGroups: function (sortByGroupSummaryInfo, groupSummaryItems) {\n          var that = this;\n          var columnsController = that._columnsController;\n          var groupColumns = columnsController.getGroupColumns();\n          var sortByGroups = [];\n\n          if (!groupSummaryItems || !groupSummaryItems.length) {\n            return;\n          }\n\n          each(sortByGroupSummaryInfo || [], function () {\n            var sortOrder = this.sortOrder;\n            var groupColumn = this.groupColumn;\n\n            var summaryItemIndex = that._findSummaryItem(groupSummaryItems, this.summaryItem);\n\n            if (summaryItemIndex < 0) {\n              return;\n            }\n\n            var selector = function (data) {\n              return getGroupAggregates(data)[summaryItemIndex];\n            };\n\n            if (isDefined(groupColumn)) {\n              groupColumn = columnsController.columnOption(groupColumn);\n\n              that._addSortInfo(sortByGroups, groupColumn, selector, sortOrder);\n            } else {\n              each(groupColumns, function (groupIndex, groupColumn) {\n                that._addSortInfo(sortByGroups, groupColumn, selector, sortOrder);\n              });\n            }\n          });\n          return sortByGroups;\n        },\n        _createDataSourceAdapterCore: function (dataSource, remoteOperations) {\n          var that = this;\n          var dataSourceAdapter = this.callBase(dataSource, remoteOperations);\n          dataSourceAdapter.summaryGetter(function (currentRemoteOperations) {\n            return that._getSummaryOptions(currentRemoteOperations || remoteOperations);\n          });\n          return dataSourceAdapter;\n        },\n        _getSummaryOptions: function (remoteOperations) {\n          var that = this;\n          var groupSummaryItems = that.option(\"summary.groupItems\");\n          var totalSummaryItems = that.option(\"summary.totalItems\");\n          var sortByGroupSummaryInfo = that.option(\"sortByGroupSummaryInfo\");\n\n          var groupAggregates = that._getAggregates(groupSummaryItems, remoteOperations && remoteOperations.grouping && remoteOperations.summary);\n\n          var totalAggregates = that._getAggregates(totalSummaryItems, remoteOperations && remoteOperations.summary);\n\n          if (groupAggregates.length || totalAggregates.length) {\n            return {\n              groupAggregates: groupAggregates,\n              totalAggregates: totalAggregates,\n              sortByGroups: function () {\n                return that._getSummarySortByGroups(sortByGroupSummaryInfo, groupSummaryItems);\n              }\n            };\n          }\n        },\n        publicMethods: function () {\n          var methods = this.callBase();\n          methods.push(\"getTotalSummaryValue\");\n          return methods;\n        },\n        getTotalSummaryValue: function (summaryItemName) {\n          var summaryItemIndex = this._findSummaryItem(this.option(\"summary.totalItems\"), summaryItemName);\n\n          var aggregates = this._dataSource.totalAggregates();\n\n          if (aggregates.length && summaryItemIndex > -1) {\n            return aggregates[summaryItemIndex];\n          }\n        },\n        optionChanged: function (args) {\n          if (\"summary\" === args.name || \"sortByGroupSummaryInfo\" === args.name) {\n            args.name = \"dataSource\";\n          }\n\n          this.callBase(args);\n        },\n        init: function () {\n          this._footerItems = [];\n          this.callBase();\n        },\n        footerItems: function () {\n          return this._footerItems;\n        }\n      },\n      editing: {\n        _refreshSummary: function () {\n          if (recalculateWhileEditing(this) && !this.isSaving()) {\n            this._dataController.refresh({\n              load: true,\n              changesOnly: true\n            });\n          }\n        },\n        _addChange: function (params) {\n          var result = this.callBase.apply(this, arguments);\n\n          if (params.type) {\n            this._refreshSummary();\n          }\n\n          return result;\n        },\n        _removeChange: function () {\n          var result = this.callBase.apply(this, arguments);\n\n          this._refreshSummary();\n\n          return result;\n        },\n        cancelEditData: function () {\n          var result = this.callBase.apply(this, arguments);\n\n          this._refreshSummary();\n\n          return result;\n        }\n      }\n    },\n    views: {\n      rowsView: {\n        _createRow: function (row) {\n          var $row = this.callBase.apply(this, arguments);\n          row && $row.addClass(row.rowType === DATAGRID_GROUP_FOOTER_ROW_TYPE ? DATAGRID_GROUP_FOOTER_CLASS : \"\");\n          return $row;\n        },\n        _renderCells: function ($row, options) {\n          this.callBase.apply(this, arguments);\n\n          if (\"group\" === options.row.rowType && options.row.summaryCells && options.row.summaryCells.length) {\n            this._renderGroupSummaryCells($row, options);\n          }\n        },\n        _hasAlignByColumnSummaryItems: function (columnIndex, options) {\n          return !isDefined(options.columns[columnIndex].groupIndex) && options.row.summaryCells[columnIndex].length;\n        },\n        _getAlignByColumnCellCount: function (groupCellColSpan, options) {\n          var alignByColumnCellCount = 0;\n\n          for (var i = 1; i < groupCellColSpan; i++) {\n            var columnIndex = options.row.summaryCells.length - i;\n            alignByColumnCellCount = this._hasAlignByColumnSummaryItems(columnIndex, options) ? i : alignByColumnCellCount;\n          }\n\n          return alignByColumnCellCount;\n        },\n        _renderGroupSummaryCells: function ($row, options) {\n          var $groupCell = $row.children().last();\n          var groupCellColSpan = Number($groupCell.attr(\"colSpan\")) || 1;\n\n          var alignByColumnCellCount = this._getAlignByColumnCellCount(groupCellColSpan, options);\n\n          this._renderGroupSummaryCellsCore($groupCell, options, groupCellColSpan, alignByColumnCellCount);\n        },\n        _renderGroupSummaryCellsCore: function ($groupCell, options, groupCellColSpan, alignByColumnCellCount) {\n          if (alignByColumnCellCount > 0) {\n            $groupCell.attr(\"colSpan\", groupCellColSpan - alignByColumnCellCount);\n\n            for (var i = 0; i < alignByColumnCellCount; i++) {\n              var columnIndex = options.columns.length - alignByColumnCellCount + i;\n\n              this._renderCell($groupCell.parent(), extend({\n                column: options.columns[columnIndex],\n                columnIndex: this._getSummaryCellIndex(columnIndex, options.columns)\n              }, options));\n            }\n          }\n        },\n        _getSummaryCellIndex: function (columnIndex) {\n          return columnIndex;\n        },\n        _getCellTemplate: function (options) {\n          if (!options.column.command && !isDefined(options.column.groupIndex) && options.summaryItems && options.summaryItems.length) {\n            return renderSummaryCell;\n          } else {\n            return this.callBase(options);\n          }\n        },\n        _getCellOptions: function (options) {\n          var parameters = this.callBase(options);\n\n          if (options.row.summaryCells) {\n            return extend(parameters, getSummaryCellOptions(this, options));\n          } else {\n            return parameters;\n          }\n        }\n      }\n    }\n  }\n});","map":{"version":3,"sources":["/Users/rahulsharma/node_modules/devextreme/esm/ui/data_grid/ui.data_grid.summary.js"],"names":["$","noop","isDefined","isPlainObject","isEmptyObject","isString","isFunction","each","map","extend","compileGetter","errors","gridCore","messageLocalization","dataSourceAdapter","ColumnsView","AggregateCalculator","dataQuery","storeHelper","normalizeSortingInfo","DATAGRID_TOTAL_FOOTER_CLASS","DATAGRID_SUMMARY_ITEM_CLASS","DATAGRID_TEXT_CONTENT_CLASS","DATAGRID_GROUP_FOOTER_CLASS","DATAGRID_GROUP_TEXT_CONTENT_CLASS","DATAGRID_NOWRAP_CLASS","DATAGRID_GROUP_FOOTER_ROW_TYPE","renderSummaryCell","cell","options","$cell","column","summaryItems","$summaryItems","command","i","length","summaryItem","push","css","alignment","addClass","cssClass","toggleClass","rowType","text","getSummaryText","summaryTexts","append","getSummaryCellOptions","that","option","totalItem","row","summaryCells","columnIndex","getGroupAggregates","data","summary","aggregates","recalculateWhileEditing","FooterView","inherit","_getRows","_dataController","footerItems","_getCellOptions","callBase","_renderCellContent","_renderCore","change","needUpdateScrollLeft","columnIndices","element","empty","_updateContent","_renderTable","_updateScrollLeftPosition","$newTable","changeType","$row","getTableElement","find","$newRow","_updateCells","apply","arguments","_rowClick","e","item","rowIndex","executeAction","_columnOptionChanged","optionNames","changeTypes","grouping","width","visibleWidth","_handleDataChanged","repaintChangesOnly","totalColumnIndices","render","getHeight","getElementHeight","isVisible","SummaryDataSourceAdapterExtender","init","_totalAggregates","_summaryGetter","summaryGetter","_summary","totalAggregates","isLastLevelGroupItemsPagingLocal","sortByGroupsInfo","sortByGroups","sortLastLevelGroupItems","items","groups","paths","groupedItems","multiLevelGroup","toArray","result","forEach","path","forEachGroup","groupCount","callback","key","pop","itemsPath","toString","concat","SummaryDataSourceAdapterClientExtender","calculateAggregates","groupLevel","calculator","editingController","getController","insertedData","getInsertedData","applyAddedData","removedData","getRemovedData","applyRemovedData","updatedData","updatedItems","Object","defineProperty","get","set","value","filter","indexOf","groupAggregates","calculate","sortGroupsBySummary","group","sortGroupsBySummaryCore","sorts","query","index","sortBy","selector","desc","thenBy","enumerate","done","sortedItems","slice","_customizeRemoteOperations","remoteOperations","isCustomLoading","storeLoadOptions","isLoadingAll","groupSummary","paging","totalSummary","cachedExtra","cachedData","extra","_handleDataLoadedCore","loadOptions","registerModule","defaultOptions","groupItems","totalItems","calculateCustomSummary","skipEmptyValues","texts","sum","format","sumOtherColumn","min","minOtherColumn","max","maxOtherColumn","avg","avgOtherColumn","count","sortByGroupSummaryInfo","views","footerView","extenders","controllers","_isDataColumn","groupIndex","showWhenGrouped","_isGroupFooterVisible","groupItem","_columnsController","columnOption","showInColumn","showInGroupFooter","_processGroupItems","isGroupFooterVisible","collectContinuationItems","isContinuationOnNextPage","values","_processGroupItem","summaryGroupItems","groupColumnIndex","afterGroupColumnIndex","visibleColumns","visibleIndex","prevColumn","_calculateSummaryCells","alignByColumn","calculateTargetColumnIndex","summaryCellsByColumns","summaryIndex","aggregate","valueFormat","summaryType","getFormatByDataType","dataType","deserializeValue","columnCaption","caption","_getSummaryCells","summaryTotalItems","columnsController","getVisibleColumns","_updateItemsCore","dataSource","_dataSource","_footerItems","oldSummaryCells","summaryCell","JSON","stringify","_prepareUnsavedDataSelector","getUpdatedData","_prepareAggregateSelector","aggregator","Number","_getAggregates","commonSkipEmptyValues","calculateCellValue","bind","dataField","log","component","name","summaryProcess","seed","totalValue","step","finalize","_addSortInfo","groupColumn","sortOrder","_findSummaryItem","summaryItemIndex","_getSummarySortByGroups","groupSummaryItems","groupColumns","getGroupColumns","_createDataSourceAdapterCore","currentRemoteOperations","_getSummaryOptions","totalSummaryItems","publicMethods","methods","getTotalSummaryValue","summaryItemName","optionChanged","args","editing","_refreshSummary","isSaving","refresh","load","changesOnly","_addChange","params","type","_removeChange","cancelEditData","rowsView","_createRow","_renderCells","_renderGroupSummaryCells","_hasAlignByColumnSummaryItems","columns","_getAlignByColumnCellCount","groupCellColSpan","alignByColumnCellCount","$groupCell","children","last","attr","_renderGroupSummaryCellsCore","_renderCell","parent","_getSummaryCellIndex","_getCellTemplate","parameters"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/data_grid/ui.data_grid.summary.js)\r\n * Version: 21.2.3\r\n * Build date: Thu Oct 28 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport {\r\n    noop\r\n} from \"../../core/utils/common\";\r\nimport {\r\n    isDefined,\r\n    isPlainObject,\r\n    isEmptyObject,\r\n    isString,\r\n    isFunction\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    each,\r\n    map\r\n} from \"../../core/utils/iterator\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    compileGetter\r\n} from \"../../core/utils/data\";\r\nimport errors from \"../widget/ui.errors\";\r\nimport gridCore from \"./ui.data_grid.core\";\r\nimport messageLocalization from \"../../localization/message\";\r\nimport dataSourceAdapter from \"./ui.data_grid.data_source_adapter\";\r\nimport {\r\n    ColumnsView\r\n} from \"../grid_core/ui.grid_core.columns_view\";\r\nimport AggregateCalculator from \"./aggregate_calculator\";\r\nimport dataQuery from \"../../data/query\";\r\nimport storeHelper from \"../../data/store_helper\";\r\nimport {\r\n    normalizeSortingInfo\r\n} from \"../../data/utils\";\r\nvar DATAGRID_TOTAL_FOOTER_CLASS = \"dx-datagrid-total-footer\";\r\nvar DATAGRID_SUMMARY_ITEM_CLASS = \"dx-datagrid-summary-item\";\r\nvar DATAGRID_TEXT_CONTENT_CLASS = \"dx-datagrid-text-content\";\r\nvar DATAGRID_GROUP_FOOTER_CLASS = \"dx-datagrid-group-footer\";\r\nvar DATAGRID_GROUP_TEXT_CONTENT_CLASS = \"dx-datagrid-group-text-content\";\r\nvar DATAGRID_NOWRAP_CLASS = \"dx-datagrid-nowrap\";\r\nvar DATAGRID_GROUP_FOOTER_ROW_TYPE = \"groupFooter\";\r\nexport var renderSummaryCell = function(cell, options) {\r\n    var $cell = $(cell);\r\n    var column = options.column;\r\n    var summaryItems = options.summaryItems;\r\n    var $summaryItems = [];\r\n    if (!column.command && summaryItems) {\r\n        for (var i = 0; i < summaryItems.length; i++) {\r\n            var summaryItem = summaryItems[i];\r\n            $summaryItems.push($(\"<div>\").css(\"textAlign\", summaryItem.alignment || column.alignment).addClass(DATAGRID_SUMMARY_ITEM_CLASS).addClass(DATAGRID_TEXT_CONTENT_CLASS).addClass(summaryItem.cssClass).toggleClass(DATAGRID_GROUP_TEXT_CONTENT_CLASS, \"group\" === options.rowType).text(gridCore.getSummaryText(summaryItem, options.summaryTexts)))\r\n        }\r\n        $cell.append($summaryItems)\r\n    }\r\n};\r\nvar getSummaryCellOptions = function(that, options) {\r\n    var summaryTexts = that.option(\"summary.texts\") || {};\r\n    return {\r\n        totalItem: options.row,\r\n        summaryItems: options.row.summaryCells[options.columnIndex],\r\n        summaryTexts: summaryTexts\r\n    }\r\n};\r\nvar getGroupAggregates = function(data) {\r\n    return data.summary || data.aggregates || []\r\n};\r\nvar recalculateWhileEditing = function(that) {\r\n    return that.option(\"summary.recalculateWhileEditing\")\r\n};\r\nexport var FooterView = ColumnsView.inherit({\r\n    _getRows: function() {\r\n        return this._dataController.footerItems()\r\n    },\r\n    _getCellOptions: function(options) {\r\n        return extend(this.callBase(options), getSummaryCellOptions(this, options))\r\n    },\r\n    _renderCellContent: function($cell, options) {\r\n        renderSummaryCell($cell, options);\r\n        this.callBase($cell, options)\r\n    },\r\n    _renderCore: function(change) {\r\n        var needUpdateScrollLeft = false;\r\n        var totalItem = this._dataController.footerItems()[0];\r\n        if (!change || !change.columnIndices) {\r\n            this.element().empty().addClass(DATAGRID_TOTAL_FOOTER_CLASS).toggleClass(DATAGRID_NOWRAP_CLASS, !this.option(\"wordWrapEnabled\"));\r\n            needUpdateScrollLeft = true\r\n        }\r\n        if (totalItem && totalItem.summaryCells && totalItem.summaryCells.length) {\r\n            this._updateContent(this._renderTable({\r\n                change: change\r\n            }), change);\r\n            needUpdateScrollLeft && this._updateScrollLeftPosition()\r\n        }\r\n    },\r\n    _updateContent: function($newTable, change) {\r\n        if (change && \"update\" === change.changeType && change.columnIndices) {\r\n            var $row = this.getTableElement().find(\".dx-row\");\r\n            var $newRow = $newTable.find(\".dx-row\");\r\n            this._updateCells($row, $newRow, change.columnIndices[0])\r\n        } else {\r\n            return this.callBase.apply(this, arguments)\r\n        }\r\n    },\r\n    _rowClick: function(e) {\r\n        var item = this._dataController.footerItems()[e.rowIndex] || {};\r\n        this.executeAction(\"onRowClick\", extend({}, e, item))\r\n    },\r\n    _columnOptionChanged: function(e) {\r\n        var optionNames = e.optionNames;\r\n        if (e.changeTypes.grouping) {\r\n            return\r\n        }\r\n        if (optionNames.width || optionNames.visibleWidth) {\r\n            this.callBase(e)\r\n        }\r\n    },\r\n    _handleDataChanged: function(e) {\r\n        var changeType = e.changeType;\r\n        if (\"update\" === e.changeType && e.repaintChangesOnly) {\r\n            if (!e.totalColumnIndices) {\r\n                this.render()\r\n            } else if (e.totalColumnIndices.length) {\r\n                this.render(null, {\r\n                    changeType: \"update\",\r\n                    columnIndices: [e.totalColumnIndices]\r\n                })\r\n            }\r\n        } else if (\"refresh\" === changeType || \"append\" === changeType || \"prepend\" === changeType) {\r\n            this.render()\r\n        }\r\n    },\r\n    getHeight: function() {\r\n        return this.getElementHeight()\r\n    },\r\n    isVisible: function() {\r\n        return !!this._dataController.footerItems().length\r\n    }\r\n});\r\nvar SummaryDataSourceAdapterExtender = {\r\n    init: function() {\r\n        this.callBase.apply(this, arguments);\r\n        this._totalAggregates = [];\r\n        this._summaryGetter = noop\r\n    },\r\n    summaryGetter: function(_summaryGetter) {\r\n        if (!arguments.length) {\r\n            return this._summaryGetter\r\n        }\r\n        if (isFunction(_summaryGetter)) {\r\n            this._summaryGetter = _summaryGetter\r\n        }\r\n    },\r\n    summary: function(_summary) {\r\n        if (!arguments.length) {\r\n            return this._summaryGetter()\r\n        }\r\n        this._summaryGetter = function() {\r\n            return _summary\r\n        }\r\n    },\r\n    totalAggregates: function() {\r\n        return this._totalAggregates\r\n    },\r\n    isLastLevelGroupItemsPagingLocal: function() {\r\n        var summary = this.summary();\r\n        var sortByGroupsInfo = summary && summary.sortByGroups();\r\n        return sortByGroupsInfo && sortByGroupsInfo.length\r\n    },\r\n    sortLastLevelGroupItems: function(items, groups, paths) {\r\n        var groupedItems = storeHelper.multiLevelGroup(dataQuery(items), groups).toArray();\r\n        var result = [];\r\n        paths.forEach((function(path) {\r\n            ! function forEachGroup(groups, groupCount, callback, path) {\r\n                path = path || [];\r\n                for (var i = 0; i < groups.length; i++) {\r\n                    path.push(groups[i].key);\r\n                    if (1 === groupCount) {\r\n                        callback(path, groups[i].items)\r\n                    } else {\r\n                        forEachGroup(groups[i].items, groupCount - 1, callback, path)\r\n                    }\r\n                    path.pop()\r\n                }\r\n            }(groupedItems, groups.length, (function(itemsPath, items) {\r\n                if (path.toString() === itemsPath.toString()) {\r\n                    result = result.concat(items)\r\n                }\r\n            }))\r\n        }));\r\n        return result\r\n    }\r\n};\r\nvar SummaryDataSourceAdapterClientExtender = function() {\r\n    var calculateAggregates = function(that, summary, data, groupLevel) {\r\n        var calculator;\r\n        if (recalculateWhileEditing(that)) {\r\n            var editingController = that.getController(\"editing\");\r\n            if (editingController) {\r\n                var insertedData = editingController.getInsertedData();\r\n                if (insertedData.length) {\r\n                    data = function applyAddedData(data, insertedData, groupLevel) {\r\n                        if (groupLevel) {\r\n                            return applyAddedData(data, insertedData.map(item => ({\r\n                                items: [item]\r\n                            }), groupLevel - 1))\r\n                        }\r\n                        return data.concat(insertedData)\r\n                    }(data, insertedData, groupLevel)\r\n                }\r\n                var removedData = editingController.getRemovedData();\r\n                if (removedData.length) {\r\n                    data = function applyRemovedData(data, removedData, groupLevel) {\r\n                        if (groupLevel) {\r\n                            return data.map(data => {\r\n                                var updatedData = {};\r\n                                var updatedItems = applyRemovedData(data.items || [], removedData, groupLevel - 1);\r\n                                Object.defineProperty(updatedData, \"aggregates\", {\r\n                                    get: () => data.aggregates,\r\n                                    set: value => {\r\n                                        data.aggregates = value\r\n                                    }\r\n                                });\r\n                                return extend(updatedData, data, {\r\n                                    items: updatedItems\r\n                                })\r\n                            })\r\n                        }\r\n                        return data.filter(data => removedData.indexOf(data) < 0)\r\n                    }(data, removedData, groupLevel)\r\n                }\r\n            }\r\n        }\r\n        if (summary) {\r\n            calculator = new AggregateCalculator({\r\n                totalAggregates: summary.totalAggregates,\r\n                groupAggregates: summary.groupAggregates,\r\n                data: data,\r\n                groupLevel: groupLevel\r\n            });\r\n            calculator.calculate()\r\n        }\r\n        return calculator ? calculator.totalAggregates() : []\r\n    };\r\n    var sortGroupsBySummary = function(data, group, summary) {\r\n        var sortByGroups = summary && summary.sortByGroups && summary.sortByGroups();\r\n        if (sortByGroups && sortByGroups.length) {\r\n            return function sortGroupsBySummaryCore(items, groups, sortByGroups) {\r\n                if (!items || !groups.length) {\r\n                    return items\r\n                }\r\n                var group = groups[0];\r\n                var sorts = sortByGroups[0];\r\n                var query;\r\n                if (group && sorts && sorts.length) {\r\n                    query = dataQuery(items);\r\n                    each(sorts, (function(index) {\r\n                        if (0 === index) {\r\n                            query = query.sortBy(this.selector, this.desc)\r\n                        } else {\r\n                            query = query.thenBy(this.selector, this.desc)\r\n                        }\r\n                    }));\r\n                    query.enumerate().done((function(sortedItems) {\r\n                        items = sortedItems\r\n                    }))\r\n                }\r\n                groups = groups.slice(1);\r\n                sortByGroups = sortByGroups.slice(1);\r\n                if (groups.length && sortByGroups.length) {\r\n                    each(items, (function() {\r\n                        this.items = sortGroupsBySummaryCore(this.items, groups, sortByGroups)\r\n                    }))\r\n                }\r\n                return items\r\n            }(data, group, sortByGroups)\r\n        }\r\n        return data\r\n    };\r\n    return {\r\n        _customizeRemoteOperations: function(options) {\r\n            var summary = this.summary();\r\n            if (summary) {\r\n                if (options.remoteOperations.summary) {\r\n                    if (!options.isCustomLoading || options.storeLoadOptions.isLoadingAll) {\r\n                        if (options.storeLoadOptions.group) {\r\n                            if (options.remoteOperations.grouping) {\r\n                                options.storeLoadOptions.groupSummary = summary.groupAggregates\r\n                            } else if (summary.groupAggregates.length) {\r\n                                options.remoteOperations.paging = false\r\n                            }\r\n                        }\r\n                        options.storeLoadOptions.totalSummary = summary.totalAggregates\r\n                    }\r\n                } else if (summary.totalAggregates.length || summary.groupAggregates.length && options.storeLoadOptions.group) {\r\n                    options.remoteOperations.paging = false\r\n                }\r\n            }\r\n            this.callBase.apply(this, arguments);\r\n            var cachedExtra = options.cachedData.extra;\r\n            if (cachedExtra && cachedExtra.summary && !options.isCustomLoading) {\r\n                options.storeLoadOptions.totalSummary = void 0\r\n            }\r\n        },\r\n        _handleDataLoadedCore: function(options) {\r\n            var groups = normalizeSortingInfo(options.storeLoadOptions.group || options.loadOptions.group || []);\r\n            var remoteOperations = options.remoteOperations || {};\r\n            var summary = this.summaryGetter()(remoteOperations);\r\n            var totalAggregates;\r\n            if (!options.isCustomLoading || options.storeLoadOptions.isLoadingAll) {\r\n                if (remoteOperations.summary) {\r\n                    if (!remoteOperations.paging && groups.length && summary) {\r\n                        if (!remoteOperations.grouping) {\r\n                            calculateAggregates(this, {\r\n                                groupAggregates: summary.groupAggregates\r\n                            }, options.data, groups.length)\r\n                        }\r\n                        options.data = sortGroupsBySummary(options.data, groups, summary)\r\n                    }\r\n                } else if (!remoteOperations.paging) {\r\n                    totalAggregates = calculateAggregates(this, summary, options.data, groups.length);\r\n                    options.data = sortGroupsBySummary(options.data, groups, summary);\r\n                    options.extra = isPlainObject(options.extra) ? options.extra : {};\r\n                    options.extra.summary = totalAggregates\r\n                }\r\n            }\r\n            if (!options.isCustomLoading) {\r\n                this._totalAggregates = options.extra && options.extra.summary || this._totalAggregates\r\n            }\r\n            this.callBase(options)\r\n        }\r\n    }\r\n}();\r\ndataSourceAdapter.extend(SummaryDataSourceAdapterExtender);\r\ndataSourceAdapter.extend(SummaryDataSourceAdapterClientExtender);\r\ngridCore.registerModule(\"summary\", {\r\n    defaultOptions: function() {\r\n        return {\r\n            summary: {\r\n                groupItems: void 0,\r\n                totalItems: void 0,\r\n                calculateCustomSummary: void 0,\r\n                skipEmptyValues: true,\r\n                recalculateWhileEditing: false,\r\n                texts: {\r\n                    sum: messageLocalization.format(\"dxDataGrid-summarySum\"),\r\n                    sumOtherColumn: messageLocalization.format(\"dxDataGrid-summarySumOtherColumn\"),\r\n                    min: messageLocalization.format(\"dxDataGrid-summaryMin\"),\r\n                    minOtherColumn: messageLocalization.format(\"dxDataGrid-summaryMinOtherColumn\"),\r\n                    max: messageLocalization.format(\"dxDataGrid-summaryMax\"),\r\n                    maxOtherColumn: messageLocalization.format(\"dxDataGrid-summaryMaxOtherColumn\"),\r\n                    avg: messageLocalization.format(\"dxDataGrid-summaryAvg\"),\r\n                    avgOtherColumn: messageLocalization.format(\"dxDataGrid-summaryAvgOtherColumn\"),\r\n                    count: messageLocalization.format(\"dxDataGrid-summaryCount\")\r\n                }\r\n            },\r\n            sortByGroupSummaryInfo: void 0\r\n        }\r\n    },\r\n    views: {\r\n        footerView: FooterView\r\n    },\r\n    extenders: {\r\n        controllers: {\r\n            data: {\r\n                _isDataColumn: function(column) {\r\n                    return column && (!isDefined(column.groupIndex) || column.showWhenGrouped)\r\n                },\r\n                _isGroupFooterVisible: function() {\r\n                    var groupItems = this.option(\"summary.groupItems\") || [];\r\n                    for (var i = 0; i < groupItems.length; i++) {\r\n                        var groupItem = groupItems[i];\r\n                        var column = this._columnsController.columnOption(groupItem.showInColumn || groupItem.column);\r\n                        if (groupItem.showInGroupFooter && this._isDataColumn(column)) {\r\n                            return true\r\n                        }\r\n                    }\r\n                    return false\r\n                },\r\n                _processGroupItems: function(items, groupCount, options) {\r\n                    var data = options && options.data;\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    if (options) {\r\n                        if (void 0 === options.isGroupFooterVisible) {\r\n                            options.isGroupFooterVisible = this._isGroupFooterVisible()\r\n                        }\r\n                        if (data && data.items && options.isGroupFooterVisible && (options.collectContinuationItems || !data.isContinuationOnNextPage)) {\r\n                            result.push({\r\n                                rowType: DATAGRID_GROUP_FOOTER_ROW_TYPE,\r\n                                key: options.path.slice(),\r\n                                data: data,\r\n                                groupIndex: options.path.length - 1,\r\n                                values: []\r\n                            })\r\n                        }\r\n                    }\r\n                    return result\r\n                },\r\n                _processGroupItem: function(groupItem, options) {\r\n                    var that = this;\r\n                    if (!options.summaryGroupItems) {\r\n                        options.summaryGroupItems = that.option(\"summary.groupItems\") || []\r\n                    }\r\n                    if (\"group\" === groupItem.rowType) {\r\n                        var groupColumnIndex = -1;\r\n                        var afterGroupColumnIndex = -1;\r\n                        each(options.visibleColumns, (function(visibleIndex) {\r\n                            var prevColumn = options.visibleColumns[visibleIndex - 1];\r\n                            if (groupItem.groupIndex === this.groupIndex) {\r\n                                groupColumnIndex = this.index\r\n                            }\r\n                            if (visibleIndex > 0 && \"expand\" === prevColumn.command && \"expand\" !== this.command) {\r\n                                afterGroupColumnIndex = this.index\r\n                            }\r\n                        }));\r\n                        groupItem.summaryCells = this._calculateSummaryCells(options.summaryGroupItems, getGroupAggregates(groupItem.data), options.visibleColumns, (function(summaryItem, column) {\r\n                            if (summaryItem.showInGroupFooter) {\r\n                                return -1\r\n                            }\r\n                            if (summaryItem.alignByColumn && column && !isDefined(column.groupIndex) && column.index !== afterGroupColumnIndex) {\r\n                                return column.index\r\n                            } else {\r\n                                return groupColumnIndex\r\n                            }\r\n                        }))\r\n                    }\r\n                    if (groupItem.rowType === DATAGRID_GROUP_FOOTER_ROW_TYPE) {\r\n                        groupItem.summaryCells = this._calculateSummaryCells(options.summaryGroupItems, getGroupAggregates(groupItem.data), options.visibleColumns, (function(summaryItem, column) {\r\n                            return summaryItem.showInGroupFooter && that._isDataColumn(column) ? column.index : -1\r\n                        }))\r\n                    }\r\n                    return groupItem\r\n                },\r\n                _calculateSummaryCells: function(summaryItems, aggregates, visibleColumns, calculateTargetColumnIndex) {\r\n                    var that = this;\r\n                    var summaryCells = [];\r\n                    var summaryCellsByColumns = {};\r\n                    each(summaryItems, (function(summaryIndex, summaryItem) {\r\n                        var column = that._columnsController.columnOption(summaryItem.column);\r\n                        var showInColumn = summaryItem.showInColumn && that._columnsController.columnOption(summaryItem.showInColumn) || column;\r\n                        var columnIndex = calculateTargetColumnIndex(summaryItem, showInColumn);\r\n                        if (columnIndex >= 0) {\r\n                            if (!summaryCellsByColumns[columnIndex]) {\r\n                                summaryCellsByColumns[columnIndex] = []\r\n                            }\r\n                            var aggregate = aggregates[summaryIndex];\r\n                            if (aggregate === aggregate) {\r\n                                var valueFormat;\r\n                                if (isDefined(summaryItem.valueFormat)) {\r\n                                    valueFormat = summaryItem.valueFormat\r\n                                } else if (\"count\" !== summaryItem.summaryType) {\r\n                                    valueFormat = gridCore.getFormatByDataType(column && column.dataType)\r\n                                }\r\n                                summaryCellsByColumns[columnIndex].push(extend({}, summaryItem, {\r\n                                    value: isString(aggregate) && column && column.deserializeValue ? column.deserializeValue(aggregate) : aggregate,\r\n                                    valueFormat: valueFormat,\r\n                                    columnCaption: column && column.index !== columnIndex ? column.caption : void 0\r\n                                }))\r\n                            }\r\n                        }\r\n                    }));\r\n                    if (!isEmptyObject(summaryCellsByColumns)) {\r\n                        each(visibleColumns, (function() {\r\n                            summaryCells.push(summaryCellsByColumns[this.index] || [])\r\n                        }))\r\n                    }\r\n                    return summaryCells\r\n                },\r\n                _getSummaryCells: function(summaryTotalItems, totalAggregates) {\r\n                    var that = this;\r\n                    var columnsController = that._columnsController;\r\n                    return that._calculateSummaryCells(summaryTotalItems, totalAggregates, columnsController.getVisibleColumns(), (function(summaryItem, column) {\r\n                        return that._isDataColumn(column) ? column.index : -1\r\n                    }))\r\n                },\r\n                _updateItemsCore: function(change) {\r\n                    var summaryCells;\r\n                    var dataSource = this._dataSource;\r\n                    var footerItems = this._footerItems;\r\n                    var oldSummaryCells = footerItems && footerItems[0] && footerItems[0].summaryCells;\r\n                    var summaryTotalItems = this.option(\"summary.totalItems\");\r\n                    this._footerItems = [];\r\n                    if (dataSource && summaryTotalItems && summaryTotalItems.length) {\r\n                        var totalAggregates = dataSource.totalAggregates();\r\n                        summaryCells = this._getSummaryCells(summaryTotalItems, totalAggregates);\r\n                        if (change && change.repaintChangesOnly && oldSummaryCells) {\r\n                            change.totalColumnIndices = summaryCells.map((function(summaryCell, index) {\r\n                                if (JSON.stringify(summaryCell) !== JSON.stringify(oldSummaryCells[index])) {\r\n                                    return index\r\n                                }\r\n                                return -1\r\n                            })).filter(index => index >= 0)\r\n                        }\r\n                        if (summaryCells.length) {\r\n                            this._footerItems.push({\r\n                                rowType: \"totalFooter\",\r\n                                summaryCells: summaryCells\r\n                            })\r\n                        }\r\n                    }\r\n                    this.callBase(change)\r\n                },\r\n                _prepareUnsavedDataSelector: function(selector) {\r\n                    if (recalculateWhileEditing(this)) {\r\n                        var editingController = this.getController(\"editing\");\r\n                        if (editingController) {\r\n                            return function(data) {\r\n                                data = editingController.getUpdatedData(data);\r\n                                return selector(data)\r\n                            }\r\n                        }\r\n                    }\r\n                    return selector\r\n                },\r\n                _prepareAggregateSelector: function(selector, aggregator) {\r\n                    selector = this._prepareUnsavedDataSelector(selector);\r\n                    if (\"avg\" === aggregator || \"sum\" === aggregator) {\r\n                        return function(data) {\r\n                            var value = selector(data);\r\n                            return isDefined(value) ? Number(value) : value\r\n                        }\r\n                    }\r\n                    return selector\r\n                },\r\n                _getAggregates: function(summaryItems, remoteOperations) {\r\n                    var that = this;\r\n                    var columnsController = that.getController(\"columns\");\r\n                    var calculateCustomSummary = that.option(\"summary.calculateCustomSummary\");\r\n                    var commonSkipEmptyValues = that.option(\"summary.skipEmptyValues\");\r\n                    return map(summaryItems || [], (function(summaryItem) {\r\n                        var column = columnsController.columnOption(summaryItem.column);\r\n                        var calculateCellValue = column && column.calculateCellValue ? column.calculateCellValue.bind(column) : compileGetter(column ? column.dataField : summaryItem.column);\r\n                        var aggregator = summaryItem.summaryType || \"count\";\r\n                        var selector = summaryItem.column;\r\n                        var skipEmptyValues = isDefined(summaryItem.skipEmptyValues) ? summaryItem.skipEmptyValues : commonSkipEmptyValues;\r\n                        if (remoteOperations) {\r\n                            return {\r\n                                selector: summaryItem.column,\r\n                                summaryType: aggregator\r\n                            }\r\n                        } else {\r\n                            selector = that._prepareAggregateSelector(calculateCellValue, aggregator);\r\n                            if (\"custom\" === aggregator) {\r\n                                if (!calculateCustomSummary) {\r\n                                    errors.log(\"E1026\");\r\n                                    calculateCustomSummary = function() {}\r\n                                }\r\n                                var options = {\r\n                                    component: that.component,\r\n                                    name: summaryItem.name\r\n                                };\r\n                                calculateCustomSummary(options);\r\n                                options.summaryProcess = \"calculate\";\r\n                                aggregator = {\r\n                                    seed: function(groupIndex) {\r\n                                        options.summaryProcess = \"start\";\r\n                                        options.totalValue = void 0;\r\n                                        options.groupIndex = groupIndex;\r\n                                        delete options.value;\r\n                                        calculateCustomSummary(options);\r\n                                        return options.totalValue\r\n                                    },\r\n                                    step: function(totalValue, value) {\r\n                                        options.summaryProcess = \"calculate\";\r\n                                        options.totalValue = totalValue;\r\n                                        options.value = value;\r\n                                        calculateCustomSummary(options);\r\n                                        return options.totalValue\r\n                                    },\r\n                                    finalize: function(totalValue) {\r\n                                        options.summaryProcess = \"finalize\";\r\n                                        options.totalValue = totalValue;\r\n                                        delete options.value;\r\n                                        calculateCustomSummary(options);\r\n                                        return options.totalValue\r\n                                    }\r\n                                }\r\n                            }\r\n                            return {\r\n                                selector: selector,\r\n                                aggregator: aggregator,\r\n                                skipEmptyValues: skipEmptyValues\r\n                            }\r\n                        }\r\n                    }))\r\n                },\r\n                _addSortInfo: function(sortByGroups, groupColumn, selector, sortOrder) {\r\n                    if (groupColumn) {\r\n                        var groupIndex = groupColumn.groupIndex;\r\n                        sortOrder = sortOrder || groupColumn.sortOrder;\r\n                        if (isDefined(groupIndex)) {\r\n                            sortByGroups[groupIndex] = sortByGroups[groupIndex] || [];\r\n                            sortByGroups[groupIndex].push({\r\n                                selector: selector,\r\n                                desc: \"desc\" === sortOrder\r\n                            })\r\n                        }\r\n                    }\r\n                },\r\n                _findSummaryItem: function(summaryItems, name) {\r\n                    var summaryItemIndex = -1;\r\n                    if (isDefined(name)) {\r\n                        each(summaryItems || [], (function(index) {\r\n                            if (this.name === name || index === name || this.summaryType === name || this.column === name || (summaryItem = this, summaryType = summaryItem.summaryType, column = summaryItem.column, summaryType && column && summaryType + \"_\" + column) === name) {\r\n                                summaryItemIndex = index;\r\n                                return false\r\n                            }\r\n                            var summaryItem, summaryType, column\r\n                        }))\r\n                    }\r\n                    return summaryItemIndex\r\n                },\r\n                _getSummarySortByGroups: function(sortByGroupSummaryInfo, groupSummaryItems) {\r\n                    var that = this;\r\n                    var columnsController = that._columnsController;\r\n                    var groupColumns = columnsController.getGroupColumns();\r\n                    var sortByGroups = [];\r\n                    if (!groupSummaryItems || !groupSummaryItems.length) {\r\n                        return\r\n                    }\r\n                    each(sortByGroupSummaryInfo || [], (function() {\r\n                        var sortOrder = this.sortOrder;\r\n                        var groupColumn = this.groupColumn;\r\n                        var summaryItemIndex = that._findSummaryItem(groupSummaryItems, this.summaryItem);\r\n                        if (summaryItemIndex < 0) {\r\n                            return\r\n                        }\r\n                        var selector = function(data) {\r\n                            return getGroupAggregates(data)[summaryItemIndex]\r\n                        };\r\n                        if (isDefined(groupColumn)) {\r\n                            groupColumn = columnsController.columnOption(groupColumn);\r\n                            that._addSortInfo(sortByGroups, groupColumn, selector, sortOrder)\r\n                        } else {\r\n                            each(groupColumns, (function(groupIndex, groupColumn) {\r\n                                that._addSortInfo(sortByGroups, groupColumn, selector, sortOrder)\r\n                            }))\r\n                        }\r\n                    }));\r\n                    return sortByGroups\r\n                },\r\n                _createDataSourceAdapterCore: function(dataSource, remoteOperations) {\r\n                    var that = this;\r\n                    var dataSourceAdapter = this.callBase(dataSource, remoteOperations);\r\n                    dataSourceAdapter.summaryGetter((function(currentRemoteOperations) {\r\n                        return that._getSummaryOptions(currentRemoteOperations || remoteOperations)\r\n                    }));\r\n                    return dataSourceAdapter\r\n                },\r\n                _getSummaryOptions: function(remoteOperations) {\r\n                    var that = this;\r\n                    var groupSummaryItems = that.option(\"summary.groupItems\");\r\n                    var totalSummaryItems = that.option(\"summary.totalItems\");\r\n                    var sortByGroupSummaryInfo = that.option(\"sortByGroupSummaryInfo\");\r\n                    var groupAggregates = that._getAggregates(groupSummaryItems, remoteOperations && remoteOperations.grouping && remoteOperations.summary);\r\n                    var totalAggregates = that._getAggregates(totalSummaryItems, remoteOperations && remoteOperations.summary);\r\n                    if (groupAggregates.length || totalAggregates.length) {\r\n                        return {\r\n                            groupAggregates: groupAggregates,\r\n                            totalAggregates: totalAggregates,\r\n                            sortByGroups: function() {\r\n                                return that._getSummarySortByGroups(sortByGroupSummaryInfo, groupSummaryItems)\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                publicMethods: function() {\r\n                    var methods = this.callBase();\r\n                    methods.push(\"getTotalSummaryValue\");\r\n                    return methods\r\n                },\r\n                getTotalSummaryValue: function(summaryItemName) {\r\n                    var summaryItemIndex = this._findSummaryItem(this.option(\"summary.totalItems\"), summaryItemName);\r\n                    var aggregates = this._dataSource.totalAggregates();\r\n                    if (aggregates.length && summaryItemIndex > -1) {\r\n                        return aggregates[summaryItemIndex]\r\n                    }\r\n                },\r\n                optionChanged: function(args) {\r\n                    if (\"summary\" === args.name || \"sortByGroupSummaryInfo\" === args.name) {\r\n                        args.name = \"dataSource\"\r\n                    }\r\n                    this.callBase(args)\r\n                },\r\n                init: function() {\r\n                    this._footerItems = [];\r\n                    this.callBase()\r\n                },\r\n                footerItems: function() {\r\n                    return this._footerItems\r\n                }\r\n            },\r\n            editing: {\r\n                _refreshSummary: function() {\r\n                    if (recalculateWhileEditing(this) && !this.isSaving()) {\r\n                        this._dataController.refresh({\r\n                            load: true,\r\n                            changesOnly: true\r\n                        })\r\n                    }\r\n                },\r\n                _addChange: function(params) {\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    if (params.type) {\r\n                        this._refreshSummary()\r\n                    }\r\n                    return result\r\n                },\r\n                _removeChange: function() {\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    this._refreshSummary();\r\n                    return result\r\n                },\r\n                cancelEditData: function() {\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    this._refreshSummary();\r\n                    return result\r\n                }\r\n            }\r\n        },\r\n        views: {\r\n            rowsView: {\r\n                _createRow: function(row) {\r\n                    var $row = this.callBase.apply(this, arguments);\r\n                    row && $row.addClass(row.rowType === DATAGRID_GROUP_FOOTER_ROW_TYPE ? DATAGRID_GROUP_FOOTER_CLASS : \"\");\r\n                    return $row\r\n                },\r\n                _renderCells: function($row, options) {\r\n                    this.callBase.apply(this, arguments);\r\n                    if (\"group\" === options.row.rowType && options.row.summaryCells && options.row.summaryCells.length) {\r\n                        this._renderGroupSummaryCells($row, options)\r\n                    }\r\n                },\r\n                _hasAlignByColumnSummaryItems: function(columnIndex, options) {\r\n                    return !isDefined(options.columns[columnIndex].groupIndex) && options.row.summaryCells[columnIndex].length\r\n                },\r\n                _getAlignByColumnCellCount: function(groupCellColSpan, options) {\r\n                    var alignByColumnCellCount = 0;\r\n                    for (var i = 1; i < groupCellColSpan; i++) {\r\n                        var columnIndex = options.row.summaryCells.length - i;\r\n                        alignByColumnCellCount = this._hasAlignByColumnSummaryItems(columnIndex, options) ? i : alignByColumnCellCount\r\n                    }\r\n                    return alignByColumnCellCount\r\n                },\r\n                _renderGroupSummaryCells: function($row, options) {\r\n                    var $groupCell = $row.children().last();\r\n                    var groupCellColSpan = Number($groupCell.attr(\"colSpan\")) || 1;\r\n                    var alignByColumnCellCount = this._getAlignByColumnCellCount(groupCellColSpan, options);\r\n                    this._renderGroupSummaryCellsCore($groupCell, options, groupCellColSpan, alignByColumnCellCount)\r\n                },\r\n                _renderGroupSummaryCellsCore: function($groupCell, options, groupCellColSpan, alignByColumnCellCount) {\r\n                    if (alignByColumnCellCount > 0) {\r\n                        $groupCell.attr(\"colSpan\", groupCellColSpan - alignByColumnCellCount);\r\n                        for (var i = 0; i < alignByColumnCellCount; i++) {\r\n                            var columnIndex = options.columns.length - alignByColumnCellCount + i;\r\n                            this._renderCell($groupCell.parent(), extend({\r\n                                column: options.columns[columnIndex],\r\n                                columnIndex: this._getSummaryCellIndex(columnIndex, options.columns)\r\n                            }, options))\r\n                        }\r\n                    }\r\n                },\r\n                _getSummaryCellIndex: function(columnIndex) {\r\n                    return columnIndex\r\n                },\r\n                _getCellTemplate: function(options) {\r\n                    if (!options.column.command && !isDefined(options.column.groupIndex) && options.summaryItems && options.summaryItems.length) {\r\n                        return renderSummaryCell\r\n                    } else {\r\n                        return this.callBase(options)\r\n                    }\r\n                },\r\n                _getCellOptions: function(options) {\r\n                    var parameters = this.callBase(options);\r\n                    if (options.row.summaryCells) {\r\n                        return extend(parameters, getSummaryCellOptions(this, options))\r\n                    } else {\r\n                        return parameters\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}