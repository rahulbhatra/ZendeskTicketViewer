{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/filter_builder/filter_builder.js)\r\n * Version: 21.2.3\r\n * Build date: Thu Oct 28 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport domAdapter from \"../../core/dom_adapter\";\nimport Class from \"../../core/class\";\nimport eventsEngine from \"../../events/core/events_engine\";\nimport Widget from \"../widget/ui.widget\";\nimport registerComponent from \"../../core/component_registrator\";\nimport { extend } from \"../../core/utils/extend\";\nimport messageLocalization from \"../../localization/message\";\nimport { when } from \"../../core/utils/deferred\";\nimport { isDefined } from \"../../core/utils/type\";\nimport TreeView from \"../tree_view\";\nimport Popup from \"../popup\";\nimport { getElementMaxHeightByWindow } from \"../overlay/utils\";\nimport EditorFactoryMixin from \"../shared/ui.editor_factory_mixin\";\nimport { normalizeKeyName } from \"../../events/utils/index\";\nimport { renderValueText, getFilterExpression as _getFilterExpression, getNormalizedFilter, getNormalizedFields, getMergedOperations, convertToInnerStructure, getGroupCriteria, isGroup, isCondition, removeItem, createEmptyGroup, addItem, createCondition, getGroupMenuItem, setGroupValue, getCustomOperation, getAvailableOperations, getOperationFromAvailable, getOperationValue, updateConditionByOperation, getItems, getField, getCaptionWithParents, getDefaultOperation, getGroupValue, getCurrentLookupValueText, getCurrentValueText } from \"./utils\";\nvar FILTER_BUILDER_CLASS = \"dx-filterbuilder\";\nvar FILTER_BUILDER_GROUP_CLASS = FILTER_BUILDER_CLASS + \"-group\";\nvar FILTER_BUILDER_GROUP_ITEM_CLASS = FILTER_BUILDER_GROUP_CLASS + \"-item\";\nvar FILTER_BUILDER_GROUP_CONTENT_CLASS = FILTER_BUILDER_GROUP_CLASS + \"-content\";\nvar FILTER_BUILDER_GROUP_OPERATIONS_CLASS = FILTER_BUILDER_GROUP_CLASS + \"-operations\";\nvar FILTER_BUILDER_GROUP_OPERATION_CLASS = FILTER_BUILDER_GROUP_CLASS + \"-operation\";\nvar FILTER_BUILDER_ACTION_CLASS = FILTER_BUILDER_CLASS + \"-action\";\nvar FILTER_BUILDER_IMAGE_CLASS = FILTER_BUILDER_ACTION_CLASS + \"-icon\";\nvar FILTER_BUILDER_IMAGE_ADD_CLASS = \"dx-icon-plus\";\nvar FILTER_BUILDER_IMAGE_REMOVE_CLASS = \"dx-icon-remove\";\nvar FILTER_BUILDER_ITEM_TEXT_CLASS = FILTER_BUILDER_CLASS + \"-text\";\nvar FILTER_BUILDER_ITEM_FIELD_CLASS = FILTER_BUILDER_CLASS + \"-item-field\";\nvar FILTER_BUILDER_ITEM_OPERATION_CLASS = FILTER_BUILDER_CLASS + \"-item-operation\";\nvar FILTER_BUILDER_ITEM_VALUE_CLASS = FILTER_BUILDER_CLASS + \"-item-value\";\nvar FILTER_BUILDER_ITEM_VALUE_TEXT_CLASS = FILTER_BUILDER_CLASS + \"-item-value-text\";\nvar FILTER_BUILDER_OVERLAY_CLASS = FILTER_BUILDER_CLASS + \"-overlay\";\nvar FILTER_BUILDER_FILTER_OPERATIONS_CLASS = FILTER_BUILDER_CLASS + \"-operations\";\nvar FILTER_BUILDER_FIELDS_CLASS = FILTER_BUILDER_CLASS + \"-fields\";\nvar FILTER_BUILDER_ADD_CONDITION_CLASS = FILTER_BUILDER_CLASS + \"-add-condition\";\nvar ACTIVE_CLASS = \"dx-state-active\";\nvar FILTER_BUILDER_MENU_CUSTOM_OPERATION_CLASS = FILTER_BUILDER_CLASS + \"-menu-custom-operation\";\nvar SOURCE = \"filterBuilder\";\nvar DISABLED_STATE_CLASS = \"dx-state-disabled\";\nvar TAB_KEY = \"tab\";\nvar ENTER_KEY = \"enter\";\nvar ESCAPE_KEY = \"escape\";\nvar ACTIONS = [{\n  name: \"onEditorPreparing\",\n  config: {\n    excludeValidators: [\"disabled\", \"readOnly\"],\n    category: \"rendering\"\n  }\n}, {\n  name: \"onEditorPrepared\",\n  config: {\n    excludeValidators: [\"disabled\", \"readOnly\"],\n    category: \"rendering\"\n  }\n}, {\n  name: \"onValueChanged\",\n  config: {\n    excludeValidators: [\"disabled\", \"readOnly\"]\n  }\n}];\nvar OPERATORS = {\n  and: \"and\",\n  or: \"or\",\n  notAnd: \"!and\",\n  notOr: \"!or\"\n};\nvar EditorFactory = Class.inherit(EditorFactoryMixin);\nvar FilterBuilder = Widget.inherit({\n  _getDefaultOptions: function () {\n    return extend(this.callBase(), {\n      onEditorPreparing: null,\n      onEditorPrepared: null,\n      onValueChanged: null,\n      fields: [],\n      defaultGroupOperation: \"and\",\n      groupOperations: [\"and\", \"or\", \"notAnd\", \"notOr\"],\n      maxGroupLevel: void 0,\n      value: null,\n      allowHierarchicalFields: false,\n      groupOperationDescriptions: {\n        and: messageLocalization.format(\"dxFilterBuilder-and\"),\n        or: messageLocalization.format(\"dxFilterBuilder-or\"),\n        notAnd: messageLocalization.format(\"dxFilterBuilder-notAnd\"),\n        notOr: messageLocalization.format(\"dxFilterBuilder-notOr\")\n      },\n      customOperations: [],\n      closePopupOnTargetScroll: true,\n      filterOperationDescriptions: {\n        between: messageLocalization.format(\"dxFilterBuilder-filterOperationBetween\"),\n        equal: messageLocalization.format(\"dxFilterBuilder-filterOperationEquals\"),\n        notEqual: messageLocalization.format(\"dxFilterBuilder-filterOperationNotEquals\"),\n        lessThan: messageLocalization.format(\"dxFilterBuilder-filterOperationLess\"),\n        lessThanOrEqual: messageLocalization.format(\"dxFilterBuilder-filterOperationLessOrEquals\"),\n        greaterThan: messageLocalization.format(\"dxFilterBuilder-filterOperationGreater\"),\n        greaterThanOrEqual: messageLocalization.format(\"dxFilterBuilder-filterOperationGreaterOrEquals\"),\n        startsWith: messageLocalization.format(\"dxFilterBuilder-filterOperationStartsWith\"),\n        contains: messageLocalization.format(\"dxFilterBuilder-filterOperationContains\"),\n        notContains: messageLocalization.format(\"dxFilterBuilder-filterOperationNotContains\"),\n        endsWith: messageLocalization.format(\"dxFilterBuilder-filterOperationEndsWith\"),\n        isBlank: messageLocalization.format(\"dxFilterBuilder-filterOperationIsBlank\"),\n        isNotBlank: messageLocalization.format(\"dxFilterBuilder-filterOperationIsNotBlank\")\n      }\n    });\n  },\n  _optionChanged: function (args) {\n    switch (args.name) {\n      case \"closePopupOnTargetScroll\":\n        break;\n\n      case \"onEditorPreparing\":\n      case \"onEditorPrepared\":\n      case \"onValueChanged\":\n        this._initActions();\n\n        break;\n\n      case \"customOperations\":\n        this._initCustomOperations();\n\n        this._invalidate();\n\n        break;\n\n      case \"fields\":\n      case \"defaultGroupOperation\":\n      case \"maxGroupLevel\":\n      case \"groupOperations\":\n      case \"allowHierarchicalFields\":\n      case \"groupOperationDescriptions\":\n      case \"filterOperationDescriptions\":\n        this._invalidate();\n\n        break;\n\n      case \"value\":\n        if (args.value !== args.previousValue) {\n          var disableInvalidateForValue = this._disableInvalidateForValue;\n\n          if (!disableInvalidateForValue) {\n            this._initModel();\n\n            this._invalidate();\n          }\n\n          this._disableInvalidateForValue = false;\n          this.executeAction(\"onValueChanged\", {\n            value: args.value,\n            previousValue: args.previousValue\n          });\n          this._disableInvalidateForValue = disableInvalidateForValue;\n        }\n\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  getFilterExpression: function () {\n    var fields = this._getNormalizedFields();\n\n    var value = extend(true, [], this._model);\n    return _getFilterExpression(getNormalizedFilter(value), fields, this._customOperations, SOURCE);\n  },\n  _getNormalizedFields: function () {\n    return getNormalizedFields(this.option(\"fields\"));\n  },\n  _updateFilter: function () {\n    this._disableInvalidateForValue = true;\n    var value = extend(true, [], this._model);\n    var normalizedValue = getNormalizedFilter(value);\n    var oldValue = getNormalizedFilter(this._getModel(this.option(\"value\")));\n\n    if (JSON.stringify(oldValue) !== JSON.stringify(normalizedValue)) {\n      this.option(\"value\", normalizedValue);\n    }\n\n    this._disableInvalidateForValue = false;\n\n    this._fireContentReadyAction();\n  },\n  _init: function () {\n    this._initCustomOperations();\n\n    this._initModel();\n\n    this._initEditorFactory();\n\n    this._initActions();\n\n    this.callBase();\n  },\n  _initEditorFactory: function () {\n    this._editorFactory = new EditorFactory();\n  },\n  _initCustomOperations: function () {\n    this._customOperations = getMergedOperations(this.option(\"customOperations\"), this.option(\"filterOperationDescriptions.between\"), this);\n  },\n  _getModel: function (value) {\n    return convertToInnerStructure(value, this._customOperations);\n  },\n  _initModel: function () {\n    this._model = this._getModel(this.option(\"value\"));\n  },\n  _initActions: function () {\n    var that = this;\n    that._actions = {};\n    ACTIONS.forEach(function (action) {\n      var actionConfig = extend({}, action.config);\n      that._actions[action.name] = that._createActionByOption(action.name, actionConfig);\n    });\n  },\n  executeAction: function (actionName, options) {\n    var action = this._actions[actionName];\n    return action && action(options);\n  },\n  _initMarkup: function () {\n    this.$element().addClass(FILTER_BUILDER_CLASS);\n    this.callBase();\n\n    this._createGroupElementByCriteria(this._model).appendTo(this.$element());\n  },\n  _createConditionElement: function (condition, parent) {\n    return $(\"<div>\").addClass(FILTER_BUILDER_GROUP_CLASS).append(this._createConditionItem(condition, parent));\n  },\n  _createGroupElementByCriteria: function (criteria, parent) {\n    var groupLevel = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0;\n\n    var $group = this._createGroupElement(criteria, parent, groupLevel);\n\n    var $groupContent = $group.find(\".\" + FILTER_BUILDER_GROUP_CONTENT_CLASS);\n    var groupCriteria = getGroupCriteria(criteria);\n\n    for (var i = 0; i < groupCriteria.length; i++) {\n      var innerCriteria = groupCriteria[i];\n\n      if (isGroup(innerCriteria)) {\n        this._createGroupElementByCriteria(innerCriteria, criteria, groupLevel + 1).appendTo($groupContent);\n      } else if (isCondition(innerCriteria)) {\n        this._createConditionElement(innerCriteria, criteria).appendTo($groupContent);\n      }\n    }\n\n    return $group;\n  },\n  _createGroupElement: function (criteria, parent, groupLevel) {\n    var $groupItem = $(\"<div>\").addClass(FILTER_BUILDER_GROUP_ITEM_CLASS);\n    var $groupContent = $(\"<div>\").addClass(FILTER_BUILDER_GROUP_CONTENT_CLASS);\n    var $group = $(\"<div>\").addClass(FILTER_BUILDER_GROUP_CLASS).append($groupItem).append($groupContent);\n\n    if (null != parent) {\n      this._createRemoveButton(() => {\n        removeItem(parent, criteria);\n        $group.remove();\n\n        this._updateFilter();\n      }).appendTo($groupItem);\n    }\n\n    this._createGroupOperationButton(criteria).appendTo($groupItem);\n\n    this._createAddButton(() => {\n      var newGroup = createEmptyGroup(this.option(\"defaultGroupOperation\"));\n      addItem(newGroup, criteria);\n\n      this._createGroupElement(newGroup, criteria, groupLevel + 1).appendTo($groupContent);\n\n      this._updateFilter();\n    }, () => {\n      var field = this.option(\"fields\")[0];\n      var newCondition = createCondition(field, this._customOperations);\n      addItem(newCondition, criteria);\n\n      this._createConditionElement(newCondition, criteria).appendTo($groupContent);\n\n      this._updateFilter();\n    }, groupLevel).appendTo($groupItem);\n\n    return $group;\n  },\n  _createButton: function (caption) {\n    return $(\"<div>\").text(caption);\n  },\n  _createGroupOperationButton: function (criteria) {\n    var groupOperations = this._getGroupOperations(criteria);\n\n    var groupMenuItem = getGroupMenuItem(criteria, groupOperations);\n    var caption = groupMenuItem.text;\n    var $operationButton = groupOperations && groupOperations.length < 2 ? this._createButton(caption).addClass(DISABLED_STATE_CLASS) : this._createButtonWithMenu({\n      caption: caption,\n      menu: {\n        items: groupOperations,\n        displayExpr: \"text\",\n        keyExpr: \"value\",\n        onItemClick: e => {\n          if (groupMenuItem !== e.itemData) {\n            setGroupValue(criteria, e.itemData.value);\n            $operationButton.text(e.itemData.text);\n            groupMenuItem = e.itemData;\n\n            this._updateFilter();\n          }\n        },\n        onContentReady: function (e) {\n          e.component.selectItem(groupMenuItem);\n        },\n        cssClass: FILTER_BUILDER_GROUP_OPERATIONS_CLASS\n      }\n    });\n    return $operationButton.addClass(FILTER_BUILDER_ITEM_TEXT_CLASS).addClass(FILTER_BUILDER_GROUP_OPERATION_CLASS).attr(\"tabindex\", 0);\n  },\n  _createButtonWithMenu: function (options) {\n    var that = this;\n\n    var removeMenu = function () {\n      that.$element().find(\".\" + ACTIVE_CLASS).removeClass(ACTIVE_CLASS);\n      that.$element().find(\".dx-overlay .dx-treeview\").remove();\n      that.$element().find(\".dx-overlay\").remove();\n    };\n\n    var rtlEnabled = this.option(\"rtlEnabled\");\n    var position = rtlEnabled ? \"right\" : \"left\";\n\n    var $button = this._createButton(options.caption);\n\n    extend(options.menu, {\n      focusStateEnabled: true,\n      selectionMode: \"single\",\n      onItemClick: (handler = options.menu.onItemClick, function (e) {\n        handler(e);\n\n        if (\"dxclick\" === e.event.type) {\n          removeMenu();\n        }\n      }),\n      onHiding: function (e) {\n        $button.removeClass(ACTIVE_CLASS);\n      },\n      position: {\n        my: position + \" top\",\n        at: position + \" bottom\",\n        offset: \"0 1\",\n        of: $button,\n        collision: \"flip\"\n      },\n      animation: null,\n      onHidden: function () {\n        removeMenu();\n      },\n      cssClass: FILTER_BUILDER_OVERLAY_CLASS + \" \" + options.menu.cssClass,\n      rtlEnabled: rtlEnabled\n    });\n    var handler;\n    options.popup = {\n      onShown: function (info) {\n        var treeViewElement = $(info.component.content()).find(\".dx-treeview\");\n        var treeView = treeViewElement.dxTreeView(\"instance\");\n        eventsEngine.on(treeViewElement, \"keyup keydown\", function (e) {\n          var keyName = normalizeKeyName(e);\n\n          if (\"keydown\" === e.type && keyName === TAB_KEY || \"keyup\" === e.type && (keyName === ESCAPE_KEY || keyName === ENTER_KEY)) {\n            info.component.hide();\n            eventsEngine.trigger(options.menu.position.of, \"focus\");\n          }\n        });\n        treeView.focus();\n        treeView.option(\"focusedElement\", null);\n      }\n    };\n\n    this._subscribeOnClickAndEnterKey($button, function () {\n      removeMenu();\n\n      that._createPopupWithTreeView(options, that.$element());\n\n      $button.addClass(ACTIVE_CLASS);\n    });\n\n    return $button;\n  },\n  _hasValueButton: function (condition) {\n    var customOperation = getCustomOperation(this._customOperations, condition[1]);\n    return customOperation ? false !== customOperation.hasValue : null !== condition[2];\n  },\n  _createOperationButtonWithMenu: function (condition, field) {\n    var that = this;\n    var availableOperations = getAvailableOperations(field, this.option(\"filterOperationDescriptions\"), this._customOperations);\n    var currentOperation = getOperationFromAvailable(getOperationValue(condition), availableOperations);\n\n    var $operationButton = this._createButtonWithMenu({\n      caption: currentOperation.text,\n      menu: {\n        items: availableOperations,\n        displayExpr: \"text\",\n        onItemRendered: function (e) {\n          e.itemData.isCustom && $(e.itemElement).addClass(FILTER_BUILDER_MENU_CUSTOM_OPERATION_CLASS);\n        },\n        onContentReady: function (e) {\n          e.component.selectItem(currentOperation);\n        },\n        onItemClick: e => {\n          if (currentOperation !== e.itemData) {\n            currentOperation = e.itemData;\n            updateConditionByOperation(condition, currentOperation.value, that._customOperations);\n            var $valueButton = $operationButton.siblings().filter(\".\" + FILTER_BUILDER_ITEM_VALUE_CLASS);\n\n            if (that._hasValueButton(condition)) {\n              if (0 !== $valueButton.length) {\n                $valueButton.remove();\n              }\n\n              that._createValueButton(condition, field).appendTo($operationButton.parent());\n            } else {\n              $valueButton.remove();\n            }\n\n            $operationButton.html(currentOperation.text);\n\n            this._updateFilter();\n          }\n        },\n        cssClass: FILTER_BUILDER_FILTER_OPERATIONS_CLASS\n      }\n    }).addClass(FILTER_BUILDER_ITEM_TEXT_CLASS).addClass(FILTER_BUILDER_ITEM_OPERATION_CLASS).attr(\"tabindex\", 0);\n\n    return $operationButton;\n  },\n  _createOperationAndValueButtons: function (condition, field, $item) {\n    this._createOperationButtonWithMenu(condition, field).appendTo($item);\n\n    if (this._hasValueButton(condition)) {\n      this._createValueButton(condition, field).appendTo($item);\n    }\n  },\n  _createFieldButtonWithMenu: function (fields, condition, field) {\n    var that = this;\n    var allowHierarchicalFields = this.option(\"allowHierarchicalFields\");\n    var items = getItems(fields, allowHierarchicalFields);\n    var item = getField(field.name || field.dataField, items);\n\n    var getFullCaption = function (item, items) {\n      return allowHierarchicalFields ? getCaptionWithParents(item, items) : item.caption;\n    };\n\n    var $fieldButton = this._createButtonWithMenu({\n      caption: getFullCaption(item, items),\n      menu: {\n        items: items,\n        dataStructure: \"plain\",\n        keyExpr: \"id\",\n        parentId: \"parentId\",\n        displayExpr: \"caption\",\n        onItemClick: e => {\n          if (item !== e.itemData) {\n            item = e.itemData;\n            condition[0] = item.name || item.dataField;\n            condition[2] = \"object\" === item.dataType ? null : \"\";\n            updateConditionByOperation(condition, getDefaultOperation(item), that._customOperations);\n            $fieldButton.siblings().filter(\".\" + FILTER_BUILDER_ITEM_TEXT_CLASS).remove();\n\n            that._createOperationAndValueButtons(condition, item, $fieldButton.parent());\n\n            var caption = getFullCaption(item, e.component.option(\"items\"));\n            $fieldButton.html(caption);\n\n            this._updateFilter();\n          }\n        },\n        onContentReady: function (e) {\n          e.component.selectItem(item);\n        },\n        cssClass: FILTER_BUILDER_FIELDS_CLASS\n      }\n    }).addClass(FILTER_BUILDER_ITEM_TEXT_CLASS).addClass(FILTER_BUILDER_ITEM_FIELD_CLASS).attr(\"tabindex\", 0);\n\n    return $fieldButton;\n  },\n  _createConditionItem: function (condition, parent) {\n    var $item = $(\"<div>\").addClass(FILTER_BUILDER_GROUP_ITEM_CLASS);\n\n    var fields = this._getNormalizedFields();\n\n    var field = getField(condition[0], fields);\n\n    this._createRemoveButton(() => {\n      removeItem(parent, condition);\n      var isSingleChild = 1 === $item.parent().children().length;\n\n      if (isSingleChild) {\n        $item.parent().remove();\n      } else {\n        $item.remove();\n      }\n\n      this._updateFilter();\n    }).appendTo($item);\n\n    this._createFieldButtonWithMenu(fields, condition, field).appendTo($item);\n\n    this._createOperationAndValueButtons(condition, field, $item);\n\n    return $item;\n  },\n  _getGroupOperations: function (criteria) {\n    var groupOperations = this.option(\"groupOperations\");\n    var groupOperationDescriptions = this.option(\"groupOperationDescriptions\");\n\n    if (!groupOperations || !groupOperations.length) {\n      groupOperations = [getGroupValue(criteria).replace(\"!\", \"not\")];\n    }\n\n    return groupOperations.map(operation => ({\n      text: groupOperationDescriptions[operation],\n      value: OPERATORS[operation]\n    }));\n  },\n  _createRemoveButton: function (handler) {\n    var $removeButton = $(\"<div>\").addClass(FILTER_BUILDER_IMAGE_CLASS).addClass(FILTER_BUILDER_IMAGE_REMOVE_CLASS).addClass(FILTER_BUILDER_ACTION_CLASS).attr(\"tabindex\", 0);\n\n    this._subscribeOnClickAndEnterKey($removeButton, handler);\n\n    return $removeButton;\n  },\n  _createAddButton: function (addGroupHandler, addConditionHandler, groupLevel) {\n    var $button;\n    var maxGroupLevel = this.option(\"maxGroupLevel\");\n\n    if (isDefined(maxGroupLevel) && groupLevel >= maxGroupLevel) {\n      $button = this._createButton();\n\n      this._subscribeOnClickAndEnterKey($button, addConditionHandler);\n    } else {\n      $button = this._createButtonWithMenu({\n        menu: {\n          items: [{\n            caption: messageLocalization.format(\"dxFilterBuilder-addCondition\"),\n            click: addConditionHandler\n          }, {\n            caption: messageLocalization.format(\"dxFilterBuilder-addGroup\"),\n            click: addGroupHandler\n          }],\n          displayExpr: \"caption\",\n          onItemClick: function (e) {\n            e.itemData.click();\n          },\n          cssClass: FILTER_BUILDER_ADD_CONDITION_CLASS\n        }\n      });\n    }\n\n    return $button.addClass(FILTER_BUILDER_IMAGE_CLASS).addClass(FILTER_BUILDER_IMAGE_ADD_CLASS).addClass(FILTER_BUILDER_ACTION_CLASS).attr(\"tabindex\", 0);\n  },\n  _createValueText: function (item, field, $container) {\n    var that = this;\n    var $text = $(\"<div>\").html(\"&nbsp;\").addClass(FILTER_BUILDER_ITEM_VALUE_TEXT_CLASS).attr(\"tabindex\", 0).appendTo($container);\n    var value = item[2];\n    var customOperation = getCustomOperation(that._customOperations, item[1]);\n\n    if (!customOperation && field.lookup) {\n      getCurrentLookupValueText(field, value, function (result) {\n        renderValueText($text, result);\n      });\n    } else {\n      when(getCurrentValueText(field, value, customOperation)).done(result => {\n        renderValueText($text, result, customOperation);\n      });\n    }\n\n    that._subscribeOnClickAndEnterKey($text, function (e) {\n      if (\"keyup\" === e.type) {\n        e.stopPropagation();\n      }\n\n      that._createValueEditorWithEvents(item, field, $container);\n    });\n\n    return $text;\n  },\n  _updateConditionValue: function (item, value, callback) {\n    var areValuesDifferent = item[2] !== value;\n\n    if (areValuesDifferent) {\n      item[2] = value;\n    }\n\n    callback();\n\n    this._updateFilter();\n  },\n  _addDocumentKeyUp: function ($editor, handler) {\n    var isComposing = false;\n    var hasCompositionJustEnded = false;\n    var document = domAdapter.getDocument();\n\n    var documentKeyUpHandler = e => {\n      if (isComposing || hasCompositionJustEnded) {\n        hasCompositionJustEnded = false;\n        return;\n      }\n\n      handler(e);\n    };\n\n    eventsEngine.on(document, \"keyup\", documentKeyUpHandler);\n    var input = $editor.find(\"input\");\n    eventsEngine.on(input, \"compositionstart\", () => {\n      isComposing = true;\n    });\n    eventsEngine.on(input, \"compositionend\", () => {\n      isComposing = false;\n      hasCompositionJustEnded = true;\n    });\n    eventsEngine.on(input, \"keydown\", event => {\n      if (229 !== event.which) {\n        hasCompositionJustEnded = false;\n      }\n    });\n    this._documentKeyUpHandler = documentKeyUpHandler;\n  },\n  _addDocumentClick: function ($editor, closeEditorFunc) {\n    var document = domAdapter.getDocument();\n\n    var documentClickHandler = e => {\n      if (!this._isFocusOnEditorParts($editor, e.target)) {\n        eventsEngine.trigger($editor.find(\"input\"), \"change\");\n        closeEditorFunc();\n      }\n    };\n\n    eventsEngine.on(document, \"dxpointerdown\", documentClickHandler);\n    this._documentClickHandler = documentClickHandler;\n  },\n  _isFocusOnEditorParts: function ($editor, target) {\n    var activeElement = target || domAdapter.getActiveElement();\n    return $(activeElement).closest($editor.children()).length || $(activeElement).closest(\".dx-dropdowneditor-overlay\").length;\n  },\n  _removeEvents: function () {\n    var document = domAdapter.getDocument();\n    isDefined(this._documentKeyUpHandler) && eventsEngine.off(document, \"keyup\", this._documentKeyUpHandler);\n    isDefined(this._documentClickHandler) && eventsEngine.off(document, \"dxpointerdown\", this._documentClickHandler);\n  },\n  _dispose: function () {\n    this._removeEvents();\n\n    this.callBase();\n  },\n  _createValueEditorWithEvents: function (item, field, $container) {\n    var value = item[2];\n\n    var createValueText = () => {\n      $container.empty();\n\n      this._removeEvents();\n\n      return this._createValueText(item, field, $container);\n    };\n\n    var closeEditor = () => {\n      this._updateConditionValue(item, value, function () {\n        createValueText();\n      });\n    };\n\n    var options = {\n      value: \"\" === value ? null : value,\n      filterOperation: getOperationValue(item),\n      setValue: function (data) {\n        value = null === data ? \"\" : data;\n      },\n      closeEditor: closeEditor,\n      text: $container.text()\n    };\n    $container.empty();\n\n    var $editor = this._createValueEditor($container, field, options);\n\n    eventsEngine.trigger($editor.find(\"input\").not(\":hidden\").eq(0), \"focus\");\n\n    this._removeEvents();\n\n    this._addDocumentClick($editor, closeEditor);\n\n    this._addDocumentKeyUp($editor, e => {\n      var keyName = normalizeKeyName(e);\n\n      if (keyName === TAB_KEY) {\n        if (this._isFocusOnEditorParts($editor)) {\n          return;\n        }\n\n        this._updateConditionValue(item, value, function () {\n          createValueText();\n\n          if (e.shiftKey) {\n            eventsEngine.trigger($container.prev(), \"focus\");\n          }\n        });\n      }\n\n      if (keyName === ESCAPE_KEY) {\n        eventsEngine.trigger(createValueText(), \"focus\");\n      }\n\n      if (keyName === ENTER_KEY) {\n        this._updateConditionValue(item, value, function () {\n          eventsEngine.trigger(createValueText(), \"focus\");\n        });\n      }\n    });\n\n    this._fireContentReadyAction();\n  },\n  _createValueButton: function (item, field) {\n    var $valueButton = $(\"<div>\").addClass(FILTER_BUILDER_ITEM_TEXT_CLASS).addClass(FILTER_BUILDER_ITEM_VALUE_CLASS);\n\n    this._createValueText(item, field, $valueButton);\n\n    return $valueButton;\n  },\n  _createValueEditor: function ($container, field, options) {\n    var $editor = $(\"<div>\").attr(\"tabindex\", 0).appendTo($container);\n    var customOperation = getCustomOperation(this._customOperations, options.filterOperation);\n    var editorTemplate = customOperation && customOperation.editorTemplate ? customOperation.editorTemplate : field.editorTemplate;\n\n    if (editorTemplate) {\n      var template = this._getTemplate(editorTemplate);\n\n      template.render({\n        model: extend({\n          field: field\n        }, options),\n        container: $editor\n      });\n    } else {\n      this._editorFactory.createEditor.call(this, $editor, extend({}, field, options, {\n        parentType: SOURCE\n      }));\n    }\n\n    return $editor;\n  },\n  _createPopupWithTreeView: function (options, $container) {\n    var that = this;\n    var $popup = $(\"<div>\").addClass(options.menu.cssClass).appendTo($container);\n\n    this._createComponent($popup, Popup, {\n      wrapperAttr: {\n        class: options.menu.cssClass\n      },\n      onHiding: options.menu.onHiding,\n      onHidden: options.menu.onHidden,\n      rtlEnabled: options.menu.rtlEnabled,\n      position: options.menu.position,\n      animation: options.menu.animation,\n      contentTemplate: function (contentElement) {\n        var $menuContainer = $(\"<div>\").appendTo(contentElement);\n\n        that._createComponent($menuContainer, TreeView, options.menu);\n\n        this.repaint();\n      },\n      _ignoreFunctionValueDeprecation: true,\n      maxHeight: function () {\n        return getElementMaxHeightByWindow(options.menu.position.of);\n      },\n      visible: true,\n      focusStateEnabled: false,\n      hideOnParentScroll: this.option(\"closePopupOnTargetScroll\"),\n      closeOnOutsideClick: true,\n      onShown: options.popup.onShown,\n      shading: false,\n      width: \"auto\",\n      height: \"auto\",\n      showTitle: false\n    });\n  },\n  _subscribeOnClickAndEnterKey: function ($button, handler) {\n    eventsEngine.on($button, \"dxclick\", handler);\n    eventsEngine.on($button, \"keyup\", function (e) {\n      if (normalizeKeyName(e) === ENTER_KEY) {\n        handler(e);\n      }\n    });\n  }\n});\nregisterComponent(\"dxFilterBuilder\", FilterBuilder);\nexport default FilterBuilder;","map":{"version":3,"sources":["/Users/rahulsharma/node_modules/devextreme/esm/ui/filter_builder/filter_builder.js"],"names":["$","domAdapter","Class","eventsEngine","Widget","registerComponent","extend","messageLocalization","when","isDefined","TreeView","Popup","getElementMaxHeightByWindow","EditorFactoryMixin","normalizeKeyName","renderValueText","getFilterExpression","_getFilterExpression","getNormalizedFilter","getNormalizedFields","getMergedOperations","convertToInnerStructure","getGroupCriteria","isGroup","isCondition","removeItem","createEmptyGroup","addItem","createCondition","getGroupMenuItem","setGroupValue","getCustomOperation","getAvailableOperations","getOperationFromAvailable","getOperationValue","updateConditionByOperation","getItems","getField","getCaptionWithParents","getDefaultOperation","getGroupValue","getCurrentLookupValueText","getCurrentValueText","FILTER_BUILDER_CLASS","FILTER_BUILDER_GROUP_CLASS","FILTER_BUILDER_GROUP_ITEM_CLASS","FILTER_BUILDER_GROUP_CONTENT_CLASS","FILTER_BUILDER_GROUP_OPERATIONS_CLASS","FILTER_BUILDER_GROUP_OPERATION_CLASS","FILTER_BUILDER_ACTION_CLASS","FILTER_BUILDER_IMAGE_CLASS","FILTER_BUILDER_IMAGE_ADD_CLASS","FILTER_BUILDER_IMAGE_REMOVE_CLASS","FILTER_BUILDER_ITEM_TEXT_CLASS","FILTER_BUILDER_ITEM_FIELD_CLASS","FILTER_BUILDER_ITEM_OPERATION_CLASS","FILTER_BUILDER_ITEM_VALUE_CLASS","FILTER_BUILDER_ITEM_VALUE_TEXT_CLASS","FILTER_BUILDER_OVERLAY_CLASS","FILTER_BUILDER_FILTER_OPERATIONS_CLASS","FILTER_BUILDER_FIELDS_CLASS","FILTER_BUILDER_ADD_CONDITION_CLASS","ACTIVE_CLASS","FILTER_BUILDER_MENU_CUSTOM_OPERATION_CLASS","SOURCE","DISABLED_STATE_CLASS","TAB_KEY","ENTER_KEY","ESCAPE_KEY","ACTIONS","name","config","excludeValidators","category","OPERATORS","and","or","notAnd","notOr","EditorFactory","inherit","FilterBuilder","_getDefaultOptions","callBase","onEditorPreparing","onEditorPrepared","onValueChanged","fields","defaultGroupOperation","groupOperations","maxGroupLevel","value","allowHierarchicalFields","groupOperationDescriptions","format","customOperations","closePopupOnTargetScroll","filterOperationDescriptions","between","equal","notEqual","lessThan","lessThanOrEqual","greaterThan","greaterThanOrEqual","startsWith","contains","notContains","endsWith","isBlank","isNotBlank","_optionChanged","args","_initActions","_initCustomOperations","_invalidate","previousValue","disableInvalidateForValue","_disableInvalidateForValue","_initModel","executeAction","_getNormalizedFields","_model","_customOperations","option","_updateFilter","normalizedValue","oldValue","_getModel","JSON","stringify","_fireContentReadyAction","_init","_initEditorFactory","_editorFactory","that","_actions","forEach","action","actionConfig","_createActionByOption","actionName","options","_initMarkup","$element","addClass","_createGroupElementByCriteria","appendTo","_createConditionElement","condition","parent","append","_createConditionItem","criteria","groupLevel","arguments","length","$group","_createGroupElement","$groupContent","find","groupCriteria","i","innerCriteria","$groupItem","_createRemoveButton","remove","_createGroupOperationButton","_createAddButton","newGroup","field","newCondition","_createButton","caption","text","_getGroupOperations","groupMenuItem","$operationButton","_createButtonWithMenu","menu","items","displayExpr","keyExpr","onItemClick","e","itemData","onContentReady","component","selectItem","cssClass","attr","removeMenu","removeClass","rtlEnabled","position","$button","focusStateEnabled","selectionMode","handler","event","type","onHiding","my","at","offset","of","collision","animation","onHidden","popup","onShown","info","treeViewElement","content","treeView","dxTreeView","on","keyName","hide","trigger","focus","_subscribeOnClickAndEnterKey","_createPopupWithTreeView","_hasValueButton","customOperation","hasValue","_createOperationButtonWithMenu","availableOperations","currentOperation","onItemRendered","isCustom","itemElement","$valueButton","siblings","filter","_createValueButton","html","_createOperationAndValueButtons","$item","_createFieldButtonWithMenu","item","dataField","getFullCaption","$fieldButton","dataStructure","parentId","dataType","isSingleChild","children","replace","map","operation","$removeButton","addGroupHandler","addConditionHandler","click","_createValueText","$container","$text","lookup","result","done","stopPropagation","_createValueEditorWithEvents","_updateConditionValue","callback","areValuesDifferent","_addDocumentKeyUp","$editor","isComposing","hasCompositionJustEnded","document","getDocument","documentKeyUpHandler","input","which","_documentKeyUpHandler","_addDocumentClick","closeEditorFunc","documentClickHandler","_isFocusOnEditorParts","target","_documentClickHandler","activeElement","getActiveElement","closest","_removeEvents","off","_dispose","createValueText","empty","closeEditor","filterOperation","setValue","data","_createValueEditor","not","eq","shiftKey","prev","editorTemplate","template","_getTemplate","render","model","container","createEditor","call","parentType","$popup","_createComponent","wrapperAttr","class","contentTemplate","contentElement","$menuContainer","repaint","_ignoreFunctionValueDeprecation","maxHeight","visible","hideOnParentScroll","closeOnOutsideClick","shading","width","height","showTitle"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/filter_builder/filter_builder.js)\r\n * Version: 21.2.3\r\n * Build date: Thu Oct 28 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport domAdapter from \"../../core/dom_adapter\";\r\nimport Class from \"../../core/class\";\r\nimport eventsEngine from \"../../events/core/events_engine\";\r\nimport Widget from \"../widget/ui.widget\";\r\nimport registerComponent from \"../../core/component_registrator\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport messageLocalization from \"../../localization/message\";\r\nimport {\r\n    when\r\n} from \"../../core/utils/deferred\";\r\nimport {\r\n    isDefined\r\n} from \"../../core/utils/type\";\r\nimport TreeView from \"../tree_view\";\r\nimport Popup from \"../popup\";\r\nimport {\r\n    getElementMaxHeightByWindow\r\n} from \"../overlay/utils\";\r\nimport EditorFactoryMixin from \"../shared/ui.editor_factory_mixin\";\r\nimport {\r\n    normalizeKeyName\r\n} from \"../../events/utils/index\";\r\nimport {\r\n    renderValueText,\r\n    getFilterExpression as _getFilterExpression,\r\n    getNormalizedFilter,\r\n    getNormalizedFields,\r\n    getMergedOperations,\r\n    convertToInnerStructure,\r\n    getGroupCriteria,\r\n    isGroup,\r\n    isCondition,\r\n    removeItem,\r\n    createEmptyGroup,\r\n    addItem,\r\n    createCondition,\r\n    getGroupMenuItem,\r\n    setGroupValue,\r\n    getCustomOperation,\r\n    getAvailableOperations,\r\n    getOperationFromAvailable,\r\n    getOperationValue,\r\n    updateConditionByOperation,\r\n    getItems,\r\n    getField,\r\n    getCaptionWithParents,\r\n    getDefaultOperation,\r\n    getGroupValue,\r\n    getCurrentLookupValueText,\r\n    getCurrentValueText\r\n} from \"./utils\";\r\nvar FILTER_BUILDER_CLASS = \"dx-filterbuilder\";\r\nvar FILTER_BUILDER_GROUP_CLASS = FILTER_BUILDER_CLASS + \"-group\";\r\nvar FILTER_BUILDER_GROUP_ITEM_CLASS = FILTER_BUILDER_GROUP_CLASS + \"-item\";\r\nvar FILTER_BUILDER_GROUP_CONTENT_CLASS = FILTER_BUILDER_GROUP_CLASS + \"-content\";\r\nvar FILTER_BUILDER_GROUP_OPERATIONS_CLASS = FILTER_BUILDER_GROUP_CLASS + \"-operations\";\r\nvar FILTER_BUILDER_GROUP_OPERATION_CLASS = FILTER_BUILDER_GROUP_CLASS + \"-operation\";\r\nvar FILTER_BUILDER_ACTION_CLASS = FILTER_BUILDER_CLASS + \"-action\";\r\nvar FILTER_BUILDER_IMAGE_CLASS = FILTER_BUILDER_ACTION_CLASS + \"-icon\";\r\nvar FILTER_BUILDER_IMAGE_ADD_CLASS = \"dx-icon-plus\";\r\nvar FILTER_BUILDER_IMAGE_REMOVE_CLASS = \"dx-icon-remove\";\r\nvar FILTER_BUILDER_ITEM_TEXT_CLASS = FILTER_BUILDER_CLASS + \"-text\";\r\nvar FILTER_BUILDER_ITEM_FIELD_CLASS = FILTER_BUILDER_CLASS + \"-item-field\";\r\nvar FILTER_BUILDER_ITEM_OPERATION_CLASS = FILTER_BUILDER_CLASS + \"-item-operation\";\r\nvar FILTER_BUILDER_ITEM_VALUE_CLASS = FILTER_BUILDER_CLASS + \"-item-value\";\r\nvar FILTER_BUILDER_ITEM_VALUE_TEXT_CLASS = FILTER_BUILDER_CLASS + \"-item-value-text\";\r\nvar FILTER_BUILDER_OVERLAY_CLASS = FILTER_BUILDER_CLASS + \"-overlay\";\r\nvar FILTER_BUILDER_FILTER_OPERATIONS_CLASS = FILTER_BUILDER_CLASS + \"-operations\";\r\nvar FILTER_BUILDER_FIELDS_CLASS = FILTER_BUILDER_CLASS + \"-fields\";\r\nvar FILTER_BUILDER_ADD_CONDITION_CLASS = FILTER_BUILDER_CLASS + \"-add-condition\";\r\nvar ACTIVE_CLASS = \"dx-state-active\";\r\nvar FILTER_BUILDER_MENU_CUSTOM_OPERATION_CLASS = FILTER_BUILDER_CLASS + \"-menu-custom-operation\";\r\nvar SOURCE = \"filterBuilder\";\r\nvar DISABLED_STATE_CLASS = \"dx-state-disabled\";\r\nvar TAB_KEY = \"tab\";\r\nvar ENTER_KEY = \"enter\";\r\nvar ESCAPE_KEY = \"escape\";\r\nvar ACTIONS = [{\r\n    name: \"onEditorPreparing\",\r\n    config: {\r\n        excludeValidators: [\"disabled\", \"readOnly\"],\r\n        category: \"rendering\"\r\n    }\r\n}, {\r\n    name: \"onEditorPrepared\",\r\n    config: {\r\n        excludeValidators: [\"disabled\", \"readOnly\"],\r\n        category: \"rendering\"\r\n    }\r\n}, {\r\n    name: \"onValueChanged\",\r\n    config: {\r\n        excludeValidators: [\"disabled\", \"readOnly\"]\r\n    }\r\n}];\r\nvar OPERATORS = {\r\n    and: \"and\",\r\n    or: \"or\",\r\n    notAnd: \"!and\",\r\n    notOr: \"!or\"\r\n};\r\nvar EditorFactory = Class.inherit(EditorFactoryMixin);\r\nvar FilterBuilder = Widget.inherit({\r\n    _getDefaultOptions: function() {\r\n        return extend(this.callBase(), {\r\n            onEditorPreparing: null,\r\n            onEditorPrepared: null,\r\n            onValueChanged: null,\r\n            fields: [],\r\n            defaultGroupOperation: \"and\",\r\n            groupOperations: [\"and\", \"or\", \"notAnd\", \"notOr\"],\r\n            maxGroupLevel: void 0,\r\n            value: null,\r\n            allowHierarchicalFields: false,\r\n            groupOperationDescriptions: {\r\n                and: messageLocalization.format(\"dxFilterBuilder-and\"),\r\n                or: messageLocalization.format(\"dxFilterBuilder-or\"),\r\n                notAnd: messageLocalization.format(\"dxFilterBuilder-notAnd\"),\r\n                notOr: messageLocalization.format(\"dxFilterBuilder-notOr\")\r\n            },\r\n            customOperations: [],\r\n            closePopupOnTargetScroll: true,\r\n            filterOperationDescriptions: {\r\n                between: messageLocalization.format(\"dxFilterBuilder-filterOperationBetween\"),\r\n                equal: messageLocalization.format(\"dxFilterBuilder-filterOperationEquals\"),\r\n                notEqual: messageLocalization.format(\"dxFilterBuilder-filterOperationNotEquals\"),\r\n                lessThan: messageLocalization.format(\"dxFilterBuilder-filterOperationLess\"),\r\n                lessThanOrEqual: messageLocalization.format(\"dxFilterBuilder-filterOperationLessOrEquals\"),\r\n                greaterThan: messageLocalization.format(\"dxFilterBuilder-filterOperationGreater\"),\r\n                greaterThanOrEqual: messageLocalization.format(\"dxFilterBuilder-filterOperationGreaterOrEquals\"),\r\n                startsWith: messageLocalization.format(\"dxFilterBuilder-filterOperationStartsWith\"),\r\n                contains: messageLocalization.format(\"dxFilterBuilder-filterOperationContains\"),\r\n                notContains: messageLocalization.format(\"dxFilterBuilder-filterOperationNotContains\"),\r\n                endsWith: messageLocalization.format(\"dxFilterBuilder-filterOperationEndsWith\"),\r\n                isBlank: messageLocalization.format(\"dxFilterBuilder-filterOperationIsBlank\"),\r\n                isNotBlank: messageLocalization.format(\"dxFilterBuilder-filterOperationIsNotBlank\")\r\n            }\r\n        })\r\n    },\r\n    _optionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"closePopupOnTargetScroll\":\r\n                break;\r\n            case \"onEditorPreparing\":\r\n            case \"onEditorPrepared\":\r\n            case \"onValueChanged\":\r\n                this._initActions();\r\n                break;\r\n            case \"customOperations\":\r\n                this._initCustomOperations();\r\n                this._invalidate();\r\n                break;\r\n            case \"fields\":\r\n            case \"defaultGroupOperation\":\r\n            case \"maxGroupLevel\":\r\n            case \"groupOperations\":\r\n            case \"allowHierarchicalFields\":\r\n            case \"groupOperationDescriptions\":\r\n            case \"filterOperationDescriptions\":\r\n                this._invalidate();\r\n                break;\r\n            case \"value\":\r\n                if (args.value !== args.previousValue) {\r\n                    var disableInvalidateForValue = this._disableInvalidateForValue;\r\n                    if (!disableInvalidateForValue) {\r\n                        this._initModel();\r\n                        this._invalidate()\r\n                    }\r\n                    this._disableInvalidateForValue = false;\r\n                    this.executeAction(\"onValueChanged\", {\r\n                        value: args.value,\r\n                        previousValue: args.previousValue\r\n                    });\r\n                    this._disableInvalidateForValue = disableInvalidateForValue\r\n                }\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    },\r\n    getFilterExpression: function() {\r\n        var fields = this._getNormalizedFields();\r\n        var value = extend(true, [], this._model);\r\n        return _getFilterExpression(getNormalizedFilter(value), fields, this._customOperations, SOURCE)\r\n    },\r\n    _getNormalizedFields: function() {\r\n        return getNormalizedFields(this.option(\"fields\"))\r\n    },\r\n    _updateFilter: function() {\r\n        this._disableInvalidateForValue = true;\r\n        var value = extend(true, [], this._model);\r\n        var normalizedValue = getNormalizedFilter(value);\r\n        var oldValue = getNormalizedFilter(this._getModel(this.option(\"value\")));\r\n        if (JSON.stringify(oldValue) !== JSON.stringify(normalizedValue)) {\r\n            this.option(\"value\", normalizedValue)\r\n        }\r\n        this._disableInvalidateForValue = false;\r\n        this._fireContentReadyAction()\r\n    },\r\n    _init: function() {\r\n        this._initCustomOperations();\r\n        this._initModel();\r\n        this._initEditorFactory();\r\n        this._initActions();\r\n        this.callBase()\r\n    },\r\n    _initEditorFactory: function() {\r\n        this._editorFactory = new EditorFactory\r\n    },\r\n    _initCustomOperations: function() {\r\n        this._customOperations = getMergedOperations(this.option(\"customOperations\"), this.option(\"filterOperationDescriptions.between\"), this)\r\n    },\r\n    _getModel: function(value) {\r\n        return convertToInnerStructure(value, this._customOperations)\r\n    },\r\n    _initModel: function() {\r\n        this._model = this._getModel(this.option(\"value\"))\r\n    },\r\n    _initActions: function() {\r\n        var that = this;\r\n        that._actions = {};\r\n        ACTIONS.forEach((function(action) {\r\n            var actionConfig = extend({}, action.config);\r\n            that._actions[action.name] = that._createActionByOption(action.name, actionConfig)\r\n        }))\r\n    },\r\n    executeAction: function(actionName, options) {\r\n        var action = this._actions[actionName];\r\n        return action && action(options)\r\n    },\r\n    _initMarkup: function() {\r\n        this.$element().addClass(FILTER_BUILDER_CLASS);\r\n        this.callBase();\r\n        this._createGroupElementByCriteria(this._model).appendTo(this.$element())\r\n    },\r\n    _createConditionElement: function(condition, parent) {\r\n        return $(\"<div>\").addClass(FILTER_BUILDER_GROUP_CLASS).append(this._createConditionItem(condition, parent))\r\n    },\r\n    _createGroupElementByCriteria: function(criteria, parent) {\r\n        var groupLevel = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0;\r\n        var $group = this._createGroupElement(criteria, parent, groupLevel);\r\n        var $groupContent = $group.find(\".\" + FILTER_BUILDER_GROUP_CONTENT_CLASS);\r\n        var groupCriteria = getGroupCriteria(criteria);\r\n        for (var i = 0; i < groupCriteria.length; i++) {\r\n            var innerCriteria = groupCriteria[i];\r\n            if (isGroup(innerCriteria)) {\r\n                this._createGroupElementByCriteria(innerCriteria, criteria, groupLevel + 1).appendTo($groupContent)\r\n            } else if (isCondition(innerCriteria)) {\r\n                this._createConditionElement(innerCriteria, criteria).appendTo($groupContent)\r\n            }\r\n        }\r\n        return $group\r\n    },\r\n    _createGroupElement: function(criteria, parent, groupLevel) {\r\n        var $groupItem = $(\"<div>\").addClass(FILTER_BUILDER_GROUP_ITEM_CLASS);\r\n        var $groupContent = $(\"<div>\").addClass(FILTER_BUILDER_GROUP_CONTENT_CLASS);\r\n        var $group = $(\"<div>\").addClass(FILTER_BUILDER_GROUP_CLASS).append($groupItem).append($groupContent);\r\n        if (null != parent) {\r\n            this._createRemoveButton(() => {\r\n                removeItem(parent, criteria);\r\n                $group.remove();\r\n                this._updateFilter()\r\n            }).appendTo($groupItem)\r\n        }\r\n        this._createGroupOperationButton(criteria).appendTo($groupItem);\r\n        this._createAddButton(() => {\r\n            var newGroup = createEmptyGroup(this.option(\"defaultGroupOperation\"));\r\n            addItem(newGroup, criteria);\r\n            this._createGroupElement(newGroup, criteria, groupLevel + 1).appendTo($groupContent);\r\n            this._updateFilter()\r\n        }, () => {\r\n            var field = this.option(\"fields\")[0];\r\n            var newCondition = createCondition(field, this._customOperations);\r\n            addItem(newCondition, criteria);\r\n            this._createConditionElement(newCondition, criteria).appendTo($groupContent);\r\n            this._updateFilter()\r\n        }, groupLevel).appendTo($groupItem);\r\n        return $group\r\n    },\r\n    _createButton: function(caption) {\r\n        return $(\"<div>\").text(caption)\r\n    },\r\n    _createGroupOperationButton: function(criteria) {\r\n        var groupOperations = this._getGroupOperations(criteria);\r\n        var groupMenuItem = getGroupMenuItem(criteria, groupOperations);\r\n        var caption = groupMenuItem.text;\r\n        var $operationButton = groupOperations && groupOperations.length < 2 ? this._createButton(caption).addClass(DISABLED_STATE_CLASS) : this._createButtonWithMenu({\r\n            caption: caption,\r\n            menu: {\r\n                items: groupOperations,\r\n                displayExpr: \"text\",\r\n                keyExpr: \"value\",\r\n                onItemClick: e => {\r\n                    if (groupMenuItem !== e.itemData) {\r\n                        setGroupValue(criteria, e.itemData.value);\r\n                        $operationButton.text(e.itemData.text);\r\n                        groupMenuItem = e.itemData;\r\n                        this._updateFilter()\r\n                    }\r\n                },\r\n                onContentReady: function(e) {\r\n                    e.component.selectItem(groupMenuItem)\r\n                },\r\n                cssClass: FILTER_BUILDER_GROUP_OPERATIONS_CLASS\r\n            }\r\n        });\r\n        return $operationButton.addClass(FILTER_BUILDER_ITEM_TEXT_CLASS).addClass(FILTER_BUILDER_GROUP_OPERATION_CLASS).attr(\"tabindex\", 0)\r\n    },\r\n    _createButtonWithMenu: function(options) {\r\n        var that = this;\r\n        var removeMenu = function() {\r\n            that.$element().find(\".\" + ACTIVE_CLASS).removeClass(ACTIVE_CLASS);\r\n            that.$element().find(\".dx-overlay .dx-treeview\").remove();\r\n            that.$element().find(\".dx-overlay\").remove()\r\n        };\r\n        var rtlEnabled = this.option(\"rtlEnabled\");\r\n        var position = rtlEnabled ? \"right\" : \"left\";\r\n        var $button = this._createButton(options.caption);\r\n        extend(options.menu, {\r\n            focusStateEnabled: true,\r\n            selectionMode: \"single\",\r\n            onItemClick: (handler = options.menu.onItemClick, function(e) {\r\n                handler(e);\r\n                if (\"dxclick\" === e.event.type) {\r\n                    removeMenu()\r\n                }\r\n            }),\r\n            onHiding: function(e) {\r\n                $button.removeClass(ACTIVE_CLASS)\r\n            },\r\n            position: {\r\n                my: position + \" top\",\r\n                at: position + \" bottom\",\r\n                offset: \"0 1\",\r\n                of: $button,\r\n                collision: \"flip\"\r\n            },\r\n            animation: null,\r\n            onHidden: function() {\r\n                removeMenu()\r\n            },\r\n            cssClass: FILTER_BUILDER_OVERLAY_CLASS + \" \" + options.menu.cssClass,\r\n            rtlEnabled: rtlEnabled\r\n        });\r\n        var handler;\r\n        options.popup = {\r\n            onShown: function(info) {\r\n                var treeViewElement = $(info.component.content()).find(\".dx-treeview\");\r\n                var treeView = treeViewElement.dxTreeView(\"instance\");\r\n                eventsEngine.on(treeViewElement, \"keyup keydown\", (function(e) {\r\n                    var keyName = normalizeKeyName(e);\r\n                    if (\"keydown\" === e.type && keyName === TAB_KEY || \"keyup\" === e.type && (keyName === ESCAPE_KEY || keyName === ENTER_KEY)) {\r\n                        info.component.hide();\r\n                        eventsEngine.trigger(options.menu.position.of, \"focus\")\r\n                    }\r\n                }));\r\n                treeView.focus();\r\n                treeView.option(\"focusedElement\", null)\r\n            }\r\n        };\r\n        this._subscribeOnClickAndEnterKey($button, (function() {\r\n            removeMenu();\r\n            that._createPopupWithTreeView(options, that.$element());\r\n            $button.addClass(ACTIVE_CLASS)\r\n        }));\r\n        return $button\r\n    },\r\n    _hasValueButton: function(condition) {\r\n        var customOperation = getCustomOperation(this._customOperations, condition[1]);\r\n        return customOperation ? false !== customOperation.hasValue : null !== condition[2]\r\n    },\r\n    _createOperationButtonWithMenu: function(condition, field) {\r\n        var that = this;\r\n        var availableOperations = getAvailableOperations(field, this.option(\"filterOperationDescriptions\"), this._customOperations);\r\n        var currentOperation = getOperationFromAvailable(getOperationValue(condition), availableOperations);\r\n        var $operationButton = this._createButtonWithMenu({\r\n            caption: currentOperation.text,\r\n            menu: {\r\n                items: availableOperations,\r\n                displayExpr: \"text\",\r\n                onItemRendered: function(e) {\r\n                    e.itemData.isCustom && $(e.itemElement).addClass(FILTER_BUILDER_MENU_CUSTOM_OPERATION_CLASS)\r\n                },\r\n                onContentReady: function(e) {\r\n                    e.component.selectItem(currentOperation)\r\n                },\r\n                onItemClick: e => {\r\n                    if (currentOperation !== e.itemData) {\r\n                        currentOperation = e.itemData;\r\n                        updateConditionByOperation(condition, currentOperation.value, that._customOperations);\r\n                        var $valueButton = $operationButton.siblings().filter(\".\" + FILTER_BUILDER_ITEM_VALUE_CLASS);\r\n                        if (that._hasValueButton(condition)) {\r\n                            if (0 !== $valueButton.length) {\r\n                                $valueButton.remove()\r\n                            }\r\n                            that._createValueButton(condition, field).appendTo($operationButton.parent())\r\n                        } else {\r\n                            $valueButton.remove()\r\n                        }\r\n                        $operationButton.html(currentOperation.text);\r\n                        this._updateFilter()\r\n                    }\r\n                },\r\n                cssClass: FILTER_BUILDER_FILTER_OPERATIONS_CLASS\r\n            }\r\n        }).addClass(FILTER_BUILDER_ITEM_TEXT_CLASS).addClass(FILTER_BUILDER_ITEM_OPERATION_CLASS).attr(\"tabindex\", 0);\r\n        return $operationButton\r\n    },\r\n    _createOperationAndValueButtons: function(condition, field, $item) {\r\n        this._createOperationButtonWithMenu(condition, field).appendTo($item);\r\n        if (this._hasValueButton(condition)) {\r\n            this._createValueButton(condition, field).appendTo($item)\r\n        }\r\n    },\r\n    _createFieldButtonWithMenu: function(fields, condition, field) {\r\n        var that = this;\r\n        var allowHierarchicalFields = this.option(\"allowHierarchicalFields\");\r\n        var items = getItems(fields, allowHierarchicalFields);\r\n        var item = getField(field.name || field.dataField, items);\r\n        var getFullCaption = function(item, items) {\r\n            return allowHierarchicalFields ? getCaptionWithParents(item, items) : item.caption\r\n        };\r\n        var $fieldButton = this._createButtonWithMenu({\r\n            caption: getFullCaption(item, items),\r\n            menu: {\r\n                items: items,\r\n                dataStructure: \"plain\",\r\n                keyExpr: \"id\",\r\n                parentId: \"parentId\",\r\n                displayExpr: \"caption\",\r\n                onItemClick: e => {\r\n                    if (item !== e.itemData) {\r\n                        item = e.itemData;\r\n                        condition[0] = item.name || item.dataField;\r\n                        condition[2] = \"object\" === item.dataType ? null : \"\";\r\n                        updateConditionByOperation(condition, getDefaultOperation(item), that._customOperations);\r\n                        $fieldButton.siblings().filter(\".\" + FILTER_BUILDER_ITEM_TEXT_CLASS).remove();\r\n                        that._createOperationAndValueButtons(condition, item, $fieldButton.parent());\r\n                        var caption = getFullCaption(item, e.component.option(\"items\"));\r\n                        $fieldButton.html(caption);\r\n                        this._updateFilter()\r\n                    }\r\n                },\r\n                onContentReady: function(e) {\r\n                    e.component.selectItem(item)\r\n                },\r\n                cssClass: FILTER_BUILDER_FIELDS_CLASS\r\n            }\r\n        }).addClass(FILTER_BUILDER_ITEM_TEXT_CLASS).addClass(FILTER_BUILDER_ITEM_FIELD_CLASS).attr(\"tabindex\", 0);\r\n        return $fieldButton\r\n    },\r\n    _createConditionItem: function(condition, parent) {\r\n        var $item = $(\"<div>\").addClass(FILTER_BUILDER_GROUP_ITEM_CLASS);\r\n        var fields = this._getNormalizedFields();\r\n        var field = getField(condition[0], fields);\r\n        this._createRemoveButton(() => {\r\n            removeItem(parent, condition);\r\n            var isSingleChild = 1 === $item.parent().children().length;\r\n            if (isSingleChild) {\r\n                $item.parent().remove()\r\n            } else {\r\n                $item.remove()\r\n            }\r\n            this._updateFilter()\r\n        }).appendTo($item);\r\n        this._createFieldButtonWithMenu(fields, condition, field).appendTo($item);\r\n        this._createOperationAndValueButtons(condition, field, $item);\r\n        return $item\r\n    },\r\n    _getGroupOperations: function(criteria) {\r\n        var groupOperations = this.option(\"groupOperations\");\r\n        var groupOperationDescriptions = this.option(\"groupOperationDescriptions\");\r\n        if (!groupOperations || !groupOperations.length) {\r\n            groupOperations = [getGroupValue(criteria).replace(\"!\", \"not\")]\r\n        }\r\n        return groupOperations.map(operation => ({\r\n            text: groupOperationDescriptions[operation],\r\n            value: OPERATORS[operation]\r\n        }))\r\n    },\r\n    _createRemoveButton: function(handler) {\r\n        var $removeButton = $(\"<div>\").addClass(FILTER_BUILDER_IMAGE_CLASS).addClass(FILTER_BUILDER_IMAGE_REMOVE_CLASS).addClass(FILTER_BUILDER_ACTION_CLASS).attr(\"tabindex\", 0);\r\n        this._subscribeOnClickAndEnterKey($removeButton, handler);\r\n        return $removeButton\r\n    },\r\n    _createAddButton: function(addGroupHandler, addConditionHandler, groupLevel) {\r\n        var $button;\r\n        var maxGroupLevel = this.option(\"maxGroupLevel\");\r\n        if (isDefined(maxGroupLevel) && groupLevel >= maxGroupLevel) {\r\n            $button = this._createButton();\r\n            this._subscribeOnClickAndEnterKey($button, addConditionHandler)\r\n        } else {\r\n            $button = this._createButtonWithMenu({\r\n                menu: {\r\n                    items: [{\r\n                        caption: messageLocalization.format(\"dxFilterBuilder-addCondition\"),\r\n                        click: addConditionHandler\r\n                    }, {\r\n                        caption: messageLocalization.format(\"dxFilterBuilder-addGroup\"),\r\n                        click: addGroupHandler\r\n                    }],\r\n                    displayExpr: \"caption\",\r\n                    onItemClick: function(e) {\r\n                        e.itemData.click()\r\n                    },\r\n                    cssClass: FILTER_BUILDER_ADD_CONDITION_CLASS\r\n                }\r\n            })\r\n        }\r\n        return $button.addClass(FILTER_BUILDER_IMAGE_CLASS).addClass(FILTER_BUILDER_IMAGE_ADD_CLASS).addClass(FILTER_BUILDER_ACTION_CLASS).attr(\"tabindex\", 0)\r\n    },\r\n    _createValueText: function(item, field, $container) {\r\n        var that = this;\r\n        var $text = $(\"<div>\").html(\"&nbsp;\").addClass(FILTER_BUILDER_ITEM_VALUE_TEXT_CLASS).attr(\"tabindex\", 0).appendTo($container);\r\n        var value = item[2];\r\n        var customOperation = getCustomOperation(that._customOperations, item[1]);\r\n        if (!customOperation && field.lookup) {\r\n            getCurrentLookupValueText(field, value, (function(result) {\r\n                renderValueText($text, result)\r\n            }))\r\n        } else {\r\n            when(getCurrentValueText(field, value, customOperation)).done(result => {\r\n                renderValueText($text, result, customOperation)\r\n            })\r\n        }\r\n        that._subscribeOnClickAndEnterKey($text, (function(e) {\r\n            if (\"keyup\" === e.type) {\r\n                e.stopPropagation()\r\n            }\r\n            that._createValueEditorWithEvents(item, field, $container)\r\n        }));\r\n        return $text\r\n    },\r\n    _updateConditionValue: function(item, value, callback) {\r\n        var areValuesDifferent = item[2] !== value;\r\n        if (areValuesDifferent) {\r\n            item[2] = value\r\n        }\r\n        callback();\r\n        this._updateFilter()\r\n    },\r\n    _addDocumentKeyUp: function($editor, handler) {\r\n        var isComposing = false;\r\n        var hasCompositionJustEnded = false;\r\n        var document = domAdapter.getDocument();\r\n        var documentKeyUpHandler = e => {\r\n            if (isComposing || hasCompositionJustEnded) {\r\n                hasCompositionJustEnded = false;\r\n                return\r\n            }\r\n            handler(e)\r\n        };\r\n        eventsEngine.on(document, \"keyup\", documentKeyUpHandler);\r\n        var input = $editor.find(\"input\");\r\n        eventsEngine.on(input, \"compositionstart\", () => {\r\n            isComposing = true\r\n        });\r\n        eventsEngine.on(input, \"compositionend\", () => {\r\n            isComposing = false;\r\n            hasCompositionJustEnded = true\r\n        });\r\n        eventsEngine.on(input, \"keydown\", event => {\r\n            if (229 !== event.which) {\r\n                hasCompositionJustEnded = false\r\n            }\r\n        });\r\n        this._documentKeyUpHandler = documentKeyUpHandler\r\n    },\r\n    _addDocumentClick: function($editor, closeEditorFunc) {\r\n        var document = domAdapter.getDocument();\r\n        var documentClickHandler = e => {\r\n            if (!this._isFocusOnEditorParts($editor, e.target)) {\r\n                eventsEngine.trigger($editor.find(\"input\"), \"change\");\r\n                closeEditorFunc()\r\n            }\r\n        };\r\n        eventsEngine.on(document, \"dxpointerdown\", documentClickHandler);\r\n        this._documentClickHandler = documentClickHandler\r\n    },\r\n    _isFocusOnEditorParts: function($editor, target) {\r\n        var activeElement = target || domAdapter.getActiveElement();\r\n        return $(activeElement).closest($editor.children()).length || $(activeElement).closest(\".dx-dropdowneditor-overlay\").length\r\n    },\r\n    _removeEvents: function() {\r\n        var document = domAdapter.getDocument();\r\n        isDefined(this._documentKeyUpHandler) && eventsEngine.off(document, \"keyup\", this._documentKeyUpHandler);\r\n        isDefined(this._documentClickHandler) && eventsEngine.off(document, \"dxpointerdown\", this._documentClickHandler)\r\n    },\r\n    _dispose: function() {\r\n        this._removeEvents();\r\n        this.callBase()\r\n    },\r\n    _createValueEditorWithEvents: function(item, field, $container) {\r\n        var value = item[2];\r\n        var createValueText = () => {\r\n            $container.empty();\r\n            this._removeEvents();\r\n            return this._createValueText(item, field, $container)\r\n        };\r\n        var closeEditor = () => {\r\n            this._updateConditionValue(item, value, (function() {\r\n                createValueText()\r\n            }))\r\n        };\r\n        var options = {\r\n            value: \"\" === value ? null : value,\r\n            filterOperation: getOperationValue(item),\r\n            setValue: function(data) {\r\n                value = null === data ? \"\" : data\r\n            },\r\n            closeEditor: closeEditor,\r\n            text: $container.text()\r\n        };\r\n        $container.empty();\r\n        var $editor = this._createValueEditor($container, field, options);\r\n        eventsEngine.trigger($editor.find(\"input\").not(\":hidden\").eq(0), \"focus\");\r\n        this._removeEvents();\r\n        this._addDocumentClick($editor, closeEditor);\r\n        this._addDocumentKeyUp($editor, e => {\r\n            var keyName = normalizeKeyName(e);\r\n            if (keyName === TAB_KEY) {\r\n                if (this._isFocusOnEditorParts($editor)) {\r\n                    return\r\n                }\r\n                this._updateConditionValue(item, value, (function() {\r\n                    createValueText();\r\n                    if (e.shiftKey) {\r\n                        eventsEngine.trigger($container.prev(), \"focus\")\r\n                    }\r\n                }))\r\n            }\r\n            if (keyName === ESCAPE_KEY) {\r\n                eventsEngine.trigger(createValueText(), \"focus\")\r\n            }\r\n            if (keyName === ENTER_KEY) {\r\n                this._updateConditionValue(item, value, (function() {\r\n                    eventsEngine.trigger(createValueText(), \"focus\")\r\n                }))\r\n            }\r\n        });\r\n        this._fireContentReadyAction()\r\n    },\r\n    _createValueButton: function(item, field) {\r\n        var $valueButton = $(\"<div>\").addClass(FILTER_BUILDER_ITEM_TEXT_CLASS).addClass(FILTER_BUILDER_ITEM_VALUE_CLASS);\r\n        this._createValueText(item, field, $valueButton);\r\n        return $valueButton\r\n    },\r\n    _createValueEditor: function($container, field, options) {\r\n        var $editor = $(\"<div>\").attr(\"tabindex\", 0).appendTo($container);\r\n        var customOperation = getCustomOperation(this._customOperations, options.filterOperation);\r\n        var editorTemplate = customOperation && customOperation.editorTemplate ? customOperation.editorTemplate : field.editorTemplate;\r\n        if (editorTemplate) {\r\n            var template = this._getTemplate(editorTemplate);\r\n            template.render({\r\n                model: extend({\r\n                    field: field\r\n                }, options),\r\n                container: $editor\r\n            })\r\n        } else {\r\n            this._editorFactory.createEditor.call(this, $editor, extend({}, field, options, {\r\n                parentType: SOURCE\r\n            }))\r\n        }\r\n        return $editor\r\n    },\r\n    _createPopupWithTreeView: function(options, $container) {\r\n        var that = this;\r\n        var $popup = $(\"<div>\").addClass(options.menu.cssClass).appendTo($container);\r\n        this._createComponent($popup, Popup, {\r\n            wrapperAttr: {\r\n                class: options.menu.cssClass\r\n            },\r\n            onHiding: options.menu.onHiding,\r\n            onHidden: options.menu.onHidden,\r\n            rtlEnabled: options.menu.rtlEnabled,\r\n            position: options.menu.position,\r\n            animation: options.menu.animation,\r\n            contentTemplate: function(contentElement) {\r\n                var $menuContainer = $(\"<div>\").appendTo(contentElement);\r\n                that._createComponent($menuContainer, TreeView, options.menu);\r\n                this.repaint()\r\n            },\r\n            _ignoreFunctionValueDeprecation: true,\r\n            maxHeight: function() {\r\n                return getElementMaxHeightByWindow(options.menu.position.of)\r\n            },\r\n            visible: true,\r\n            focusStateEnabled: false,\r\n            hideOnParentScroll: this.option(\"closePopupOnTargetScroll\"),\r\n            closeOnOutsideClick: true,\r\n            onShown: options.popup.onShown,\r\n            shading: false,\r\n            width: \"auto\",\r\n            height: \"auto\",\r\n            showTitle: false\r\n        })\r\n    },\r\n    _subscribeOnClickAndEnterKey: function($button, handler) {\r\n        eventsEngine.on($button, \"dxclick\", handler);\r\n        eventsEngine.on($button, \"keyup\", (function(e) {\r\n            if (normalizeKeyName(e) === ENTER_KEY) {\r\n                handler(e)\r\n            }\r\n        }))\r\n    }\r\n});\r\nregisterComponent(\"dxFilterBuilder\", FilterBuilder);\r\nexport default FilterBuilder;\r\n"]},"metadata":{},"sourceType":"module"}